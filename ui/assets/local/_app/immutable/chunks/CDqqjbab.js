import{r as O,t as A,b as R,i as W,c as F,d as y,e as C}from"./qEOT7B5E.js";import{d as L}from"./BGl1DbLa.js";import{c as k}from"./aSfmkhKo.js";import{S as f}from"./CNRAkr6v.js";import{g as K}from"./Dm8LSs3h.js";import{s as v}from"./BrbztvJb.js";import{o as p,p as B,d as N,q as D,g as Y,c as q,r as P}from"./BqNaQ_Wm.js";import{t as Q}from"./CMPUna6d.js";import{i as w}from"./iju4fhDV.js";import{u as V}from"./BiXsz7lk.js";import"./CWj6FrbW.js";import"./69_IOA4Y.js";import{p as M,l as H,a as U,f as $,b as j,s as x,m as z,ag as g,g as b,t as J}from"./BZ1i_Yzi.js";import{s as G}from"./BtIgVYD3.js";import{i as X}from"./Pfo2U1_a.js";import{c as I,a as T,b as Z}from"./B11KKQxI.js";import{s as tt}from"./DBXxAZ3D.js";import{i as et}from"./EXou6kTq.js";import{p as E}from"./DQFlnzBt.js";import{t as rt}from"./D2OY9xdY.js";function ot(e,t){O(2,arguments);var r=A(e).getTime(),s=R(t);return new Date(r+s)}var st=36e5;function qt(e,t){O(2,arguments);var r=R(t);return ot(e,r*st)}const at={workflowId:"WorkflowId",workflowType:"WorkflowType",timeRange:"StartTime",executionStatus:"ExecutionStatus",closeTime:"CloseTime",runId:"RunId"},nt=(e,t)=>!(e===null&&!p(t)||e===void 0||e===""||typeof e=="string"&&e==="undefined"),S=({value:e,type:t,conditional:r})=>t===f.BOOL?e.toLowerCase()==="true":t===f.KEYWORDLIST&&N(r)?e:`"${e}"`,it=e=>{const t=at[e]??e;return typeof t=="string"&&/\s/g.test(t)?"`"+t+"`":t},ut=(e,t,r,s="=",o,n)=>{const i=it(e);return r==="All"?"":n?`${i} ${r}`:p(s)?`\`${i}\` ${s} ${r}`:W(r)||F(r)?o||K(v)?`${i} ${s} "${y(r)}"`:`${i} BETWEEN "${y(r)}" AND "${C()}"`:B(s)?`\`${i}\` ${s} ${S({value:r,type:t,conditional:s})}`:`\`${i}\`${s}${S({value:r,type:t,conditional:s})}`},lt=(e,t)=>e.map(({attribute:r,type:s,value:o,conditional:n,operator:i,parenthesis:a,customDate:m})=>{if(nt(o,n)){let u=ut(r,s,o,n,t,m);return a==="("?u=`(${u}`:a===")"&&(u=`${u})`),i&&(u=`${u} ${i} `),u}}).filter(Boolean),mt=(e=[],t=!1)=>lt(e,t).join(""),_=e=>t=>t.toLowerCase()===e.toLowerCase(),ft=(e,t)=>e[t+1],ct=(e,t)=>e[t+2],pt=(e,t)=>e[t+3],dt=(e,t)=>e[t-2],gt=_(f.DATETIME),Tt=_(f.BOOL),h=()=>({attribute:"",type:f.KEYWORD,value:"",operator:"",parenthesis:"",conditional:""}),Et={ExecutionStatus:f.KEYWORD,StartTime:f.DATETIME,CloseTime:f.DATETIME,WorkflowId:f.KEYWORD,WorkflowType:f.KEYWORD,RunId:f.KEYWORD},Pt=(e,t=Et)=>{const r=Q(e),s=[];let o=h();if(!e)return[];try{return r.forEach((n,i)=>{const a=ft(r,i),m=ct(r,i);if(t[n])if(o.attribute=n,o.type=t[n],p(a)){const u=`${a} ${m}`,l=p(u)?pt(r,i):m;o.value=l.toLocaleLowerCase()==="null"?null:l}else if(gt(t[n])){const u=m,l=w(u);if(D(a)){const c=r[i+4],d=w(c);l&&d?(o.value=`BETWEEN "${u}" AND "${c}"`,o.customDate=!0):console.error("Error parsing Datetime field from query")}else l?o.value=u:console.error("Error parsing Datetime field from query")}else Tt(o.type)?(o.value=a.replace("=",""),o.conditional="="):o.value=m;if(!o.conditional&&Y(n)){const u=`${n} ${a}`;p(u)?o.conditional=u:o.conditional=n}q(n)&&(o.parenthesis=n),P(n)&&!D(dt(r,i))&&(o.operator=n,s.push(o),o=h()),i===r.length-1&&(s.push(o),o=h())}),s}catch(n){return console.error("Error setting filter parameters: ",n),[]}},ht=e=>{const t=e.filter(a=>a.attribute==="ExecutionStatus"&&a.value),r=e.filter(a=>a.attribute==="WorkflowId"&&a.value),s=e.filter(a=>a.attribute==="WorkflowType"&&a.value),o=e.filter(a=>a.attribute==="RunId"&&a.value),n=e.filter(a=>(a.attribute==="StartTime"||a.attribute==="CloseTime")&&a.value),i=[t,r,o,s,n].filter(a=>a.length);return i.forEach((a,m)=>{var u,l;a.length&&((u=i[m+1])!=null&&u.length)?a[a.length-1].operator="AND":a.length&&!((l=i[m+1])!=null&&l.length)&&(a[a.length-1].operator="")}),[...t,...r,...o,...s,...n]},yt=e=>(e.forEach((t,r)=>{const s=e[r-1];s&&!s.operator&&(s.operator="AND");const o=e[r+1];o||(t.operator=""),t.operator==="OR"&&(o==null?void 0:o.attribute)!==t.attribute?(t.parenthesis="",t.operator=""):t.operator==="OR"&&(s==null?void 0:s.operator)!=="OR"?t.parenthesis="(":(s==null?void 0:s.operator)==="OR"&&t.operator!=="OR"?t.parenthesis=")":t.parenthesis=""}),e),Qt=L((e,t,r=!1)=>{const s=r?ht(t):yt(t),o=mt(s);V({url:e,parameter:"query",value:o,allowEmpty:!1,clearParameters:[k]})},300);function Vt(e,t){M(t,!1);const r=z();let s=E(t,"key",8),o=E(t,"count",8,void 0),n=E(t,"replace",8,void 0);H(()=>(g(s()),g(n()),g(o())),()=>{x(r,rt(s(),{...n(),count:o()}))}),U(),et();var i=I(),a=$(i);{var m=l=>{var c=Z();J(()=>G(c,b(r))),T(l,c)},u=l=>{var c=I(),d=$(c);tt(d,t,"default",{},null),T(l,c)};X(a,l=>{b(r)!==s()?l(m):l(u,!1)})}T(e,i),j()}export{Vt as T,Pt as a,qt as b,yt as c,ot as d,h as e,mt as t,Qt as u};

import{d as A,r as Vt,w as L}from"./entry.Ui2oTN0M.js";import{p as C}from"./stores.Dy_e6Sgn.js";import{t as T}from"./translate.BBe5dcco.js";import{r as p,a as h,b as Qt,p as Gt,c as zt,i as Xt,d as Mt}from"./route-for-api.Dk-ikqpc.js";import{s as Kt,h as K,t as Ht,b as v,j as H,k as J,l as Jt,f as S,d as B,m as Z,i as V,n as U,q as Zt,O as tt,a as to,a4 as ot,u as oo,g as no,e as eo,v as xt,P as ao,B as I}from"./scheduler.CnYDgCRb.js";import{S as ro,i as io,c as x,a as D,m as O,t as P,b,d as $,h as nt,g as Dt,e as Ot}from"./index.DW7Zsqzm.js";import{C as so}from"./card.DK3n6meh.js";import{I as lo}from"./input.CXuCaIFW.js";import{R as uo,a as Rt}from"./radio-input.hVvQV8cA.js";import{P as co}from"./payload-input.C3sH1Cul.js";import{v as $t}from"./v4.BOvFkHkt.js";import{A as q}from"./workflow-actions.TBME1SPK.js";import{a as fo,c as wo,b as Wt}from"./decode-payload.yH2di4Eq.js";import{g as mo,h as Eo,i as go}from"./screaming-enums.UO4RgiCl.js";import{s as _o,t as st}from"./versions.DTtu5n7g.js";import{s as ho}from"./index.ZQKwuoz3.js";import{s as jt,i as Ut}from"./advanced-visibility.BmGV6qrk.js";import{a as lt}from"./auth-user.pMemW6I_.js";import{i as ko,m as ut}from"./version-check.8b9VeVr0.js";import{h as yo}from"./events.BrsfYlTO.js";import{e as F,s as po}from"./encode-payload.B_EKjB0N.js";import{p as Po}from"./paginated.BfeiQ-LE.js";import{s as W}from"./parse-with-big-int.DJQKqIvA.js";import{i as bo,c as Io,d as Ct,e as To}from"./format-time.DHKJZWez.js";import{a as So}from"./events-service.BBQX_Sem.js";const Ao=async(t,o,n=fetch)=>{let e=0;try{const r=p("workflows.count",{namespace:t}),a=await h(r,{params:o?{query:o}:{},onError:()=>{},handleError:()=>{},request:n});e=parseInt((a==null?void 0:a.count)||"0")}catch{}return{count:e}},Ro=async({namespace:t,query:o})=>{const n="GROUP BY ExecutionStatus",e=p("workflows.count",{namespace:t}),{count:r,groups:a}=await h(e,{params:{query:o?`${o} ${n}`:`${n}`},notifyOnError:!1});return{count:r??"0",groups:a}},jn=async({namespace:t})=>{const o='TemporalNamespaceDivision="TemporalScheduler" AND ExecutionStatus="Running"',n=p("workflows.count",{namespace:t}),{count:e}=await h(n,{params:{query:o},notifyOnError:!1});return e??"0"},Wo=t=>({}),Lt=t=>({});function Yt(t){let o,n,e,r,a;function s(u){t[12](u)}let l={description:T("workflows.encoding"),name:"encoding",$$slots:{default:[Co]},$$scope:{ctx:t}};t[2]!==void 0&&(l.group=t[2]),n=new uo({props:l}),tt.push(()=>nt(n,"group",s));let i=t[8]==="json/protobuf"&&Nt(t);return{c(){o=K("div"),x(n.$$.fragment),r=v(),i&&i.c(),this.h()},l(u){o=H(u,"DIV",{class:!0});var d=J(o);D(n.$$.fragment,d),r=B(d),i&&i.l(d),d.forEach(S),this.h()},h(){Z(o,"class","flex w-full flex-col gap-2")},m(u,d){V(u,o,d),O(n,o,null),U(o,r),i&&i.m(o,null),a=!0},p(u,d){const m={};d&16384&&(m.$$scope={dirty:d,ctx:u}),!e&&d&4&&(e=!0,m.group=u[2],ot(()=>e=!1)),n.$set(m),u[8]==="json/protobuf"?i?(i.p(u,d),d&256&&P(i,1)):(i=Nt(u),i.c(),P(i,1),i.m(o,null)):i&&(Dt(),b(i,1,1,()=>{i=null}),Ot())},i(u){a||(P(n.$$.fragment,u),P(i),a=!0)},o(u){b(n.$$.fragment,u),b(i),a=!1},d(u){u&&S(o),$(n),i&&i.d()}}}function Co(t){let o,n,e,r;return o=new Rt({props:{id:"json/plain",value:"json/plain",label:"json/plain"}}),e=new Rt({props:{id:"json/protobuf",value:"json/protobuf",label:"json/protobuf"}}),{c(){x(o.$$.fragment),n=v(),x(e.$$.fragment)},l(a){D(o.$$.fragment,a),n=B(a),D(e.$$.fragment,a)},m(a,s){O(o,a,s),V(a,n,s),O(e,a,s),r=!0},p:xt,i(a){r||(P(o.$$.fragment,a),P(e.$$.fragment,a),r=!0)},o(a){b(o.$$.fragment,a),b(e.$$.fragment,a),r=!1},d(a){a&&S(n),$(o,a),$(e,a)}}}function Nt(t){let o,n,e;function r(s){t[13](s)}let a={label:T("workflows.message-type"),error:t[5],id:"messageType"};return t[0]!==void 0&&(a.value=t[0]),o=new lo({props:a}),tt.push(()=>nt(o,"value",r)),{c(){x(o.$$.fragment)},l(s){D(o.$$.fragment,s)},m(s,l){O(o,s,l),e=!0},p(s,l){const i={};l&32&&(i.error=s[5]),!n&&l&1&&(n=!0,i.value=s[0],ot(()=>n=!1)),o.$set(i)},i(s){e||(P(o.$$.fragment,s),e=!0)},o(s){b(o.$$.fragment,s),e=!1},d(s){$(o,s)}}}function Lo(t){let o,n,e,r,a,s,l,i;function u(f){t[10](f)}function d(f){t[11](f)}let m={error:t[5],id:t[4],editing:t[7]};t[1]!==void 0&&(m.input=t[1]),t[3]!==void 0&&(m.loading=t[3]),o=new co({props:m}),tt.push(()=>nt(o,"input",u)),tt.push(()=>nt(o,"loading",d));let c=t[7]&&Yt(t);const _=t[9].action,E=to(_,t,t[14],Lt);return{c(){x(o.$$.fragment),r=v(),a=K("div"),c&&c.c(),s=v(),E&&E.c(),this.h()},l(f){D(o.$$.fragment,f),r=B(f),a=H(f,"DIV",{class:!0});var g=J(a);c&&c.l(g),s=B(g),E&&E.l(g),g.forEach(S),this.h()},h(){Z(a,"class",l="flex items-end gap-2 "+(t[7]?"justify-between":"justify-end"))},m(f,g){O(o,f,g),V(f,r,g),V(f,a,g),c&&c.m(a,null),U(a,s),E&&E.m(a,null),i=!0},p(f,g){const k={};g&32&&(k.error=f[5]),g&16&&(k.id=f[4]),g&128&&(k.editing=f[7]),!n&&g&2&&(n=!0,k.input=f[1],ot(()=>n=!1)),!e&&g&8&&(e=!0,k.loading=f[3],ot(()=>e=!1)),o.$set(k),f[7]?c?(c.p(f,g),g&128&&P(c,1)):(c=Yt(f),c.c(),P(c,1),c.m(a,s)):c&&(Dt(),b(c,1,1,()=>{c=null}),Ot()),E&&E.p&&(!i||g&16384)&&oo(E,_,f,f[14],i?eo(_,f[14],g,Wo):no(f[14]),Lt),(!i||g&128&&l!==(l="flex items-end gap-2 "+(f[7]?"justify-between":"justify-end")))&&Z(a,"class",l)},i(f){i||(P(o.$$.fragment,f),P(c),P(E,f),i=!0)},o(f){b(o.$$.fragment,f),b(c),b(E,f),i=!1},d(f){f&&(S(r),S(a)),$(o,f),c&&c.d(),E&&E.d(f)}}}function Yo(t){let o,n,e,r,a,s;return a=new so({props:{class:"flex flex-col gap-2",$$slots:{default:[Lo]},$$scope:{ctx:t}}}),{c(){o=K("div"),n=K("h5"),e=Ht(t[6]),r=v(),x(a.$$.fragment),this.h()},l(l){o=H(l,"DIV",{});var i=J(o);n=H(i,"H5",{class:!0});var u=J(n);e=Jt(u,t[6]),u.forEach(S),r=B(i),D(a.$$.fragment,i),i.forEach(S),this.h()},h(){Z(n,"class","pb-1 text-sm font-medium")},m(l,i){V(l,o,i),U(o,n),U(n,e),U(o,r),O(a,o,null),s=!0},p(l,[i]){(!s||i&64)&&Zt(e,l[6]);const u={};i&16831&&(u.$$scope={dirty:i,ctx:l}),a.$set(u)},i(l){s||(P(a.$$.fragment,l),s=!0)},o(l){b(a.$$.fragment,l),s=!1},d(l){l&&S(o),$(a)}}}const No=["json/plain","json/protobuf"],xo=t=>No.includes(t);function Do(t,o,n){let e,r=xt,a=()=>(r(),r=ao(d,w=>n(8,e=w)),d);t.$$.on_destroy.push(()=>r());let{$$slots:s={},$$scope:l}=o,{id:i=$t()}=o,{input:u}=o,{encoding:d}=o;a();let{messageType:m}=o,{error:c=!1}=o,{loading:_=!1}=o,{label:E=T("workflows.input")}=o,{editing:f=!0}=o;function g(w){u=w,n(1,u)}function k(w){_=w,n(3,_)}function Y(w){d=w,a(n(2,d))}function N(w){m=w,n(0,m),n(8,e)}return t.$$set=w=>{"id"in w&&n(4,i=w.id),"input"in w&&n(1,u=w.input),"encoding"in w&&a(n(2,d=w.encoding)),"messageType"in w&&n(0,m=w.messageType),"error"in w&&n(5,c=w.error),"loading"in w&&n(3,_=w.loading),"label"in w&&n(6,E=w.label),"editing"in w&&n(7,f=w.editing),"$$scope"in w&&n(14,l=w.$$scope)},t.$$.update=()=>{t.$$.dirty&257&&e==="json/plain"&&m&&n(0,m="")},[m,u,d,_,i,c,E,f,e,s,g,k,Y,N,l]}class Un extends ro{constructor(o){super(),io(this,o,Do,Yo,Kt,{id:4,input:1,encoding:2,messageType:0,error:5,loading:3,label:6,editing:7})}}const Oo=(t=_o)=>!I(t).disableWriteActions,$o=(t=[])=>t.map(o=>{const n=ho(o,!0),e=o.activityId;return{...n,id:e}}),jo=t=>t?t.map(o=>({...o,state:Eo(o.state)})):[],Uo=t=>t?t.map(o=>({...o,state:go(o.state)})):[],qo=t=>!t||!t.indexedFields?{}:{indexedFields:Object.entries(t.indexedFields).reduce((n,[e,r])=>({...n,[e]:fo(r)}),{})},ct=t=>{var wt,mt,Et,gt,_t,ht,kt,yt,pt,Pt,bt,It,Tt,St,At;const o=qo(t.workflowExecutionInfo.searchAttributes),n=t.workflowExecutionInfo.memo,e=t.workflowExecutionInfo.type.name,r=t.workflowExecutionInfo.execution.workflowId,a=t.workflowExecutionInfo.execution.runId,s=t.workflowExecutionInfo.startTime,l=t.workflowExecutionInfo.closeTime,i=t.workflowExecutionInfo.executionTime,u=mo(t.workflowExecutionInfo.status),d=u==="Running",m=t.workflowExecutionInfo.historyLength,c=t.workflowExecutionInfo.historySizeBytes,_=`/workflows/${r}/${a}`,E=((mt=(wt=t==null?void 0:t.executionConfig)==null?void 0:wt.taskQueue)==null?void 0:mt.name)||((Et=t==null?void 0:t.workflowExecutionInfo)==null?void 0:Et.taskQueue),f=(gt=t==null?void 0:t.workflowExecutionInfo)==null?void 0:gt.mostRecentWorkerVersionStamp,g=(_t=t==null?void 0:t.workflowExecutionInfo)==null?void 0:_t.assignedBuildId,k=(ht=t==null?void 0:t.workflowExecutionInfo)==null?void 0:ht.parentNamespaceId,Y=(kt=t==null?void 0:t.workflowExecutionInfo)==null?void 0:kt.parentExecution,N=t.workflowExecutionInfo.stateTransitionCount,w=(yt=t.executionConfig)==null?void 0:yt.defaultWorkflowTaskTimeout,dt=$o(t.pendingActivities),j=(t==null?void 0:t.pendingChildren)??[],y=jo(t==null?void 0:t.pendingNexusOperations),Q=t==null?void 0:t.pendingWorkflowTask,G=Uo(t==null?void 0:t.callbacks),at=(pt=t.workflowExecutionInfo)==null?void 0:pt.rootExecution,rt=(Pt=t.workflowExecutionInfo)==null?void 0:Pt.versioningInfo;let z,R;return(bt=t==null?void 0:t.executionConfig)!=null&&bt.userMetadata&&(z=(Tt=(It=t==null?void 0:t.executionConfig)==null?void 0:It.userMetadata)==null?void 0:Tt.summary,R=(At=(St=t==null?void 0:t.executionConfig)==null?void 0:St.userMetadata)==null?void 0:At.details),{name:e,id:r,runId:a,startTime:s,endTime:l,executionTime:i,status:u,historyEvents:m,historySizeBytes:c,searchAttributes:o,memo:n,rootExecution:at,url:_,taskQueue:E,assignedBuildId:g,mostRecentWorkerVersionStamp:f,pendingActivities:dt,pendingChildren:j,pendingNexusOperations:y,pendingWorkflowTask:Q,callbacks:G,versioningInfo:rt,summary:z,details:R,parentNamespaceId:k,parent:Y,stateTransitionCount:N,isRunning:d,defaultWorkflowTaskTimeout:w,get canBeTerminated(){return d&&Oo()}}},et=t=>(t.executions||[]).map(o=>ct({workflowExecutionInfo:o}));var X=(t=>(t[t.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED",t[t.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL=1]="RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL",t[t.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE=2]="RESET_REAPPLY_EXCLUDE_TYPE_UPDATE",t))(X||{}),M=(t=>(t[t.RESET_REAPPLY_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_TYPE_UNSPECIFIED",t[t.RESET_REAPPLY_TYPE_SIGNAL=1]="RESET_REAPPLY_TYPE_SIGNAL",t[t.RESET_REAPPLY_TYPE_NONE=2]="RESET_REAPPLY_TYPE_NONE",t[t.RESET_REAPPLY_TYPE_ALL_ELIGIBLE=3]="RESET_REAPPLY_TYPE_ALL_ELIGIBLE",t))(M||{});const Fo={workflowId:"WorkflowId",workflowType:"WorkflowType",timeRange:"StartTime",executionStatus:"ExecutionStatus",closeTime:"CloseTime"},vo=["workflowId","workflowType","timeRange","executionStatus","closeTime"],Bo=t=>!(t===null||t===void 0||t===""||typeof t=="string"&&t==="undefined"),Vo=t=>{if(typeof t!="string")return!1;for(const o of vo)if(o===t)return!0;return!1},Qo=(t,o,n)=>{const e=Fo[t];return o==="All"?"":bo(o)||Io(o)?n||I(jt)?`${e} > "${Ct(o)}"`:`${e} BETWEEN "${Ct(o)}" AND "${To()}"`:`${e}="${o}"`},Go=(t,o)=>Object.entries(t).map(([n,e])=>{if(Vo(n)&&Bo(e))return Qo(n,e,o)}).filter(Boolean),qt=(t,o=!1)=>Go(t,o).join(" and ");function zo(t){console.error("Unhandled action:",t)}const Xo=(t,o)=>{let n;switch(t){case q.Cancel:n=T("workflows.canceled");break;case q.Reset:n=T("workflows.reset");break;case q.Terminate:n=T("workflows.terminated");break;default:zo(t)}return o?T("workflows.workflow-action-reason-placeholder-with-email",{action:n,email:o}):T("workflows.workflow-action-reason-placeholder",{action:n})},Ft=({action:t,reason:o,email:n})=>{const e=Xo(t,n);return o?[o.trim(),e].join(" "):e},ft=async(t,o,n=fetch,e=!1)=>{const r=o.query||qt(o,e);let a;try{a=decodeURIComponent(r)}catch{a=r}const s=e?"workflows.archived":"workflows";let l="";const i=c=>{var _,E;zt(c),(_=c==null?void 0:c.body)!=null&&_.message||c!=null&&c.status?l=((E=c==null?void 0:c.body)==null?void 0:E.message)??`Error fetching workflows: ${c.status}: ${c.statusText}`:l="Error fetching workflows: Server failed to respond"},u=p(s,{namespace:t}),{executions:d,nextPageToken:m}=await h(u,{params:{query:a},onError:i,handleError:i,request:n})??{executions:[],nextPageToken:""};return{workflows:et({executions:d}),nextPageToken:String(m),error:l}},qn=async({namespace:t,workflowId:o,url:n},e=fetch)=>{var d;const r="workflows",a=n??Qt(t),s=Gt(r,{namespace:t}),l=a+s,{executions:i}=await h(l,{params:{query:`WorkflowId="${o}"`,pageSize:"1"},request:e})??{executions:[]},u=(d=et({executions:i}))==null?void 0:d[0];return{runId:u==null?void 0:u.runId}},Fn=async(t,o=fetch,n=!1)=>{const e=n?"workflows.archived":"workflows";let r=!0;const a=l=>{(Xt(l)||Mt(l))&&(r=!1)},s=p(e,{namespace:t});return await h(s,{params:{pageSize:"1"},onError:a,handleError:a,request:o}),{authorized:r}},vn=async(t,o,n=fetch)=>ft(t,o,n,!0);async function vt(t,o=fetch){const n=p("workflow",{namespace:t.namespace,workflowId:t.workflowId});return h(n,{request:o,notifyOnError:!1,params:{"execution.runId":t.runId}}).then(e=>({workflow:ct(e)})).catch(e=>({error:e}))}async function Bn({workflow:t,namespace:o,reason:n}){const e=p("workflow.terminate",{namespace:o,workflowId:t.id}),r=I(lt).email,a=Ft({reason:n,action:q.Terminate,email:r});return await h(e,{options:{method:"POST",body:W({reason:a,...r&&{identity:r}})},notifyOnError:!1,params:{"execution.runId":t.runId}})}async function Vn({namespace:t,workflow:{id:o,runId:n}},e=fetch){const r=p("workflow.cancel",{namespace:t,workflowId:o});return h(r,{request:e,notifyOnError:!1,options:{method:"POST"},params:{"execution.runId":n}})}async function Qn({namespace:t,workflow:{id:o,runId:n},name:e,input:r,encoding:a,messageType:s}){const l=p("workflow.signal",{namespace:t,workflowId:o,signalName:e}),i=await F({input:r,encoding:a,messageType:s}),u=I(C).data.settings,d=(u==null?void 0:u.version)??"",c=ko(d,"2.22")?{signalName:e,workflowExecution:{workflowId:o,runId:n},input:{payloads:i}}:{signalName:e,input:{payloads:i},params:{"execution.runId":n}};return h(l,{notifyOnError:!1,options:{method:"POST",body:W(c)}})}async function Gn({namespace:t,workflow:{workflowId:o,runId:n},name:e,identity:r,updateId:a,input:s="",encoding:l}){const i=p("workflow.update",{namespace:t,workflowId:o,updateName:e}),u=await F({input:s,encoding:l});return h(i,{notifyOnError:!1,options:{method:"POST",body:W({workflowExecution:{runId:n},request:{meta:{updateId:a,identity:r},input:{args:{payloads:u}}}})}})}async function zn({namespace:t,workflow:{id:o,runId:n},eventId:e,reason:r,includeSignals:a,excludeSignals:s,excludeUpdates:l}){const i=p("workflow.reset",{namespace:t,workflowId:o}),u=I(lt).email,d=Ft({action:q.Reset,reason:r,email:u}),m={workflowExecution:{workflowId:o,runId:n},workflowTaskFinishEventId:e,requestId:$t(),reason:d};if(I(Ut)||ut("1.24.0",I(st))){const c=[];!s&&!l&&c.push(X.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED),s&&c.push(X.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL),l&&c.push(X.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE),m.resetReapplyExcludeTypes=c,m.resetReapplyType=M.RESET_REAPPLY_TYPE_ALL_ELIGIBLE}else{let c;a?c=M.RESET_REAPPLY_TYPE_SIGNAL:c=M.RESET_REAPPLY_TYPE_NONE,m.resetReapplyType=c}return h(i,{notifyOnError:!1,options:{method:"POST",body:W(m)},params:{"execution.runId":n}})}async function Xn(t,o=fetch){const n=r=>{console.error(r)},e=p("workflow",t);return h(e,{request:o,onError:n,handleError:n}).then(ct)}async function Mn(t,o,n){if(!I(Bt))return[];try{let e=`ParentWorkflowId = "${o}"`;n&&(e+=` AND ParentRunId = "${n}"`);const{workflows:r}=await ft(t,{query:e});return r}catch{return[]}}const Mo=t=>{if(!t.length)return{};const o={};return t.forEach(n=>{o[n.label]=po(n.value)}),o};async function Kn({namespace:t,workflowId:o,taskQueue:n,workflowType:e,input:r,summary:a,details:s,encoding:l,messageType:i,searchAttributes:u}){const d=p("workflow",{namespace:t,workflowId:o});let m,c,_;if(r)try{m=await F({input:r,encoding:l,messageType:i})}catch{throw new Error("Could not encode input for starting workflow")}try{a&&(c=(await F({input:W(a),encoding:"json/plain"}))[0]),s&&(_=(await F({input:W(s),encoding:"json/plain"}))[0])}catch{console.error("Could not encode summary or details for starting workflow")}const E=W({workflowId:o,taskQueue:{name:n},workflowType:{name:e},input:m?{payloads:m}:null,userMetadata:{summary:c,details:_},searchAttributes:u.length===0?null:{indexedFields:{...Mo(u)}}});return h(d,{notifyOnError:!1,options:{method:"POST",body:E}})}const Hn=async({namespace:t,workflowType:o,workflowId:n})=>{var a,s,l,i,u,d,m,c,_,E;const e=f=>{console.error(f)},r={input:"",encoding:"json/plain",messageType:"",searchAttributes:void 0,summary:"",details:""};try{let f="";o&&n?f=`WorkflowType = "${o}" AND WorkflowId = "${n}"`:o?f=`WorkflowType = "${o}"`:n&&(f=`WorkflowId = "${n}"`);const g=p("workflows",{namespace:t}),k=await h(g,{params:{query:f,pageSize:"1"},handleError:e});if(!((a=k==null?void 0:k.executions)!=null&&a[0]))return r;const Y=et(k)[0],N={namespace:t,workflowId:Y.id,runId:Y.runId},{workflow:w}=await vt(N),j=await So(N),y=await wo((s=j==null?void 0:j.attributes)==null?void 0:s.input,t,I(C).data.settings,I(lt).accessToken,"readable",!1);let Q="";if(w.summary){const R=await Wt(w.summary);typeof R=="string"&&(Q=R)}let G="";if(w.details){const R=await Wt(w.details);typeof R=="string"&&(G=R)}const at=y!=null&&y.payloads?W((l=y.payloads[0])==null?void 0:l.data):"",rt=y!=null&&y.payloads&&xo((u=(i=y.payloads[0])==null?void 0:i.metadata)==null?void 0:u.encoding)?(m=(d=y.payloads[0])==null?void 0:d.metadata)==null?void 0:m.encoding:"json/plain",z=y!=null&&y.payloads?(_=(c=y.payloads[0])==null?void 0:c.metadata)==null?void 0:_.messageType:"";return{input:at,encoding:rt,messageType:z,searchAttributes:(E=w==null?void 0:w.searchAttributes)==null?void 0:E.indexedFields,summary:Q,details:G}}catch{return r}},Ko=(t,o)=>{const n=new Map;o.forEach(r=>{if(r.parent){const a=`${r.parent.workflowId}:${r.parent.runId}`,s=n.get(a)||[];s.push(r),n.set(a,s)}});const e=(r,a)=>{const s=`${r.id}:${r.runId}`,l=n.get(s)||[],i={workflow:r,children:[],rootPaths:[...a,{runId:r.runId,workflowId:r.id}]};return i.children=l.map(u=>e(u,i.rootPaths)),i};return e(t,[])};async function Jn(t,o,n){let e=`RootWorkflowId = "${o}"`;return n&&(e+=` AND RootRunId = "${n}"`),await Ro({namespace:t,query:e})}async function Zn(t,o,n){let e=`RootWorkflowId = "${o}"`;n&&(e+=` AND RootRunId = "${n}"`);const r=await vt({namespace:t,workflowId:o,runId:n}),a=await Ho(t,{query:e});return Ko(r==null?void 0:r.workflow,a)}const Ho=async(t,o,n=fetch,e=!1)=>{const r=o.query||qt(o,e);let a;try{a=decodeURIComponent(r)}catch{a=r}const s=p("workflows",{namespace:t}),{executions:l}=await Po(async i=>h(s,{token:i,request:n,params:{query:a}}));return et({executions:l})},Jo=300,Zo=async(t,o,n)=>{o.set(!0);try{await n()}catch(e){console.error(e)}t.set(!1),setTimeout(()=>{o.set(!1)},Jo)},tn=A([C],([t])=>{var o,n,e;return!!((e=(n=(o=t.data)==null?void 0:o.systemInfo)==null?void 0:n.capabilities)!=null&&e.countGroupByExecutionStatus)}),te=A([C,st],([t,o])=>{var r,a,s;const n=ut("1.23.0",o),e=!!((s=(a=(r=t.data)==null?void 0:r.systemInfo)==null?void 0:a.capabilities)!=null&&s.prefixSearch);return n||e}),on=L(0),nn=A([C],([t])=>{var o,n;return(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.hideWorkflowQueryErrors}),oe=A([C],([t])=>{var o,n;return(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.refreshWorkflowCountsDisabled}),Bt=A([Ut,st],([t,o])=>t||ut("1.23.0",o)),en=A([C],([t])=>t.url.searchParams.get("query")),an=A([en,Bt,yo],([t,o,n])=>o&&n&&!t?"ParentWorkflowId is NULL":t),rn=A([C],([t])=>t.params.namespace),sn=A([rn,an,on,jt,nn],([t,o,n,e,r])=>({namespace:t,query:o,refresh:n,supportsAdvancedVisibility:e,hideWorkflowQueryErrors:r})),ln=t=>{dn.set({...t,newCount:0})},un=t=>sn.subscribe(({namespace:o,query:n,supportsAdvancedVisibility:e,hideWorkflowQueryErrors:r})=>{Zo(fn,cn,async()=>{const{workflows:a,error:s}=await ft(o,{query:n});if(t(a),e&&!I(tn)){const l=await Ao(o,n);ln(l)}s?r?it.set(T("workflows.workflows-error-querying")):it.set(s):it.set("")})}),ne=L(""),cn=L(!0),fn=L(!0),dn=L({count:0,newCount:0}),it=L(""),ee=Vt([],un),ae=L("");export{vt as A,ae as B,Xo as C,fn as D,cn as E,it as F,ee as G,te as H,Un as P,Fn as a,Ro as b,ne as c,oe as d,Hn as e,qn as f,Kn as g,Vn as h,jn as i,Oo as j,vn as k,qt as l,xo as m,Xn as n,tn as o,Mn as p,an as q,on as r,Mo as s,Bn as t,Jn as u,Zn as v,dn as w,zn as x,Qn as y,Gn as z};

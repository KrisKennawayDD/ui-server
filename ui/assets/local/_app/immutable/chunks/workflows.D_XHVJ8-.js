import{d as k,r as mt,w as _}from"./entry.Dar31GYH.js";import{p as y}from"./stores.jq78OVXW.js";import{t as S}from"./translate.BBe5dcco.js";import{v as nt,C as h}from"./scheduler.D6mQsyhd.js";import{r as m,a as E,i as at,b as kt,p as ht,c as yt,d as Pt,e as It,m as p}from"./route-for-api.DzDWSF9v.js";import{A as x}from"./workflow-actions.TBME1SPK.js";import{b as Tt,c as _t,a as rt}from"./decode-payload.CgwoUprw.js";import{f as gt,g as St,h as At}from"./screaming-enums.w0zEi9dM.js";import{s as xt,c as it,t as Y}from"./versions.CeFSN870.js";import{s as bt}from"./index.BaBNH_OW.js";import{a as O}from"./auth-user.Biqqpk5v.js";import{c as Lt}from"./events.BePNbmiv.js";import{e as W,s as Wt}from"./encode-payload.CAwlyBlR.js";import{s as T}from"./parse-with-big-int.BKSBwM2t.js";import{i as Ct,c as Rt,d as et,e as Yt}from"./format-time.Dn4a2B__.js";import{a as Nt}from"./events-service.BpmySyKq.js";import{v as Dt}from"./toaster.Dsf_cC3K.js";const pt=async(t,o,n=fetch)=>{let r=0;try{const e=m("workflows.count",{namespace:t}),a=await E(e,{params:o?{query:o}:{},onError:nt,handleError:nt,request:n});r=parseInt((a==null?void 0:a.count)||"0")}catch{}return{count:r}},Yo=async({namespace:t,query:o})=>{const n="GROUP BY ExecutionStatus",r=m("workflows.count",{namespace:t}),{count:e,groups:a}=await E(r,{params:{query:o?`${o} ${n}`:`${n}`},notifyOnError:!1});return{count:e??"0",groups:a}},No=async({namespace:t})=>{const o='TemporalNamespaceDivision="TemporalScheduler" AND ExecutionStatus="Running"',n=m("workflows.count",{namespace:t}),{count:r}=await E(n,{params:{query:o},notifyOnError:!1});return r??"0"},Ot=(t=xt)=>!h(t).disableWriteActions,Ut=(t=[])=>t.map(o=>{const n=bt(o,!0),r=o.activityId;return{...n,id:r}}),Ft=t=>t?t.map(o=>({...o,state:St(o.state)})):[],vt=t=>t?t.map(o=>({...o,state:At(o.state)})):[],Bt=t=>!t||!t.indexedFields?{}:{indexedFields:Object.entries(t.indexedFields).reduce((n,[r,e])=>({...n,[r]:Tt(e)}),{})},U=t=>{var q,Q,G,z,X,j,K,M,H,J,Z,tt,ot;const o=Bt(t.workflowExecutionInfo.searchAttributes),n=t.workflowExecutionInfo.memo,r=t.workflowExecutionInfo.type.name,e=t.workflowExecutionInfo.execution.workflowId,a=t.workflowExecutionInfo.execution.runId,s=t.workflowExecutionInfo.startTime,c=t.workflowExecutionInfo.closeTime,u=t.workflowExecutionInfo.executionTime,f=gt(t.workflowExecutionInfo.status),l=f==="Running",d=t.workflowExecutionInfo.historyLength,i=t.workflowExecutionInfo.historySizeBytes,w=`/workflows/${e}/${a}`,P=((Q=(q=t==null?void 0:t.executionConfig)==null?void 0:q.taskQueue)==null?void 0:Q.name)||((G=t==null?void 0:t.workflowExecutionInfo)==null?void 0:G.taskQueue),A=(z=t==null?void 0:t.workflowExecutionInfo)==null?void 0:z.mostRecentWorkerVersionStamp,g=(X=t==null?void 0:t.workflowExecutionInfo)==null?void 0:X.assignedBuildId,b=(j=t==null?void 0:t.workflowExecutionInfo)==null?void 0:j.parentNamespaceId,L=(K=t==null?void 0:t.workflowExecutionInfo)==null?void 0:K.parentExecution,B=t.workflowExecutionInfo.stateTransitionCount,I=(M=t.executionConfig)==null?void 0:M.defaultWorkflowTaskTimeout,lt=Ut(t.pendingActivities),ft=(t==null?void 0:t.pendingChildren)??[],dt=Ft(t==null?void 0:t.pendingNexusOperations),wt=t==null?void 0:t.pendingWorkflowTask,Et=vt(t==null?void 0:t.callbacks);let $,V;return(H=t==null?void 0:t.executionConfig)!=null&&H.userMetadata&&($=(Z=(J=t==null?void 0:t.executionConfig)==null?void 0:J.userMetadata)==null?void 0:Z.summary,V=(ot=(tt=t==null?void 0:t.executionConfig)==null?void 0:tt.userMetadata)==null?void 0:ot.details),{name:r,id:e,runId:a,startTime:s,endTime:c,executionTime:u,status:f,historyEvents:d,historySizeBytes:i,searchAttributes:o,memo:n,url:w,taskQueue:P,assignedBuildId:g,mostRecentWorkerVersionStamp:A,pendingActivities:lt,pendingChildren:ft,pendingNexusOperations:dt,pendingWorkflowTask:wt,callbacks:Et,summary:$,details:V,parentNamespaceId:b,parent:L,stateTransitionCount:B,isRunning:l,defaultWorkflowTaskTimeout:I,get canBeTerminated(){return l&&Ot()}}},F=t=>(t.executions||[]).map(o=>U({workflowExecutionInfo:o})),$t=(t,o)=>{var n;return((n=t==null?void 0:t.visibilityStore)==null?void 0:n.includes("elasticsearch"))||at(o,"1.19")},Vt=t=>{var o;return(o=t==null?void 0:t.visibilityStore)==null?void 0:o.includes("elasticsearch")},N=k([y],([t])=>{var o,n,r;return(r=(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.runtimeEnvironment)==null?void 0:r.isCloud}),st=k([it,Y,N],([t,o,n])=>$t(t,o)||n);k([it,N],([t,o])=>Vt(t)||o);var C=(t=>(t[t.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED",t[t.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL=1]="RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL",t[t.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE=2]="RESET_REAPPLY_EXCLUDE_TYPE_UPDATE",t))(C||{}),R=(t=>(t[t.RESET_REAPPLY_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_TYPE_UNSPECIFIED",t[t.RESET_REAPPLY_TYPE_SIGNAL=1]="RESET_REAPPLY_TYPE_SIGNAL",t[t.RESET_REAPPLY_TYPE_NONE=2]="RESET_REAPPLY_TYPE_NONE",t[t.RESET_REAPPLY_TYPE_ALL_ELIGIBLE=3]="RESET_REAPPLY_TYPE_ALL_ELIGIBLE",t))(R||{});const qt={workflowId:"WorkflowId",workflowType:"WorkflowType",timeRange:"StartTime",executionStatus:"ExecutionStatus",closeTime:"CloseTime"},Qt=["workflowId","workflowType","timeRange","executionStatus","closeTime"],Gt=t=>!(t===null||t===void 0||t===""||typeof t=="string"&&t==="undefined"),zt=t=>{if(typeof t!="string")return!1;for(const o of Qt)if(o===t)return!0;return!1},Xt=(t,o,n)=>{const r=qt[t];return o==="All"?"":Ct(o)||Rt(o)?n||h(st)?`${r} > "${et(o)}"`:`${r} BETWEEN "${et(o)}" AND "${Yt()}"`:`${r}="${o}"`},jt=(t,o)=>Object.entries(t).map(([n,r])=>{if(zt(n)&&Gt(r))return Xt(n,r,o)}).filter(Boolean),Kt=(t,o=!1)=>jt(t,o).join(" and ");function Mt(t){console.error("Unhandled action:",t)}const Ht=(t,o)=>{let n;switch(t){case x.Cancel:n=S("workflows.canceled");break;case x.Reset:n=S("workflows.reset");break;case x.Terminate:n=S("workflows.terminated");break;default:Mt(t)}return o?S("workflows.workflow-action-reason-placeholder-with-email",{action:n,email:o}):S("workflows.workflow-action-reason-placeholder",{action:n})},ct=({action:t,reason:o,email:n})=>{const r=Ht(t,n);return o?[o.trim(),r].join(" "):r},v=async(t,o,n=fetch,r=!1)=>{const e=o.query||Kt(o,r);let a;try{a=decodeURIComponent(e)}catch{a=e}const s=r?"workflows.archived":"workflows";let c="";const u=i=>{var w,P;yt(i),(w=i==null?void 0:i.body)!=null&&w.message||i!=null&&i.status?c=((P=i==null?void 0:i.body)==null?void 0:P.message)??`Error fetching workflows: ${i.status}: ${i.statusText}`:c="Error fetching workflows: Server failed to respond"},f=m(s,{namespace:t}),{executions:l,nextPageToken:d}=await E(f,{params:{query:a},onError:u,handleError:u,request:n})??{executions:[],nextPageToken:""};return{workflows:F({executions:l}),nextPageToken:String(d),error:c}},Do=async({namespace:t,workflowId:o,url:n},r=fetch)=>{var l;const e="workflows",a=n??kt(t),s=ht(e,{namespace:t}),c=a+s,{executions:u}=await E(c,{params:{query:`WorkflowId="${o}"`,pageSize:"1"},request:r})??{executions:[]},f=(l=F({executions:u}))==null?void 0:l[0];return{runId:f==null?void 0:f.runId}},po=async(t,o=fetch,n=!1)=>{const r=n?"workflows.archived":"workflows";let e=!0;const a=c=>{(Pt(c)||It(c))&&(e=!1)},s=m(r,{namespace:t});return await E(s,{params:{pageSize:"1"},onError:a,handleError:a,request:o}),{authorized:e}},Oo=async(t,o,n=fetch)=>v(t,o,n,!0);async function Jt(t,o=fetch){const n=m("workflow",{namespace:t.namespace,workflowId:t.workflowId});return E(n,{request:o,notifyOnError:!1,params:{"execution.runId":t.runId}}).then(r=>({workflow:U(r)})).catch(r=>({error:r}))}async function Uo({workflow:t,namespace:o,reason:n}){const r=m("workflow.terminate",{namespace:o,workflowId:t.id}),e=h(O).email,a=ct({reason:n,action:x.Terminate,email:e});return await E(r,{options:{method:"POST",body:T({reason:a,...e&&{identity:e}})},notifyOnError:!1,params:{"execution.runId":t.runId}})}async function Fo({namespace:t,workflow:{id:o,runId:n}},r=fetch){const e=m("workflow.cancel",{namespace:t,workflowId:o});return E(e,{request:r,notifyOnError:!1,options:{method:"POST"},params:{"execution.runId":n}})}async function vo({namespace:t,workflow:{id:o,runId:n},name:r,input:e,encoding:a}){const s=m("workflow.signal",{namespace:t,workflowId:o,signalName:r}),c=await W(e,a),u=h(y).data.settings,f=(u==null?void 0:u.version)??"",d=at(f,"2.22")?{signalName:r,workflowExecution:{workflowId:o,runId:n},input:{payloads:c}}:{signalName:r,input:{payloads:c},params:{"execution.runId":n}};return E(s,{notifyOnError:!1,options:{method:"POST",body:T(d)}})}async function Bo({namespace:t,workflow:{id:o,runId:n},eventId:r,reason:e,includeSignals:a,excludeSignals:s,excludeUpdates:c}){const u=m("workflow.reset",{namespace:t,workflowId:o}),f=h(O).email,l=ct({action:x.Reset,reason:e,email:f}),d={workflowExecution:{workflowId:o,runId:n},workflowTaskFinishEventId:r,requestId:Dt(),reason:l};if(h(N)||p("1.24.0",h(Y))){const i=[];!s&&!c&&i.push(C.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED),s&&i.push(C.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL),c&&i.push(C.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE),d.resetReapplyExcludeTypes=i,d.resetReapplyType=R.RESET_REAPPLY_TYPE_ALL_ELIGIBLE}else{let i;a?i=R.RESET_REAPPLY_TYPE_SIGNAL:i=R.RESET_REAPPLY_TYPE_NONE,d.resetReapplyType=i}return E(u,{notifyOnError:!1,options:{method:"POST",body:T(d)},params:{"execution.runId":n}})}async function $o(t,o=fetch){const n=e=>{console.error(e)},r=m("workflow",t);return E(r,{request:o,onError:n,handleError:n}).then(U)}async function Vo(t,o,n){if(!h(ut))return[];try{let r=`ParentWorkflowId = "${o}"`;n&&(r+=` AND ParentRunId = "${n}"`);const{workflows:e}=await v(t,{query:r});return e}catch{return[]}}const Zt=t=>{if(!t.length)return{};const o={};return t.forEach(n=>{o[n.label]=Wt(n.value)}),o};async function qo({namespace:t,workflowId:o,taskQueue:n,workflowType:r,input:e,summary:a,details:s,encoding:c,searchAttributes:u}){const f=m("workflow",{namespace:t,workflowId:o});let l,d,i;if(e)try{l=await W(e,c)}catch{throw new Error("Could not encode input for starting workflow")}try{a&&(d=(await W(T(a),"json/plain"))[0]),s&&(i=(await W(T(s),"json/plain"))[0])}catch{console.error("Could not encode summary or details for starting workflow")}const w=T({workflowId:o,taskQueue:{name:n},workflowType:{name:r},input:l?{payloads:l}:null,userMetadata:{summary:d,details:i},searchAttributes:u.length===0?null:{indexedFields:{...Zt(u)}}});return E(f,{notifyOnError:!1,options:{method:"POST",body:w}})}const Qo=async({namespace:t,workflowType:o,workflowId:n})=>{var a,s,c;const r=u=>{console.error(u)},e={input:"",searchAttributes:void 0,summary:"",details:""};try{let u="";o&&n?u=`WorkflowType = "${o}" AND WorkflowId = "${n}"`:o?u=`WorkflowType = "${o}"`:n&&(u=`WorkflowId = "${n}"`);const f=m("workflows",{namespace:t}),l=await E(f,{params:{query:u,pageSize:"1"},handleError:r});if(!((a=l==null?void 0:l.executions)!=null&&a[0]))return e;const d=F(l)[0],i={namespace:t,workflowId:d.id,runId:d.runId},{workflow:w}=await Jt(i),A=await Nt(i),g=await _t((s=A==null?void 0:A.attributes)==null?void 0:s.input,t,h(y).data.settings,h(O).accessToken);let b="";if(w.summary){const I=await rt(w.summary);typeof I=="string"&&(b=I)}let L="";if(w.details){const I=await rt(w.details);typeof I=="string"&&(L=I)}return{input:g!=null&&g.payloads?T(g.payloads[0]):"",searchAttributes:(c=w==null?void 0:w.searchAttributes)==null?void 0:c.indexedFields,summary:b,details:L}}catch{return e}},to=300,oo=async(t,o,n)=>{o.set(!0);try{await n()}catch(r){console.error(r)}t.set(!1),setTimeout(()=>{o.set(!1)},to)},no=k([y],([t])=>{var o,n,r;return!!((r=(n=(o=t.data)==null?void 0:o.systemInfo)==null?void 0:n.capabilities)!=null&&r.countGroupByExecutionStatus)}),Go=k([y,Y],([t,o])=>{var e,a,s;const n=p("1.23.0",o),r=!!((s=(a=(e=t.data)==null?void 0:e.systemInfo)==null?void 0:a.capabilities)!=null&&s.prefixSearch);return n||r}),ro=_(0),eo=k([y],([t])=>{var o,n;return(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.hideWorkflowQueryErrors}),zo=k([y],([t])=>{var o,n;return(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.refreshWorkflowCountsDisabled}),ut=k([N,Y],([t,o])=>t||p("1.23.0",o)),ao=k([y],([t])=>t.url.searchParams.get("query")),io=k([ao,ut,Lt],([t,o,n])=>o&&!n?t?`ParentWorkflowId is NULL AND ${t}`:"ParentWorkflowId is NULL":t),so=k([y],([t])=>t.params.namespace),co=k([so,io,ro,st,eo],([t,o,n,r,e])=>({namespace:t,query:o,refresh:n,supportsAdvancedVisibility:r,hideWorkflowQueryErrors:e})),uo=t=>{Eo.set({...t,newCount:0})},lo=t=>co.subscribe(({namespace:o,query:n,supportsAdvancedVisibility:r,hideWorkflowQueryErrors:e})=>{oo(wo,fo,async()=>{const{workflows:a,error:s}=await v(o,{query:n});if(t(a),r&&!h(no)){const c=await pt(o,n);uo(c)}s?e?D.set(S("workflows.workflows-error-querying")):D.set(s):D.set("")})}),Xo=_(""),fo=_(!0),wo=_(!0),Eo=_({count:0,newCount:0}),D=_(""),jo=mt([],lo),Ko=_("");export{Ko as A,Ht as B,ut as C,jo as D,wo as E,fo as F,D as G,po as a,Yo as b,Xo as c,zo as d,Qo as e,Do as f,qo as g,Fo as h,st as i,Vo as j,No as k,N as l,Ot as m,Oo as n,Kt as o,Bo as p,io as q,ro as r,Zt as s,Uo as t,vo as u,Jt as v,Eo as w,$o as x,no as y,Go as z};

import{w as E,g as _}from"./entry.DTzuvTF5.js";import{t as O}from"./translate.DzDeFYDI.js";import"./i18next.BLjkLUx2.js";import{s as S}from"./parse-with-big-int.DJQKqIvA.js";import{r as p,a as m}from"./route-for-api.BhX45bae.js";import{v as b}from"./v4.BOvFkHkt.js";import{s as j}from"./workflows.CINP9ZKx.js";import{e as P}from"./encode-payload.BBNwNpUV.js";import{m as D,n as Q}from"./route-for.CugVu0g3.js";const Z=async(e,n,t,s=fetch)=>(o=100,i="")=>{const a=p("schedules",{namespace:e});return m(a,{params:{maximumPageSize:String(o),nextPageToken:i,...n?{query:n}:{}},request:s,onError:t}).then(({schedules:r,nextPageToken:c})=>({items:r,nextPageToken:c?String(c):""}))};async function ee(e,n=fetch){const t=p("schedule",e);return m(t,{request:n})}async function te(e,n=fetch){const t=p("schedule",e);return m(t,{request:n,options:{method:"DELETE"}})}async function z({namespace:e,scheduleId:n,body:t}){let s="";const o=r=>{var c;return s=((c=r==null?void 0:r.body)==null?void 0:c.message)??`Error creating schedule: ${r.status}: ${r.statusText}`},i=p("schedule",{namespace:e,scheduleId:n}),{conflictToken:a}=await m(i,{options:{method:"POST",body:S({request_id:b(),...t})},onError:o});return{conflictToken:a,error:s}}async function B({namespace:e,scheduleId:n,body:t}){let s="";const o=a=>{var r;return s=((r=a==null?void 0:a.body)==null?void 0:r.message)??`Error editing schedule: ${a.status}: ${a.statusText}`},i=p("schedule.edit",{namespace:e,scheduleId:n});return await m(i,{options:{method:"POST",body:S({request_id:b(),...t})},onError:o}),{error:s}}async function se({namespace:e,scheduleId:n,reason:t}){const s={patch:{pause:t}},o=p("schedule.patch",{namespace:e,scheduleId:n});return await m(o,{options:{method:"POST",body:S({...s,request_id:b()})},onError:i=>console.error(i)})}async function ne({namespace:e,scheduleId:n,reason:t}){const s={patch:{unpause:t}},o=p("schedule.patch",{namespace:e,scheduleId:n});return await m(o,{options:{method:"POST",body:S({...s,request_id:b()})}})}async function oe({namespace:e,scheduleId:n,overlapPolicy:t}){const s={patch:{triggerImmediately:{overlapPolicy:t}}},o=p("schedule.patch",{namespace:e,scheduleId:n});return await m(o,{options:{method:"POST",body:S({...s,request_id:b()})}})}async function re({namespace:e,scheduleId:n,overlapPolicy:t,startTime:s,endTime:o}){const i={patch:{backfillRequest:[{overlapPolicy:t,startTime:s,endTime:o}]}},a=p("schedule.patch",{namespace:e,scheduleId:n});return await m(a,{options:{method:"POST",body:S({...i,request_id:b()})}})}const $=e=>e?parseInt(e):0,R=(e,n,t,s)=>`${$(e)*60*60*24+$(n)*60*60+$(t)*60+$(s)}s`,L=({months:e=[],daysOfMonth:n=[],daysOfWeek:t=[]})=>{var r,c;const s=e.sort((l,u)=>parseInt(l)-parseInt(u)).join(","),o=n.sort((l,u)=>l-u).join(","),a=(((c=(r=t==null?void 0:t[0])==null?void 0:r.split(","))==null?void 0:c.length)>1?t[0].split(","):t).sort((l,u)=>parseInt(l)-parseInt(u)).join(",");return{month:s,dayOfMonth:o,dayOfWeek:a}},F=(e,n,t)=>{const{hour:s,minute:o,second:i,phase:a,cronString:r}=n,{preset:c,months:l,days:u,daysOfMonth:k,daysOfWeek:g}=t;if(c==="string"){const d=`${r}#${r}`;e.schedule.spec.cronString=[d],e.schedule.spec.calendar=[],e.schedule.spec.interval=[]}else if(c==="interval"){const d=R(u,s,o,i);e.schedule.spec.interval=[{interval:d,phase:a||"0s"}],e.schedule.spec.cronString=[],e.schedule.spec.calendar=[]}else{const{month:d,dayOfMonth:f,dayOfWeek:y}=L({months:l,daysOfMonth:k,daysOfWeek:g});e.schedule.spec.calendar=[{year:"*",month:c==="month"?d:"",dayOfMonth:c==="month"?f:"",dayOfWeek:c==="week"?y:"",hour:s,minute:o,second:i}],e.schedule.spec.interval=[],e.schedule.spec.cronString=[]}},ae=async({action:e,spec:n,presets:t})=>{const{namespace:s,name:o,workflowId:i,workflowType:a,taskQueue:r,input:c,encoding:l,messageType:u,searchAttributes:k}=e;let g;if(c)try{g=await P({input:c,encoding:l,messageType:u})}catch(y){w.set(`${O("data-encoder.encode-error")}: ${y==null?void 0:y.message}`);return}const d={schedule_id:o.trim(),searchAttributes:k.length===0?null:{indexedFields:{...j(k)}},schedule:{spec:{calendar:[],interval:[],cronString:[]},action:{startWorkflow:{workflowId:i,workflowType:{name:a},taskQueue:{name:r},input:g?{payloads:g}:null}}}};F(d,n,t),T.set(!0);const{error:f}=await z({scheduleId:o,namespace:s,body:d});f?(w.set(f),T.set(!1)):setTimeout(()=>{w.set(""),T.set(!1),_(Q({namespace:s}))},2e3)},ce=async({action:e,spec:n,presets:t},s,o)=>{var x,A;const{namespace:i,name:a,workflowId:r,workflowType:c,taskQueue:l,input:u,encoding:k,messageType:g,searchAttributes:d}=e;let f;if(u)try{f=await P({input:u,encoding:k,messageType:g})}catch(h){w.set(`${O("data-encoder.encode-error")}: ${h==null?void 0:h.message}`);return}const{preset:y}=t,v={schedule_id:o,searchAttributes:d.length===0?null:{indexedFields:{...j(d)}},schedule:{...s,action:{startWorkflow:{...s.action.startWorkflow,workflowId:r,workflowType:{name:c},taskQueue:{name:l},...u!==void 0&&{input:f?{payloads:f}:null}}}}},I=(A=(x=v.schedule.action.startWorkflow)==null?void 0:x.header)==null?void 0:A.fields;if(I&&Object.keys(I).length>0)try{const h=Object.entries(I);for(const[W,M]of h){const C=await P({input:S(M),encoding:"json/plain"});I[W]=C[0]}}catch(h){w.set(`${O("data-encoder.encode-error")}: ${h==null?void 0:h.message}`);return}y==="existing"?v.schedule.spec=s.spec:(F(v,n,t),v.schedule.spec.structuredCalendar=[]),T.set(!0);const{error:q}=await B({namespace:i,scheduleId:o,body:v});q?(w.set(q),T.set(!1)):setTimeout(()=>{_(D({namespace:i,scheduleId:a})),w.set(""),T.set(!1)},2e3)},T=E(!1),w=E(""),ie=E("0");export{ae as a,ie as b,Z as c,te as d,w as e,ee as f,re as g,T as l,se as p,ce as s,oe as t,ne as u};

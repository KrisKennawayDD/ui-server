import{d as h,r as yt,w as g}from"./entry.MMODD4q2.js";import{p as P}from"./stores.orBfmnsv.js";import{t as A}from"./translate.BBe5dcco.js";import{r as E,a as w,b as Pt,p as It,c as Tt,i as gt,d as _t}from"./route-for-api.BGMGqGdW.js";import{C as k}from"./scheduler.DpGMy-aI.js";import{A as x}from"./workflow-actions.TBME1SPK.js";import{b as At,c as St,a as rt}from"./decode-payload.ISuJ-Xv8.js";import{g as xt,h as bt,i as Wt}from"./screaming-enums.UO4RgiCl.js";import{s as Lt,t as N}from"./versions.CQAYskou.js";import{s as Ct}from"./index.DXL2YDw5.js";import{s as at,i as it}from"./advanced-visibility.CUvNwQd2.js";import{a as D}from"./auth-user.QpfSeVjb.js";import{i as Rt,m as O}from"./version-check.8b9VeVr0.js";import{h as Yt}from"./events.sRqbTHi6.js";import{e as b,s as pt}from"./encode-payload.BhlvuPPX.js";import{p as Nt}from"./paginated.CDdn4ADj.js";import{s as y}from"./parse-with-big-int.DJQKqIvA.js";import{i as Dt,c as Ot,d as et,e as $t}from"./format-time.D8nHWdIk.js";import{a as Ut}from"./events-service.C7R-YNPj.js";import{v as Ft}from"./v4.BOvFkHkt.js";const qt=async(t,o,n=fetch)=>{let r=0;try{const e=E("workflows.count",{namespace:t}),a=await w(e,{params:o?{query:o}:{},onError:()=>{},handleError:()=>{},request:n});r=parseInt((a==null?void 0:a.count)||"0")}catch{}return{count:r}},Uo=async({namespace:t,query:o})=>{const n="GROUP BY ExecutionStatus",r=E("workflows.count",{namespace:t}),{count:e,groups:a}=await w(r,{params:{query:o?`${o} ${n}`:`${n}`},notifyOnError:!1});return{count:e??"0",groups:a}},Fo=async({namespace:t})=>{const o='TemporalNamespaceDivision="TemporalScheduler" AND ExecutionStatus="Running"',n=E("workflows.count",{namespace:t}),{count:r}=await w(n,{params:{query:o},notifyOnError:!1});return r??"0"},Bt=(t=Lt)=>!k(t).disableWriteActions,vt=(t=[])=>t.map(o=>{const n=Ct(o,!0),r=o.activityId;return{...n,id:r}}),Qt=t=>t?t.map(o=>({...o,state:bt(o.state)})):[],Vt=t=>t?t.map(o=>({...o,state:Wt(o.state)})):[],Gt=t=>!t||!t.indexedFields?{}:{indexedFields:Object.entries(t.indexedFields).reduce((n,[r,e])=>({...n,[r]:At(e)}),{})},$=t=>{var v,Q,V,G,z,X,j,M,K,H,J,Z,tt,ot,nt;const o=Gt(t.workflowExecutionInfo.searchAttributes),n=t.workflowExecutionInfo.memo,r=t.workflowExecutionInfo.type.name,e=t.workflowExecutionInfo.execution.workflowId,a=t.workflowExecutionInfo.execution.runId,i=t.workflowExecutionInfo.startTime,c=t.workflowExecutionInfo.closeTime,s=t.workflowExecutionInfo.executionTime,l=xt(t.workflowExecutionInfo.status),f=l==="Running",d=t.workflowExecutionInfo.historyLength,u=t.workflowExecutionInfo.historySizeBytes,m=`/workflows/${e}/${a}`,I=((Q=(v=t==null?void 0:t.executionConfig)==null?void 0:v.taskQueue)==null?void 0:Q.name)||((V=t==null?void 0:t.workflowExecutionInfo)==null?void 0:V.taskQueue),S=(G=t==null?void 0:t.workflowExecutionInfo)==null?void 0:G.mostRecentWorkerVersionStamp,_=(z=t==null?void 0:t.workflowExecutionInfo)==null?void 0:z.assignedBuildId,W=(X=t==null?void 0:t.workflowExecutionInfo)==null?void 0:X.parentNamespaceId,L=(j=t==null?void 0:t.workflowExecutionInfo)==null?void 0:j.parentExecution,F=t.workflowExecutionInfo.stateTransitionCount,T=(M=t.executionConfig)==null?void 0:M.defaultWorkflowTaskTimeout,ft=vt(t.pendingActivities),dt=(t==null?void 0:t.pendingChildren)??[],wt=Qt(t==null?void 0:t.pendingNexusOperations),Et=t==null?void 0:t.pendingWorkflowTask,mt=Vt(t==null?void 0:t.callbacks),kt=(K=t.workflowExecutionInfo)==null?void 0:K.rootExecution,ht=(H=t.workflowExecutionInfo)==null?void 0:H.versioningInfo;let q,B;return(J=t==null?void 0:t.executionConfig)!=null&&J.userMetadata&&(q=(tt=(Z=t==null?void 0:t.executionConfig)==null?void 0:Z.userMetadata)==null?void 0:tt.summary,B=(nt=(ot=t==null?void 0:t.executionConfig)==null?void 0:ot.userMetadata)==null?void 0:nt.details),{name:r,id:e,runId:a,startTime:i,endTime:c,executionTime:s,status:l,historyEvents:d,historySizeBytes:u,searchAttributes:o,memo:n,rootExecution:kt,url:m,taskQueue:I,assignedBuildId:_,mostRecentWorkerVersionStamp:S,pendingActivities:ft,pendingChildren:dt,pendingNexusOperations:wt,pendingWorkflowTask:Et,callbacks:mt,versioningInfo:ht,summary:q,details:B,parentNamespaceId:W,parent:L,stateTransitionCount:F,isRunning:f,defaultWorkflowTaskTimeout:T,get canBeTerminated(){return f&&Bt()}}},Y=t=>(t.executions||[]).map(o=>$({workflowExecutionInfo:o}));var C=(t=>(t[t.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED",t[t.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL=1]="RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL",t[t.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE=2]="RESET_REAPPLY_EXCLUDE_TYPE_UPDATE",t))(C||{}),R=(t=>(t[t.RESET_REAPPLY_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_TYPE_UNSPECIFIED",t[t.RESET_REAPPLY_TYPE_SIGNAL=1]="RESET_REAPPLY_TYPE_SIGNAL",t[t.RESET_REAPPLY_TYPE_NONE=2]="RESET_REAPPLY_TYPE_NONE",t[t.RESET_REAPPLY_TYPE_ALL_ELIGIBLE=3]="RESET_REAPPLY_TYPE_ALL_ELIGIBLE",t))(R||{});const zt={workflowId:"WorkflowId",workflowType:"WorkflowType",timeRange:"StartTime",executionStatus:"ExecutionStatus",closeTime:"CloseTime"},Xt=["workflowId","workflowType","timeRange","executionStatus","closeTime"],jt=t=>!(t===null||t===void 0||t===""||typeof t=="string"&&t==="undefined"),Mt=t=>{if(typeof t!="string")return!1;for(const o of Xt)if(o===t)return!0;return!1},Kt=(t,o,n)=>{const r=zt[t];return o==="All"?"":Dt(o)||Ot(o)?n||k(at)?`${r} > "${et(o)}"`:`${r} BETWEEN "${et(o)}" AND "${$t()}"`:`${r}="${o}"`},Ht=(t,o)=>Object.entries(t).map(([n,r])=>{if(Mt(n)&&jt(r))return Kt(n,r,o)}).filter(Boolean),st=(t,o=!1)=>Ht(t,o).join(" and ");function Jt(t){console.error("Unhandled action:",t)}const Zt=(t,o)=>{let n;switch(t){case x.Cancel:n=A("workflows.canceled");break;case x.Reset:n=A("workflows.reset");break;case x.Terminate:n=A("workflows.terminated");break;default:Jt(t)}return o?A("workflows.workflow-action-reason-placeholder-with-email",{action:n,email:o}):A("workflows.workflow-action-reason-placeholder",{action:n})},ct=({action:t,reason:o,email:n})=>{const r=Zt(t,n);return o?[o.trim(),r].join(" "):r},U=async(t,o,n=fetch,r=!1)=>{const e=o.query||st(o,r);let a;try{a=decodeURIComponent(e)}catch{a=e}const i=r?"workflows.archived":"workflows";let c="";const s=u=>{var m,I;Tt(u),(m=u==null?void 0:u.body)!=null&&m.message||u!=null&&u.status?c=((I=u==null?void 0:u.body)==null?void 0:I.message)??`Error fetching workflows: ${u.status}: ${u.statusText}`:c="Error fetching workflows: Server failed to respond"},l=E(i,{namespace:t}),{executions:f,nextPageToken:d}=await w(l,{params:{query:a},onError:s,handleError:s,request:n})??{executions:[],nextPageToken:""};return{workflows:Y({executions:f}),nextPageToken:String(d),error:c}},qo=async({namespace:t,workflowId:o,url:n},r=fetch)=>{var f;const e="workflows",a=n??Pt(t),i=It(e,{namespace:t}),c=a+i,{executions:s}=await w(c,{params:{query:`WorkflowId="${o}"`,pageSize:"1"},request:r})??{executions:[]},l=(f=Y({executions:s}))==null?void 0:f[0];return{runId:l==null?void 0:l.runId}},Bo=async(t,o=fetch,n=!1)=>{const r=n?"workflows.archived":"workflows";let e=!0;const a=c=>{(gt(c)||_t(c))&&(e=!1)},i=E(r,{namespace:t});return await w(i,{params:{pageSize:"1"},onError:a,handleError:a,request:o}),{authorized:e}},vo=async(t,o,n=fetch)=>U(t,o,n,!0);async function ut(t,o=fetch){const n=E("workflow",{namespace:t.namespace,workflowId:t.workflowId});return w(n,{request:o,notifyOnError:!1,params:{"execution.runId":t.runId}}).then(r=>({workflow:$(r)})).catch(r=>({error:r}))}async function Qo({workflow:t,namespace:o,reason:n}){const r=E("workflow.terminate",{namespace:o,workflowId:t.id}),e=k(D).email,a=ct({reason:n,action:x.Terminate,email:e});return await w(r,{options:{method:"POST",body:y({reason:a,...e&&{identity:e}})},notifyOnError:!1,params:{"execution.runId":t.runId}})}async function Vo({namespace:t,workflow:{id:o,runId:n}},r=fetch){const e=E("workflow.cancel",{namespace:t,workflowId:o});return w(e,{request:r,notifyOnError:!1,options:{method:"POST"},params:{"execution.runId":n}})}async function Go({namespace:t,workflow:{id:o,runId:n},name:r,input:e,encoding:a}){const i=E("workflow.signal",{namespace:t,workflowId:o,signalName:r}),c=await b(e,a),s=k(P).data.settings,l=(s==null?void 0:s.version)??"",d=Rt(l,"2.22")?{signalName:r,workflowExecution:{workflowId:o,runId:n},input:{payloads:c}}:{signalName:r,input:{payloads:c},params:{"execution.runId":n}};return w(i,{notifyOnError:!1,options:{method:"POST",body:y(d)}})}async function zo({namespace:t,workflow:{workflowId:o,runId:n},name:r,identity:e,updateId:a,input:i="",encoding:c}){const s=E("workflow.update",{namespace:t,workflowId:o,updateName:r}),l=await b(i,c);return w(s,{notifyOnError:!1,options:{method:"POST",body:y({workflowExecution:{runId:n},request:{meta:{updateId:a,identity:e},input:{args:{payloads:l}}}})}})}async function Xo({namespace:t,workflow:{id:o,runId:n},eventId:r,reason:e,includeSignals:a,excludeSignals:i,excludeUpdates:c}){const s=E("workflow.reset",{namespace:t,workflowId:o}),l=k(D).email,f=ct({action:x.Reset,reason:e,email:l}),d={workflowExecution:{workflowId:o,runId:n},workflowTaskFinishEventId:r,requestId:Ft(),reason:f};if(k(it)||O("1.24.0",k(N))){const u=[];!i&&!c&&u.push(C.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED),i&&u.push(C.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL),c&&u.push(C.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE),d.resetReapplyExcludeTypes=u,d.resetReapplyType=R.RESET_REAPPLY_TYPE_ALL_ELIGIBLE}else{let u;a?u=R.RESET_REAPPLY_TYPE_SIGNAL:u=R.RESET_REAPPLY_TYPE_NONE,d.resetReapplyType=u}return w(s,{notifyOnError:!1,options:{method:"POST",body:y(d)},params:{"execution.runId":n}})}async function jo(t,o=fetch){const n=e=>{console.error(e)},r=E("workflow",t);return w(r,{request:o,onError:n,handleError:n}).then($)}async function Mo(t,o,n){if(!k(lt))return[];try{let r=`ParentWorkflowId = "${o}"`;n&&(r+=` AND ParentRunId = "${n}"`);const{workflows:e}=await U(t,{query:r});return e}catch{return[]}}const to=t=>{if(!t.length)return{};const o={};return t.forEach(n=>{o[n.label]=pt(n.value)}),o};async function Ko({namespace:t,workflowId:o,taskQueue:n,workflowType:r,input:e,summary:a,details:i,encoding:c,searchAttributes:s}){const l=E("workflow",{namespace:t,workflowId:o});let f,d,u;if(e)try{f=await b(e,c)}catch{throw new Error("Could not encode input for starting workflow")}try{a&&(d=(await b(y(a),"json/plain"))[0]),i&&(u=(await b(y(i),"json/plain"))[0])}catch{console.error("Could not encode summary or details for starting workflow")}const m=y({workflowId:o,taskQueue:{name:n},workflowType:{name:r},input:f?{payloads:f}:null,userMetadata:{summary:d,details:u},searchAttributes:s.length===0?null:{indexedFields:{...to(s)}}});return w(l,{notifyOnError:!1,options:{method:"POST",body:m}})}const Ho=async({namespace:t,workflowType:o,workflowId:n})=>{var a,i,c;const r=s=>{console.error(s)},e={input:"",searchAttributes:void 0,summary:"",details:""};try{let s="";o&&n?s=`WorkflowType = "${o}" AND WorkflowId = "${n}"`:o?s=`WorkflowType = "${o}"`:n&&(s=`WorkflowId = "${n}"`);const l=E("workflows",{namespace:t}),f=await w(l,{params:{query:s,pageSize:"1"},handleError:r});if(!((a=f==null?void 0:f.executions)!=null&&a[0]))return e;const d=Y(f)[0],u={namespace:t,workflowId:d.id,runId:d.runId},{workflow:m}=await ut(u),S=await Ut(u),_=await St((i=S==null?void 0:S.attributes)==null?void 0:i.input,t,k(P).data.settings,k(D).accessToken);let W="";if(m.summary){const T=await rt(m.summary);typeof T=="string"&&(W=T)}let L="";if(m.details){const T=await rt(m.details);typeof T=="string"&&(L=T)}return{input:_!=null&&_.payloads?y(_.payloads[0]):"",searchAttributes:(c=m==null?void 0:m.searchAttributes)==null?void 0:c.indexedFields,summary:W,details:L}}catch{return e}},oo=(t,o)=>{const n=new Map;o.forEach(e=>{if(e.parent){const a=`${e.parent.workflowId}:${e.parent.runId}`,i=n.get(a)||[];i.push(e),n.set(a,i)}});const r=(e,a)=>{const i=`${e.id}:${e.runId}`,c=n.get(i)||[],s={workflow:e,children:[],rootPaths:[...a,{runId:e.runId,workflowId:e.id}]};return s.children=c.map(l=>r(l,s.rootPaths)),s};return r(t,[])};async function Jo(t,o,n){let r=`RootWorkflowId = "${o}"`;n&&(r+=` AND RootRunId = "${n}"`);const e=await ut({namespace:t,workflowId:o,runId:n}),a=await no(t,{query:r});return oo(e==null?void 0:e.workflow,a)}const no=async(t,o,n=fetch,r=!1)=>{const e=o.query||st(o,r);let a;try{a=decodeURIComponent(e)}catch{a=e}const i=E("workflows",{namespace:t}),{executions:c}=await Nt(async s=>w(i,{token:s,request:n,params:{query:a}}));return Y({executions:c})},ro=300,eo=async(t,o,n)=>{o.set(!0);try{await n()}catch(r){console.error(r)}t.set(!1),setTimeout(()=>{o.set(!1)},ro)},ao=h([P],([t])=>{var o,n,r;return!!((r=(n=(o=t.data)==null?void 0:o.systemInfo)==null?void 0:n.capabilities)!=null&&r.countGroupByExecutionStatus)}),Zo=h([P,N],([t,o])=>{var e,a,i;const n=O("1.23.0",o),r=!!((i=(a=(e=t.data)==null?void 0:e.systemInfo)==null?void 0:a.capabilities)!=null&&i.prefixSearch);return n||r}),io=g(0),so=h([P],([t])=>{var o,n;return(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.hideWorkflowQueryErrors}),tn=h([P],([t])=>{var o,n;return(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.refreshWorkflowCountsDisabled}),lt=h([it,N],([t,o])=>t||O("1.23.0",o)),co=h([P],([t])=>t.url.searchParams.get("query")),uo=h([co,lt,Yt],([t,o,n])=>o&&n&&!t?"ParentWorkflowId is NULL":t),lo=h([P],([t])=>t.params.namespace),fo=h([lo,uo,io,at,so],([t,o,n,r,e])=>({namespace:t,query:o,refresh:n,supportsAdvancedVisibility:r,hideWorkflowQueryErrors:e})),wo=t=>{ho.set({...t,newCount:0})},Eo=t=>fo.subscribe(({namespace:o,query:n,supportsAdvancedVisibility:r,hideWorkflowQueryErrors:e})=>{eo(ko,mo,async()=>{const{workflows:a,error:i}=await U(o,{query:n});if(t(a),r&&!k(ao)){const c=await qt(o,n);wo(c)}i?e?p.set(A("workflows.workflows-error-querying")):p.set(i):p.set("")})}),on=g(""),mo=g(!0),ko=g(!0),ho=g({count:0,newCount:0}),p=g(""),nn=yt([],Eo),rn=g("");export{Zt as A,ko as B,mo as C,p as D,nn as E,Zo as F,Bo as a,Uo as b,on as c,tn as d,Ho as e,qo as f,Ko as g,Vo as h,Fo as i,Bt as j,vo as k,st as l,Xo as m,Go as n,ut as o,jo as p,uo as q,io as r,to as s,Qo as t,zo as u,ao as v,ho as w,Mo as x,Jo as y,rn as z};

import{B as e}from"./prod-browser.CoG0geaG.js";import{g as $}from"./auth-user.B7EUYUd-.js";import{w as A}from"./entry.X9gWyk7r.js";import{t as C}from"./toaster.C7gmj8jk.js";import{h as b}from"./has.BnvKvYqj.js";import{i as R}from"./is-network-error.DxxRlstw.js";import{o as k,t as F}from"./route-for.B1gefYJC.js";import{i as O}from"./persist-store.DwqmoPsv.js";import{C as I}from"./scheduler.D6mQsyhd.js";import{b as W}from"./paths.UCCSAbhA.js";import{p as v}from"./stores.BqPKCHxX.js";const P=A(null),j=(o,n=C,i=P,c=e)=>{if(!(o instanceof DOMException&&o.name==="AbortError"))throw typeof o=="string"?n.push({variant:"error",message:o}):o.report=!1,o instanceof Error&&n.push({variant:"error",message:o.message}),T(o)&&c&&window.location.assign(k(o==null?void 0:o.message)),x(o)&&c&&window.location.assign(k(o==null?void 0:o.message)),R(o)&&(n.push({variant:"error",message:`${o.statusCode} ${o.statusText}`}),i.set(o)),o},sn=(o,n=e)=>{var c;const i=`${o==null?void 0:o.status} ${(c=o==null?void 0:o.body)==null?void 0:c.message}`;if(T(o)&&n){window.location.assign(k(i));return}if(x(o)&&n){window.location.assign(k(i));return}},T=o=>U(o,401),x=o=>U(o,403),U=(o,n)=>b(o,"statusCode")?o.statusCode===n:b(o,"status")?o.status===n:!1,un=async(o,n={})=>{const{params:i={},request:c=fetch,token:t,notifyOnError:s=!0,handleError:u=j,onError:f,isBrowser:g=e}=n;let{options:w}=n,h=new URLSearchParams;if(i!=null&&i.entries)h=i,t&&h.set("nextPageToken",t);else{const l=t?{next_page_token:t}:{};h=new URLSearchParams({...i,...l})}const q=F(o,h);try{w=S(w,g),o.endsWith("api/v1/settings")||(w=await _(w,g));const l=await c(q,w),d=await l.json(),{status:E,statusText:N}=l;if(!l.ok)if(f&&O(f))f({status:E,statusText:N,body:d});else throw{statusCode:l.status,statusText:l.statusText,response:l,message:(d==null?void 0:d.message)??l.statusText};return d}catch(l){if(s)u(l);else throw l}},S=(o,n=e)=>{const i={credentials:"include",...o};return i.headers=L(o==null?void 0:o.headers,n),i},_=async(o,n=e)=>(globalThis!=null&&globalThis.AccessToken?o.headers=await y(o==null?void 0:o.headers,globalThis.AccessToken,n):$().accessToken&&(o.headers=await y(o==null?void 0:o.headers,async()=>$().accessToken,n),o.headers=z(o==null?void 0:o.headers,$().idToken,n)),o),y=async(o,n,i=e)=>{if(o||(o={}),!i)return o;try{const c=await n();c&&(o.Authorization=`Bearer ${c}`)}catch(c){console.error(c)}return o},z=(o={},n,i=e)=>(i&&n&&(o["Authorization-Extras"]=n),o),L=(o,n=e)=>{if(o||(o={}),o["Caller-Type"]="operator",!n)return o;const i="_csrf=",c="X-CSRF-TOKEN";try{let s=document.cookie.split(";").find(u=>u.includes(i));s&&!o[c]&&(s=s.trim().slice(i.length),o[c]=s)}catch(t){console.error(t)}return o};function B(o=e){const n="",i=!n.startsWith("http");let c="";return i?c=o?window.location.origin+n:"":c=n,c.endsWith("/")&&(c=c.slice(0,-1)),c}const tn=(o,n)=>{if(!o||!n)return!1;const[i,c,t]=o.split(".").map(Number),[s,u,f]=n.split(".").map(Number);return i!==s?i>s:c!==u?c>u:t>f},J=(o,n)=>{if(!o||!n)return!1;const[i,c,t]=o.split(".").map(Number),[s,u,f]=n.split(".").map(Number);return i!==s?s>i:c!==u?c===void 0&&u||c===void 0&&u===void 0?!0:u>c:t===void 0&&f||t===void 0&&(f===void 0||isNaN(f))?!0:f>=t},D=(o,n)=>o?o.replace("%namespace%",n):"",H=o=>{var s,u;let n="";const i=(s=I(v).data)==null?void 0:s.webUrl,c=i&&o,t=((u=globalThis==null?void 0:globalThis.AppConfig)==null?void 0:u.apiUrl)&&o;return c?n=i:t?(console.warn("Using fallback api url, web url not found"),n=D(globalThis.AppConfig.apiUrl,o)):n=B(),n.endsWith("/")&&(n=n.slice(0,-1)),n=`${n}${W}`,n},K=o=>(o.startsWith("/")&&(o=o.slice(1)),`/api/v1/${o}`),M=(o,n)=>`${H(n)}${o}`,X=o=>{var i,c,t;const n=(t=(c=(i=I(v))==null?void 0:i.data)==null?void 0:c.settings)==null?void 0:t.version;return Object.keys(o??{}).reduce((s,u)=>(n&&J("2.23.0",n)?s[u]=encodeURIComponent(o[u]):s[u]=encodeURIComponent(encodeURIComponent(o[u])),s),{namespace:"",workflowId:"",scheduleId:"",queue:"",queryType:"",signalName:"",updateName:"",batchJobId:"",activityId:"",endpointId:""})};function G(o,n,i=!0){i&&(n=X(n));const c={systemInfo:"/system-info",cluster:"/cluster-info",namespaces:"/namespaces",namespace:`/namespaces/${n==null?void 0:n.namespace}`,"search-attributes":`/namespaces/${n.namespace}/search-attributes`,"events.ascending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/history`,"events.descending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/history-reverse`,query:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/query/${n.queryType}`,schedule:`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}`,"schedule.patch":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}/patch`,"schedule.edit":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}/update`,schedules:`/namespaces/${n==null?void 0:n.namespace}/schedules`,settings:"/settings","task-queue":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}`,"task-queue.compatibility":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}/worker-build-id-compatibility`,"task-queue.rules":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}/worker-versioning-rules`,user:"/me","worker-task-reachability":`/namespaces/${n==null?void 0:n.namespace}/worker-task-reachability`,"workflow.terminate":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/terminate`,"workflow.cancel":`/namespaces/${n.namespace}/workflows/${n.workflowId}/cancel`,"workflow.signal":`/namespaces/${n.namespace}/workflows/${n.workflowId}/signal/${n.signalName}`,"workflow.update":`/namespaces/${n.namespace}/workflows/${n.workflowId}/update/${n.updateName}`,"workflow.reset":`/namespaces/${n.namespace}/workflows/${n.workflowId}/reset`,workflow:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}`,workflows:`/namespaces/${n==null?void 0:n.namespace}/workflows`,"workflows.archived":`/namespaces/${n==null?void 0:n.namespace}/archived-workflows`,"workflows.count":`/namespaces/${n==null?void 0:n.namespace}/workflow-count`,"activity.complete":`/namespaces/${n.namespace}/activities/complete-by-id`,"activity.fail":`/namespaces/${n.namespace}/activities/fail-by-id`,"batch-operations.list":`/namespaces/${n.namespace}/batch-operations`,"batch-operations":`/namespaces/${n.namespace}/batch-operations/${n==null?void 0:n.batchJobId}`,"nexus-endpoints":"/nexus/endpoints","nexus-endpoint":`/nexus/endpoints/${n.endpointId}`,"nexus-endpoint.update":`/nexus/endpoints/${n.endpointId}/update`};return K(c[o])}function ln(o,n,i=!0){const c=G(o,n,i);return M(c,n==null?void 0:n.namespace)}export{un as a,H as b,sn as c,T as d,x as e,B as g,j as h,tn as i,J as m,P as n,G as p,ln as r};

import{s as ot,h as U,j as V,k as Y,f as w,m as rt,i as W,c as d,P as st,w as v,x as C,v as nt,b as at,d as lt,n as ut,p as ct}from"./scheduler.D6mQsyhd.js";import{S as it,i as ft,g as j,e as H,t as y,b as g,c as L,a as z,m as J,d as X}from"./index.CDeUyeTp.js";import{e as M,u as mt,o as pt}from"./each.5YhwczXz.js";import{p as _t}from"./stores.jq78OVXW.js";import{S as ht}from"./index.B6vKAamH.js";import{t as dt,c as wt,w as O}from"./translate.IH-p4h9O.js";import{r as kt,w as I,d as yt,q as gt,b as R}from"./workflows.D_XHVJ8-.js";import{w as A}from"./events.BePNbmiv.js";import{c as bt}from"./pagination.ClVdidqU.js";import{S as St}from"./time-picker.Dx1jX8ek.js";import{b as vt}from"./decode-payload.CgwoUprw.js";import{u as Ct}from"./update-query-parameters.DxwuO1aO.js";import{W as It}from"./workflow-status.CzCjZFN4.js";const N=(e,r,t)=>{const u=Math.pow(3600/e,1/t),i=e*Math.pow(u,r);return Math.min(3600,Math.round(i))};function D(e,r,t){const n=e.slice();return n[23]=r[t].count,n[24]=r[t].status,n}function Wt(e){let r,t;return r=new ht({props:{class:"h-6 w-24 rounded-sm"}}),{c(){L(r.$$.fragment)},l(n){z(r.$$.fragment,n)},m(n,u){J(r,n,u),t=!0},p:nt,i(n){t||(y(r.$$.fragment,n),t=!0)},o(n){g(r.$$.fragment,n),t=!1},d(n){X(r,n)}}}function Et(e){let r,t,n,u,i,m;function a(...l){return e[10](e[24],...l)}function o(...l){return e[11](e[24],...l)}t=new It({props:{status:e[24],count:e[23],newCount:e[1].find(a)?e[1].find(o).count-e[23]:0,"test-id":"workflow-status-"+e[24]}});function f(){return e[12](e[24])}return{c(){r=U("button"),L(t.$$.fragment),n=at()},l(l){r=V(l,"BUTTON",{});var c=Y(r);z(t.$$.fragment,c),n=lt(c),c.forEach(w)},m(l,c){W(l,r,c),J(t,r,null),ut(r,n),u=!0,i||(m=ct(r,"click",f),i=!0)},p(l,c){e=l;const _={};c&1&&(_.status=e[24]),c&1&&(_.count=e[23]),c&3&&(_.newCount=e[1].find(a)?e[1].find(o).count-e[23]:0),c&1&&(_["test-id"]="workflow-status-"+e[24]),t.$set(_)},i(l){u||(y(t.$$.fragment,l),u=!0)},o(l){g(t.$$.fragment,l),u=!1},d(l){l&&w(r),X(t),i=!1,m()}}}function G(e,r){let t,n,u,i,m;const a=[Et,Wt],o=[];function f(l,c){return l[2]?1:0}return n=f(r),u=o[n]=a[n](r),{key:e,first:null,c(){t=C(),u.c(),i=C(),this.h()},l(l){t=C(),u.l(l),i=C(),this.h()},h(){this.first=t},m(l,c){W(l,t,c),o[n].m(l,c),W(l,i,c),m=!0},p(l,c){r=l;let _=n;n=f(r),n===_?o[n].p(r,c):(j(),g(o[_],1,1,()=>{o[_]=null}),H(),u=o[n],u?u.p(r,c):(u=o[n]=a[n](r),u.c()),y(u,1),u.m(i.parentNode,i))},i(l){m||(y(u),m=!0)},o(l){g(u),m=!1},d(l){l&&(w(t),w(i)),o[n].d(l)}}}function Ft(e){let r,t=[],n=new Map,u,i=M(e[0]);const m=a=>a[24];for(let a=0;a<i.length;a+=1){let o=D(e,i,a),f=m(o);n.set(f,t[a]=G(f,o))}return{c(){r=U("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){r=V(a,"DIV",{class:!0});var o=Y(r);for(let f=0;f<t.length;f+=1)t[f].l(o);o.forEach(w),this.h()},h(){rt(r,"class","flex min-h-[24px] flex-wrap items-center gap-2")},m(a,o){W(a,r,o);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(r,null);u=!0},p(a,[o]){o&15&&(i=M(a[0]),j(),t=mt(t,o,m,1,a,i,n,r,pt,G,null,D),H())},i(a){if(!u){for(let o=0;o<i.length;o+=1)y(t[o]);u=!0}},o(a){for(let o=0;o<t.length;o+=1)g(t[o]);u=!1},d(a){a&&w(r);for(let o=0;o<t.length;o+=1)t[o].d()}}}const K=5,P=100;function Pt(e,r,t){let n,u,i,m,a,o,f,l;d(e,kt,s=>t(7,i=s)),d(e,_t,s=>t(8,m=s)),d(e,A,s=>t(15,a=s)),d(e,I,s=>t(16,o=s)),d(e,yt,s=>t(17,f=s)),d(e,gt,s=>t(9,l=s));let{staticQuery:c=""}=r,_=[],E=[],b,k=1,S=!1;st(()=>{Q()});const Z=()=>{if(k+=1,clearInterval(b),k<=P){const s=N(K,k,P)*1e3;b=setInterval(()=>B(),s)}},Q=()=>{clearInterval(b),t(1,E=[]),v(I,o.newCount=0,o),k=1,t(2,S=!0)},q=(s=[])=>s.map(p=>{const h=vt(p==null?void 0:p.groupValues[0]),F=parseInt(p.count);return{status:h,count:F}}).sort((p,h)=>O.indexOf(p.status)-O.indexOf(h.status)),B=async()=>{Z();try{const{count:s,groups:p}=await R({namespace:n,query:u});v(I,o.newCount=parseInt(s)-o.count,o),t(1,E=q(p))}catch(s){console.error("Fetching workflow counts failed: ",s==null?void 0:s.message)}finally{t(2,S=!1)}},x=async()=>{if(Q(),!f){const s=N(K,k,P)*1e3;b=setInterval(()=>B(),s)}try{const{count:s,groups:p}=await R({namespace:n,query:u});v(I,o.count=parseInt(s),o),t(0,_=q(p))}catch(s){console.error("Fetching workflow counts failed: ",s==null?void 0:s.message)}finally{t(2,S=!1)}},T=s=>{if(!a.some(h=>h.attribute==="ExecutionStatus"&&h.value===s)){const h={attribute:"ExecutionStatus",type:St.KEYWORD,value:s,operator:"",conditional:"=",parenthesis:""};v(A,a=[...a,h],a);const F=dt(wt(a));Ct({url:m.url,parameter:"query",value:F,clearParameters:[bt]})}},$=(s,p)=>p.status===s,tt=(s,p)=>p.status===s,et=s=>T(s);return e.$$set=s=>{"staticQuery"in s&&t(4,c=s.staticQuery)},e.$$.update=()=>{e.$$.dirty&256&&t(5,n=m.params.namespace),e.$$.dirty&528&&t(6,u=c||l),e.$$.dirty&224&&x()},[_,E,S,T,c,n,u,i,m,l,$,tt,et]}class Vt extends it{constructor(r){super(),ft(this,r,Pt,Ft,ot,{staticQuery:4})}}export{Vt as W};

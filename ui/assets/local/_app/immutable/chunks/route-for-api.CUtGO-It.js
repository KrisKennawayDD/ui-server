import{B as e}from"./prod-browser.CoG0geaG.js";import{g as $}from"./auth-user.Ch4CLKx_.js";import{w as C}from"./entry.uT70Ww1M.js";import{t as N}from"./toaster.DTz4Hl15.js";import{h as b}from"./has.HNIa2swf.js";import{i as R}from"./is-network-error.C2uLOQyq.js";import{q as h,t as F}from"./route-for.9C2XsIO9.js";import{i as O}from"./persist-store.BO49gEsH.js";import{B as I}from"./scheduler.CnYDgCRb.js";import{b as W}from"./paths.BzKcEI5Y.js";import{p as v}from"./stores.i3D8lgmP.js";import{m as P}from"./version-check.8b9VeVr0.js";const S=C(null),_=(o,n=N,c=S,i=e)=>{if(!(o instanceof DOMException&&o.name==="AbortError"))throw typeof o=="string"?n.push({variant:"error",message:o}):o.report=!1,o instanceof Error&&n.push({variant:"error",message:o.message}),T(o)&&i&&window.location.assign(h(o==null?void 0:o.message)),q(o)&&i&&window.location.assign(h(o==null?void 0:o.message)),R(o)&&(n.push({variant:"error",message:`${o.statusCode} ${o.statusText}`}),c.set(o)),o},ln=(o,n=e)=>{var i;const c=`${o==null?void 0:o.status} ${(i=o==null?void 0:o.body)==null?void 0:i.message}`;if(T(o)&&n){window.location.assign(h(c));return}if(q(o)&&n){window.location.assign(h(c));return}},T=o=>x(o,401),q=o=>x(o,403),x=(o,n)=>b(o,"statusCode")?o.statusCode===n:b(o,"status")?o.status===n:!1,un=async(o,n={})=>{const{params:c={},request:i=fetch,token:l,notifyOnError:s=!0,handleError:t=_,onError:k,isBrowser:g=e}=n;let{options:w}=n,d=new URLSearchParams;if(c!=null&&c.entries)d=c,l&&d.set("nextPageToken",l);else{const u=l?{next_page_token:l}:{};d=new URLSearchParams({...c,...u})}const U=F(o,d);try{w=z(w,g),o.endsWith("api/v1/settings")||(w=await L(w,g));const u=await i(U,w),f=await u.json(),{status:E,statusText:A}=u;if(!u.ok)if(k&&O(k))k({status:E,statusText:A,body:f});else throw{statusCode:u.status,statusText:u.statusText,response:u,message:(f==null?void 0:f.message)??u.statusText};return f}catch(u){if(s)t(u);else throw u}},z=(o,n=e)=>{const c={credentials:"include",...o};return c.headers=j(o==null?void 0:o.headers,n),c},L=async(o,n=e)=>(globalThis!=null&&globalThis.AccessToken?o.headers=await y(o==null?void 0:o.headers,globalThis.AccessToken,n):$().accessToken&&(o.headers=await y(o==null?void 0:o.headers,async()=>$().accessToken,n),o.headers=B(o==null?void 0:o.headers,$().idToken,n)),o),y=async(o,n,c=e)=>{if(o||(o={}),!c)return o;try{const i=await n();i&&(o.Authorization=`Bearer ${i}`)}catch(i){console.error(i)}return o},B=(o={},n,c=e)=>(c&&n&&(o["Authorization-Extras"]=n),o),j=(o,n=e)=>{if(o||(o={}),o["Caller-Type"]="operator",!n)return o;const c="_csrf=",i="X-CSRF-TOKEN";try{let s=document.cookie.split(";").find(t=>t.includes(c));s&&!o[i]&&(s=s.trim().slice(c.length),o[i]=s)}catch(l){console.error(l)}return o};function J(o=e){const n="",c=!n.startsWith("http");let i="";return c?i=o?window.location.origin+n:"":i=n,i.endsWith("/")&&(i=i.slice(0,-1)),i}const D=(o,n)=>o?o.replace("%namespace%",n):"",H=o=>{var s,t;let n="";const c=(s=I(v).data)==null?void 0:s.webUrl,i=c&&o,l=((t=globalThis==null?void 0:globalThis.AppConfig)==null?void 0:t.apiUrl)&&o;return i?n=c:l?(console.warn("Using fallback api url, web url not found"),n=D(globalThis.AppConfig.apiUrl,o)):n=J(),n.endsWith("/")&&(n=n.slice(0,-1)),n=`${n}${W}`,n},K=o=>(o.startsWith("/")&&(o=o.slice(1)),`/api/v1/${o}`),M=(o,n)=>`${H(n)}${o}`,V=o=>{var c,i,l;const n=(l=(i=(c=I(v))==null?void 0:c.data)==null?void 0:i.settings)==null?void 0:l.version;return Object.keys(o??{}).reduce((s,t)=>(n&&P("2.23.0",n)?s[t]=encodeURIComponent(o[t]):s[t]=encodeURIComponent(encodeURIComponent(o[t])),s),{namespace:"",workflowId:"",scheduleId:"",queue:"",queryType:"",signalName:"",updateName:"",batchJobId:"",activityId:"",endpointId:"",deploymentName:"",version:""})};function X(o,n,c=!0){c&&(n=V(n));const i={systemInfo:"/system-info",cluster:"/cluster-info",namespaces:"/namespaces",namespace:`/namespaces/${n==null?void 0:n.namespace}`,"search-attributes":`/namespaces/${n.namespace}/search-attributes`,"events.ascending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/history`,"events.descending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/history-reverse`,query:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/query/${n.queryType}`,schedule:`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}`,"schedule.patch":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}/patch`,"schedule.edit":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}/update`,schedules:`/namespaces/${n==null?void 0:n.namespace}/schedules`,settings:"/settings","task-queue":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}`,"task-queue.compatibility":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}/worker-build-id-compatibility`,"task-queue.rules":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}/worker-versioning-rules`,user:"/me","worker-task-reachability":`/namespaces/${n==null?void 0:n.namespace}/worker-task-reachability`,"workflow.terminate":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/terminate`,"workflow.cancel":`/namespaces/${n.namespace}/workflows/${n.workflowId}/cancel`,"workflow.signal":`/namespaces/${n.namespace}/workflows/${n.workflowId}/signal/${n.signalName}`,"workflow.update":`/namespaces/${n.namespace}/workflows/${n.workflowId}/update/${n.updateName}`,"workflow.reset":`/namespaces/${n.namespace}/workflows/${n.workflowId}/reset`,workflow:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}`,workflows:`/namespaces/${n==null?void 0:n.namespace}/workflows`,"workflows.archived":`/namespaces/${n==null?void 0:n.namespace}/archived-workflows`,"workflows.count":`/namespaces/${n==null?void 0:n.namespace}/workflow-count`,"activity.complete":`/namespaces/${n.namespace}/activities/complete-by-id`,"activity.fail":`/namespaces/${n.namespace}/activities/fail-by-id`,"batch-operations.list":`/namespaces/${n.namespace}/batch-operations`,"batch-operations":`/namespaces/${n.namespace}/batch-operations/${n==null?void 0:n.batchJobId}`,"nexus-endpoints":"/nexus/endpoints","nexus-endpoint":`/nexus/endpoints/${n.endpointId}`,"nexus-endpoint.update":`/nexus/endpoints/${n.endpointId}/update`,"worker-deployments":`/namespaces/${n.namespace}/worker-deployments`,"worker-deployment":`/namespaces/${n.namespace}/worker-deployments/${n.deploymentName}`,"worker-deployment-version":`/namespaces/${n.namespace}/worker-deployment-versions/${n.version}`};return K(i[o])}function tn(o,n,c=!0){const i=X(o,n,c);return M(i,n==null?void 0:n.namespace)}export{un as a,H as b,ln as c,q as d,J as g,_ as h,T as i,S as n,X as p,tn as r};

import{s as L,h as y,b,j as E,k as N,d as w,f as g,m as u,i as C,n as _,p as U,c as j,t as G,l as H,v as T}from"./scheduler.CnYDgCRb.js";import{S as q,i as D,c as x,a as I,m as S,t as F,b as k,d as A}from"./index.DW7Zsqzm.js";import{g as P}from"./entry.D7YgKbOW.js";import{B as R}from"./button.CuvPw0S-.js";import{L as V}from"./label.DRY4v8k1.js";import{t as d}from"./translate.BBe5dcco.js";import{g as W}from"./index.DCZL9bww.js";import{t as z}from"./index.C94kNXB9.js";import{i as J,a as K}from"./import-events.CoHFxKog.js";import{l as M}from"./namespaces.BMc9mIB-.js";import{t as B}from"./toaster.CUfkcZqU.js";import{p as O}from"./parse-with-big-int.DJQKqIvA.js";import{r as Q}from"./route-for.D3SMXn6q.js";function X(m){let t=d("common.import")+"",r;return{c(){r=G(t)},l(n){r=H(n,t)},m(n,o){C(n,r,o)},p:T,d(n){n&&g(r)}}}function Y(m){let t,r,n,o,p,i,f,a,c;return r=new V({props:{hidden:!0,for:"import-event-history-file-upload",label:d("events.import-event-history-file-upload")}}),i=new R({props:{leadingIcon:"file-upload",disabled:!m[0],$$slots:{default:[X]},$$scope:{ctx:m}}}),i.$on("click",m[2]),{c(){t=y("div"),x(r.$$.fragment),n=b(),o=y("input"),p=b(),x(i.$$.fragment),this.h()},l(e){t=E(e,"DIV",{class:!0});var s=N(t);I(r.$$.fragment,s),n=w(s),o=E(s,"INPUT",{id:!0,class:!0,type:!0,accept:!0}),p=w(s),I(i.$$.fragment,s),s.forEach(g),this.h()},h(){u(o,"id","import-event-history-file-upload"),u(o,"class","import-input block border border-slate-200 p-2"),u(o,"type","file"),u(o,"accept",".json"),u(t,"class","flex flex-col items-start gap-2 md:flex-row md:items-center")},m(e,s){C(e,t,s),S(r,t,null),_(t,n),_(t,o),_(t,p),S(i,t,null),f=!0,a||(c=U(o,"change",m[1]),a=!0)},p(e,[s]){const l={};s&1&&(l.disabled=!e[0]),s&32&&(l.$$scope={dirty:s,ctx:e}),i.$set(l)},i(e){f||(F(r.$$.fragment,e),F(i.$$.fragment,e),f=!0)},o(e){k(r.$$.fragment,e),k(i.$$.fragment,e),f=!1},d(e){e&&g(t),A(r),A(i),a=!1,c()}}}function Z(m,t,r){let n;j(m,M,a=>r(4,n=a));let o,p=!1;return[p,async a=>{var c;const e=a.target,s=(c=e==null?void 0:e.files)===null||c===void 0?void 0:c[0],l=new FileReader;s&&(l.readAsText(s),l.onload=()=>{var v,h;try{const $=(h=(v=l==null?void 0:l.result)===null||v===void 0?void 0:v.toString())!==null&&h!==void 0?h:"";o=O($),r(0,p=!0)}catch{B.push({variant:"error",message:d("events.event-history-load-error")}),r(0,p=!1)}})},async()=>{try{const a=await z(Array.isArray(o)?o:o==null?void 0:o.events),c=W(a);J.set(a),K.set(c),r(0,p=!1);const e=Q(n,"feed");P(e)}catch(a){console.error(a),B.push({variant:"error",message:d("events.event-history-import-error")})}}]}class ue extends q{constructor(t){super(),D(this,t,Z,Y,L,{})}}export{ue as E};

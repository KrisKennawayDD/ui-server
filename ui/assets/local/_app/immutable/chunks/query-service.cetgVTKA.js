import{e as d}from"./decode-payload.CMT3ieS5.js";import{h as y}from"./has.BnvKvYqj.js";import{s as c}from"./parse-with-big-int.BKSBwM2t.js";import{r as f,a as m}from"./route-for-api.Cn4br8WT.js";const p=t=>{const e=t.indexOf("["),a=t.indexOf("]");return t.slice(e+1,a).split(" ").filter(r=>r!=="__stack_trace").map(r=>r.endsWith(",")?{name:r.slice(0,r.length-1)}:{name:r})},l=async(t,e,a)=>(e=await e,{namespace:t,workflowId:e.id,queryType:a});async function _({workflow:t,namespace:e,queryType:a,queryArgs:r},i){t=await t;const n=await l(e,t,a),s=f("query",n);return await m(s,{options:{method:"POST",body:c({execution:{workflowId:t.id,runId:t.runId},query:{queryType:a,queryArgs:r}}),signal:i},request:fetch,notifyOnError:!1})}async function x(t,e,a,r){var i;try{return await u({...t,queryType:"__temporal_workflow_metadata"},e,a,r)}catch(n){return(i=n.message)!=null&&i.includes("__temporal_workflow_metadata")?{definition:{queryDefinitions:p(n.message)}}:{error:n}}}async function u(t,e,a,r){return _(t,r).then(async i=>{const{queryResult:n}=i??{queryResult:{payloads:[]}};let s=n.payloads;try{if(s[0]){const o=await d({attributes:n,namespace:t.namespace,settings:e,accessToken:a});y(o,"payloads")&&Array.isArray(o.payloads)&&(s=o.payloads[0])}return s}catch{return typeof s!="string"?c(s):s}})}async function I(t,e,a){return u({...t,queryType:"__stack_trace"},e,a)}export{u as a,x as b,I as g};

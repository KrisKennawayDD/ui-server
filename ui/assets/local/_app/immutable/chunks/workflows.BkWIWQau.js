import{d as A,r as Vt,w as L}from"./entry.CVhMveIj.js";import{p as R}from"./stores.WX_QxltC.js";import{t as T}from"./translate.BBe5dcco.js";import{r as y,a as h,b as Qt,p as Gt,c as zt,i as Xt,d as Mt}from"./route-for-api.Dwgw9ycK.js";import{s as Kt,h as K,t as Ht,b as v,j as H,k as J,l as Jt,f as S,d as B,m as Z,i as V,n as $,q as Zt,O as tt,a as to,a4 as ot,u as oo,g as no,e as eo,v as Nt,P as ao,B as I}from"./scheduler.CnYDgCRb.js";import{S as ro,i as io,c as N,a as D,m as O,t as P,b,d as j,h as nt,g as Dt,e as Ot}from"./index.DW7Zsqzm.js";import{C as so}from"./card.DK3n6meh.js";import{I as lo}from"./input.71fMPCxR.js";import{R as uo,a as Wt}from"./radio-input.Cqz-3m-R.js";import{P as co}from"./payload-input.DBtNCN-L.js";import{v as jt}from"./v4.BOvFkHkt.js";import{A as F}from"./workflow-actions.TBME1SPK.js";import{b as fo,c as wo,a as Ct}from"./decode-payload.C6Tmj9H5.js";import{g as mo,h as Eo,i as go}from"./screaming-enums.UO4RgiCl.js";import{s as _o,t as st}from"./versions.ZovJwL14.js";import{s as ho}from"./index.qDeG_Q-b.js";import{s as Ut,i as $t}from"./advanced-visibility.BaKhaugv.js";import{a as lt}from"./auth-user.BeY95IZX.js";import{i as ko,m as ut}from"./version-check.8b9VeVr0.js";import{h as po}from"./events.B4SUFASc.js";import{e as q,s as yo}from"./encode-payload.0ARNwUkw.js";import{p as Po}from"./paginated.BkCkBPuF.js";import{s as C}from"./parse-with-big-int.DJQKqIvA.js";import{i as bo,c as Io,d as Rt,e as To}from"./format-time.D8nHWdIk.js";import{a as So}from"./events-service.CyXt_Fb0.js";const Ao=async(t,o,n=fetch)=>{let e=0;try{const r=y("workflows.count",{namespace:t}),a=await h(r,{params:o?{query:o}:{},onError:()=>{},handleError:()=>{},request:n});e=parseInt((a==null?void 0:a.count)||"0")}catch{}return{count:e}},jn=async({namespace:t,query:o})=>{const n="GROUP BY ExecutionStatus",e=y("workflows.count",{namespace:t}),{count:r,groups:a}=await h(e,{params:{query:o?`${o} ${n}`:`${n}`},notifyOnError:!1});return{count:r??"0",groups:a}},Un=async({namespace:t})=>{const o='TemporalNamespaceDivision="TemporalScheduler" AND ExecutionStatus="Running"',n=y("workflows.count",{namespace:t}),{count:e}=await h(n,{params:{query:o},notifyOnError:!1});return e??"0"},Wo=t=>({}),Lt=t=>({});function Yt(t){let o,n,e,r,a;function s(u){t[12](u)}let l={description:T("workflows.encoding"),name:"encoding",$$slots:{default:[Co]},$$scope:{ctx:t}};t[2]!==void 0&&(l.group=t[2]),n=new uo({props:l}),tt.push(()=>nt(n,"group",s));let i=t[8]==="json/protobuf"&&xt(t);return{c(){o=K("div"),N(n.$$.fragment),r=v(),i&&i.c(),this.h()},l(u){o=H(u,"DIV",{class:!0});var d=J(o);D(n.$$.fragment,d),r=B(d),i&&i.l(d),d.forEach(S),this.h()},h(){Z(o,"class","flex w-full flex-col gap-2")},m(u,d){V(u,o,d),O(n,o,null),$(o,r),i&&i.m(o,null),a=!0},p(u,d){const m={};d&16384&&(m.$$scope={dirty:d,ctx:u}),!e&&d&4&&(e=!0,m.group=u[2],ot(()=>e=!1)),n.$set(m),u[8]==="json/protobuf"?i?(i.p(u,d),d&256&&P(i,1)):(i=xt(u),i.c(),P(i,1),i.m(o,null)):i&&(Dt(),b(i,1,1,()=>{i=null}),Ot())},i(u){a||(P(n.$$.fragment,u),P(i),a=!0)},o(u){b(n.$$.fragment,u),b(i),a=!1},d(u){u&&S(o),j(n),i&&i.d()}}}function Co(t){let o,n,e,r;return o=new Wt({props:{id:"json/plain",value:"json/plain",label:"json/plain"}}),e=new Wt({props:{id:"json/protobuf",value:"json/protobuf",label:"json/protobuf"}}),{c(){N(o.$$.fragment),n=v(),N(e.$$.fragment)},l(a){D(o.$$.fragment,a),n=B(a),D(e.$$.fragment,a)},m(a,s){O(o,a,s),V(a,n,s),O(e,a,s),r=!0},p:Nt,i(a){r||(P(o.$$.fragment,a),P(e.$$.fragment,a),r=!0)},o(a){b(o.$$.fragment,a),b(e.$$.fragment,a),r=!1},d(a){a&&S(n),j(o,a),j(e,a)}}}function xt(t){let o,n,e;function r(s){t[13](s)}let a={label:T("workflows.message-type"),error:t[5],id:"messageType"};return t[0]!==void 0&&(a.value=t[0]),o=new lo({props:a}),tt.push(()=>nt(o,"value",r)),{c(){N(o.$$.fragment)},l(s){D(o.$$.fragment,s)},m(s,l){O(o,s,l),e=!0},p(s,l){const i={};l&32&&(i.error=s[5]),!n&&l&1&&(n=!0,i.value=s[0],ot(()=>n=!1)),o.$set(i)},i(s){e||(P(o.$$.fragment,s),e=!0)},o(s){b(o.$$.fragment,s),e=!1},d(s){j(o,s)}}}function Ro(t){let o,n,e,r,a,s,l,i;function u(f){t[10](f)}function d(f){t[11](f)}let m={error:t[5],id:t[4],editing:t[7]};t[1]!==void 0&&(m.input=t[1]),t[3]!==void 0&&(m.loading=t[3]),o=new co({props:m}),tt.push(()=>nt(o,"input",u)),tt.push(()=>nt(o,"loading",d));let c=t[7]&&Yt(t);const _=t[9].action,E=to(_,t,t[14],Lt);return{c(){N(o.$$.fragment),r=v(),a=K("div"),c&&c.c(),s=v(),E&&E.c(),this.h()},l(f){D(o.$$.fragment,f),r=B(f),a=H(f,"DIV",{class:!0});var g=J(a);c&&c.l(g),s=B(g),E&&E.l(g),g.forEach(S),this.h()},h(){Z(a,"class",l="flex items-end gap-2 "+(t[7]?"justify-between":"justify-end"))},m(f,g){O(o,f,g),V(f,r,g),V(f,a,g),c&&c.m(a,null),$(a,s),E&&E.m(a,null),i=!0},p(f,g){const k={};g&32&&(k.error=f[5]),g&16&&(k.id=f[4]),g&128&&(k.editing=f[7]),!n&&g&2&&(n=!0,k.input=f[1],ot(()=>n=!1)),!e&&g&8&&(e=!0,k.loading=f[3],ot(()=>e=!1)),o.$set(k),f[7]?c?(c.p(f,g),g&128&&P(c,1)):(c=Yt(f),c.c(),P(c,1),c.m(a,s)):c&&(Dt(),b(c,1,1,()=>{c=null}),Ot()),E&&E.p&&(!i||g&16384)&&oo(E,_,f,f[14],i?eo(_,f[14],g,Wo):no(f[14]),Lt),(!i||g&128&&l!==(l="flex items-end gap-2 "+(f[7]?"justify-between":"justify-end")))&&Z(a,"class",l)},i(f){i||(P(o.$$.fragment,f),P(c),P(E,f),i=!0)},o(f){b(o.$$.fragment,f),b(c),b(E,f),i=!1},d(f){f&&(S(r),S(a)),j(o,f),c&&c.d(),E&&E.d(f)}}}function Lo(t){let o,n,e,r,a,s;return a=new so({props:{class:"flex flex-col gap-2",$$slots:{default:[Ro]},$$scope:{ctx:t}}}),{c(){o=K("div"),n=K("h5"),e=Ht(t[6]),r=v(),N(a.$$.fragment),this.h()},l(l){o=H(l,"DIV",{});var i=J(o);n=H(i,"H5",{class:!0});var u=J(n);e=Jt(u,t[6]),u.forEach(S),r=B(i),D(a.$$.fragment,i),i.forEach(S),this.h()},h(){Z(n,"class","pb-1 text-sm font-medium")},m(l,i){V(l,o,i),$(o,n),$(n,e),$(o,r),O(a,o,null),s=!0},p(l,[i]){(!s||i&64)&&Zt(e,l[6]);const u={};i&16831&&(u.$$scope={dirty:i,ctx:l}),a.$set(u)},i(l){s||(P(a.$$.fragment,l),s=!0)},o(l){b(a.$$.fragment,l),s=!1},d(l){l&&S(o),j(a)}}}const Yo=["json/plain","json/protobuf"],xo=t=>Yo.includes(t);function No(t,o,n){let e,r=Nt,a=()=>(r(),r=ao(d,w=>n(8,e=w)),d);t.$$.on_destroy.push(()=>r());let{$$slots:s={},$$scope:l}=o,{id:i=jt()}=o,{input:u}=o,{encoding:d}=o;a();let{messageType:m}=o,{error:c=!1}=o,{loading:_=!1}=o,{label:E=T("workflows.input")}=o,{editing:f=!0}=o;function g(w){u=w,n(1,u)}function k(w){_=w,n(3,_)}function Y(w){d=w,a(n(2,d))}function x(w){m=w,n(0,m),n(8,e)}return t.$$set=w=>{"id"in w&&n(4,i=w.id),"input"in w&&n(1,u=w.input),"encoding"in w&&a(n(2,d=w.encoding)),"messageType"in w&&n(0,m=w.messageType),"error"in w&&n(5,c=w.error),"loading"in w&&n(3,_=w.loading),"label"in w&&n(6,E=w.label),"editing"in w&&n(7,f=w.editing),"$$scope"in w&&n(14,l=w.$$scope)},t.$$.update=()=>{t.$$.dirty&257&&e==="json/plain"&&m&&n(0,m="")},[m,u,d,_,i,c,E,f,e,s,g,k,Y,x,l]}class $n extends ro{constructor(o){super(),io(this,o,No,Lo,Kt,{id:4,input:1,encoding:2,messageType:0,error:5,loading:3,label:6,editing:7})}}const Do=(t=_o)=>!I(t).disableWriteActions,Oo=(t=[])=>t.map(o=>{const n=ho(o,!0),e=o.activityId;return{...n,id:e}}),jo=t=>t?t.map(o=>({...o,state:Eo(o.state)})):[],Uo=t=>t?t.map(o=>({...o,state:go(o.state)})):[],$o=t=>!t||!t.indexedFields?{}:{indexedFields:Object.entries(t.indexedFields).reduce((n,[e,r])=>({...n,[e]:fo(r)}),{})},ct=t=>{var wt,mt,Et,gt,_t,ht,kt,pt,yt,Pt,bt,It,Tt,St,At;const o=$o(t.workflowExecutionInfo.searchAttributes),n=t.workflowExecutionInfo.memo,e=t.workflowExecutionInfo.type.name,r=t.workflowExecutionInfo.execution.workflowId,a=t.workflowExecutionInfo.execution.runId,s=t.workflowExecutionInfo.startTime,l=t.workflowExecutionInfo.closeTime,i=t.workflowExecutionInfo.executionTime,u=mo(t.workflowExecutionInfo.status),d=u==="Running",m=t.workflowExecutionInfo.historyLength,c=t.workflowExecutionInfo.historySizeBytes,_=`/workflows/${r}/${a}`,E=((mt=(wt=t==null?void 0:t.executionConfig)==null?void 0:wt.taskQueue)==null?void 0:mt.name)||((Et=t==null?void 0:t.workflowExecutionInfo)==null?void 0:Et.taskQueue),f=(gt=t==null?void 0:t.workflowExecutionInfo)==null?void 0:gt.mostRecentWorkerVersionStamp,g=(_t=t==null?void 0:t.workflowExecutionInfo)==null?void 0:_t.assignedBuildId,k=(ht=t==null?void 0:t.workflowExecutionInfo)==null?void 0:ht.parentNamespaceId,Y=(kt=t==null?void 0:t.workflowExecutionInfo)==null?void 0:kt.parentExecution,x=t.workflowExecutionInfo.stateTransitionCount,w=(pt=t.executionConfig)==null?void 0:pt.defaultWorkflowTaskTimeout,dt=Oo(t.pendingActivities),U=(t==null?void 0:t.pendingChildren)??[],p=jo(t==null?void 0:t.pendingNexusOperations),Q=t==null?void 0:t.pendingWorkflowTask,G=Uo(t==null?void 0:t.callbacks),at=(yt=t.workflowExecutionInfo)==null?void 0:yt.rootExecution,rt=(Pt=t.workflowExecutionInfo)==null?void 0:Pt.versioningInfo;let z,W;return(bt=t==null?void 0:t.executionConfig)!=null&&bt.userMetadata&&(z=(Tt=(It=t==null?void 0:t.executionConfig)==null?void 0:It.userMetadata)==null?void 0:Tt.summary,W=(At=(St=t==null?void 0:t.executionConfig)==null?void 0:St.userMetadata)==null?void 0:At.details),{name:e,id:r,runId:a,startTime:s,endTime:l,executionTime:i,status:u,historyEvents:m,historySizeBytes:c,searchAttributes:o,memo:n,rootExecution:at,url:_,taskQueue:E,assignedBuildId:g,mostRecentWorkerVersionStamp:f,pendingActivities:dt,pendingChildren:U,pendingNexusOperations:p,pendingWorkflowTask:Q,callbacks:G,versioningInfo:rt,summary:z,details:W,parentNamespaceId:k,parent:Y,stateTransitionCount:x,isRunning:d,defaultWorkflowTaskTimeout:w,get canBeTerminated(){return d&&Do()}}},et=t=>(t.executions||[]).map(o=>ct({workflowExecutionInfo:o}));var X=(t=>(t[t.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED",t[t.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL=1]="RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL",t[t.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE=2]="RESET_REAPPLY_EXCLUDE_TYPE_UPDATE",t))(X||{}),M=(t=>(t[t.RESET_REAPPLY_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_TYPE_UNSPECIFIED",t[t.RESET_REAPPLY_TYPE_SIGNAL=1]="RESET_REAPPLY_TYPE_SIGNAL",t[t.RESET_REAPPLY_TYPE_NONE=2]="RESET_REAPPLY_TYPE_NONE",t[t.RESET_REAPPLY_TYPE_ALL_ELIGIBLE=3]="RESET_REAPPLY_TYPE_ALL_ELIGIBLE",t))(M||{});const Fo={workflowId:"WorkflowId",workflowType:"WorkflowType",timeRange:"StartTime",executionStatus:"ExecutionStatus",closeTime:"CloseTime"},qo=["workflowId","workflowType","timeRange","executionStatus","closeTime"],vo=t=>!(t===null||t===void 0||t===""||typeof t=="string"&&t==="undefined"),Bo=t=>{if(typeof t!="string")return!1;for(const o of qo)if(o===t)return!0;return!1},Vo=(t,o,n)=>{const e=Fo[t];return o==="All"?"":bo(o)||Io(o)?n||I(Ut)?`${e} > "${Rt(o)}"`:`${e} BETWEEN "${Rt(o)}" AND "${To()}"`:`${e}="${o}"`},Qo=(t,o)=>Object.entries(t).map(([n,e])=>{if(Bo(n)&&vo(e))return Vo(n,e,o)}).filter(Boolean),Ft=(t,o=!1)=>Qo(t,o).join(" and ");function Go(t){console.error("Unhandled action:",t)}const zo=(t,o)=>{let n;switch(t){case F.Cancel:n=T("workflows.canceled");break;case F.Reset:n=T("workflows.reset");break;case F.Terminate:n=T("workflows.terminated");break;default:Go(t)}return o?T("workflows.workflow-action-reason-placeholder-with-email",{action:n,email:o}):T("workflows.workflow-action-reason-placeholder",{action:n})},qt=({action:t,reason:o,email:n})=>{const e=zo(t,n);return o?[o.trim(),e].join(" "):e},ft=async(t,o,n=fetch,e=!1)=>{const r=o.query||Ft(o,e);let a;try{a=decodeURIComponent(r)}catch{a=r}const s=e?"workflows.archived":"workflows";let l="";const i=c=>{var _,E;zt(c),(_=c==null?void 0:c.body)!=null&&_.message||c!=null&&c.status?l=((E=c==null?void 0:c.body)==null?void 0:E.message)??`Error fetching workflows: ${c.status}: ${c.statusText}`:l="Error fetching workflows: Server failed to respond"},u=y(s,{namespace:t}),{executions:d,nextPageToken:m}=await h(u,{params:{query:a},onError:i,handleError:i,request:n})??{executions:[],nextPageToken:""};return{workflows:et({executions:d}),nextPageToken:String(m),error:l}},Fn=async({namespace:t,workflowId:o,url:n},e=fetch)=>{var d;const r="workflows",a=n??Qt(t),s=Gt(r,{namespace:t}),l=a+s,{executions:i}=await h(l,{params:{query:`WorkflowId="${o}"`,pageSize:"1"},request:e})??{executions:[]},u=(d=et({executions:i}))==null?void 0:d[0];return{runId:u==null?void 0:u.runId}},qn=async(t,o=fetch,n=!1)=>{const e=n?"workflows.archived":"workflows";let r=!0;const a=l=>{(Xt(l)||Mt(l))&&(r=!1)},s=y(e,{namespace:t});return await h(s,{params:{pageSize:"1"},onError:a,handleError:a,request:o}),{authorized:r}},vn=async(t,o,n=fetch)=>ft(t,o,n,!0);async function vt(t,o=fetch){const n=y("workflow",{namespace:t.namespace,workflowId:t.workflowId});return h(n,{request:o,notifyOnError:!1,params:{"execution.runId":t.runId}}).then(e=>({workflow:ct(e)})).catch(e=>({error:e}))}async function Bn({workflow:t,namespace:o,reason:n}){const e=y("workflow.terminate",{namespace:o,workflowId:t.id}),r=I(lt).email,a=qt({reason:n,action:F.Terminate,email:r});return await h(e,{options:{method:"POST",body:C({reason:a,...r&&{identity:r}})},notifyOnError:!1,params:{"execution.runId":t.runId}})}async function Vn({namespace:t,workflow:{id:o,runId:n}},e=fetch){const r=y("workflow.cancel",{namespace:t,workflowId:o});return h(r,{request:e,notifyOnError:!1,options:{method:"POST"},params:{"execution.runId":n}})}async function Qn({namespace:t,workflow:{id:o,runId:n},name:e,input:r,encoding:a,messageType:s}){const l=y("workflow.signal",{namespace:t,workflowId:o,signalName:e}),i=await q({input:r,encoding:a,messageType:s}),u=I(R).data.settings,d=(u==null?void 0:u.version)??"",c=ko(d,"2.22")?{signalName:e,workflowExecution:{workflowId:o,runId:n},input:{payloads:i}}:{signalName:e,input:{payloads:i},params:{"execution.runId":n}};return h(l,{notifyOnError:!1,options:{method:"POST",body:C(c)}})}async function Gn({namespace:t,workflow:{workflowId:o,runId:n},name:e,identity:r,updateId:a,input:s="",encoding:l}){const i=y("workflow.update",{namespace:t,workflowId:o,updateName:e}),u=await q({input:s,encoding:l});return h(i,{notifyOnError:!1,options:{method:"POST",body:C({workflowExecution:{runId:n},request:{meta:{updateId:a,identity:r},input:{args:{payloads:u}}}})}})}async function zn({namespace:t,workflow:{id:o,runId:n},eventId:e,reason:r,includeSignals:a,excludeSignals:s,excludeUpdates:l}){const i=y("workflow.reset",{namespace:t,workflowId:o}),u=I(lt).email,d=qt({action:F.Reset,reason:r,email:u}),m={workflowExecution:{workflowId:o,runId:n},workflowTaskFinishEventId:e,requestId:jt(),reason:d};if(I($t)||ut("1.24.0",I(st))){const c=[];!s&&!l&&c.push(X.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED),s&&c.push(X.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL),l&&c.push(X.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE),m.resetReapplyExcludeTypes=c,m.resetReapplyType=M.RESET_REAPPLY_TYPE_ALL_ELIGIBLE}else{let c;a?c=M.RESET_REAPPLY_TYPE_SIGNAL:c=M.RESET_REAPPLY_TYPE_NONE,m.resetReapplyType=c}return h(i,{notifyOnError:!1,options:{method:"POST",body:C(m)},params:{"execution.runId":n}})}async function Xn(t,o=fetch){const n=r=>{console.error(r)},e=y("workflow",t);return h(e,{request:o,onError:n,handleError:n}).then(ct)}async function Mn(t,o,n){if(!I(Bt))return[];try{let e=`ParentWorkflowId = "${o}"`;n&&(e+=` AND ParentRunId = "${n}"`);const{workflows:r}=await ft(t,{query:e});return r}catch{return[]}}const Xo=t=>{if(!t.length)return{};const o={};return t.forEach(n=>{o[n.label]=yo(n.value)}),o};async function Kn({namespace:t,workflowId:o,taskQueue:n,workflowType:e,input:r,summary:a,details:s,encoding:l,messageType:i,searchAttributes:u}){const d=y("workflow",{namespace:t,workflowId:o});let m,c,_;if(r)try{m=await q({input:r,encoding:l,messageType:i})}catch{throw new Error("Could not encode input for starting workflow")}try{a&&(c=(await q({input:C(a),encoding:"json/plain"}))[0]),s&&(_=(await q({input:C(s),encoding:"json/plain"}))[0])}catch{console.error("Could not encode summary or details for starting workflow")}const E=C({workflowId:o,taskQueue:{name:n},workflowType:{name:e},input:m?{payloads:m}:null,userMetadata:{summary:c,details:_},searchAttributes:u.length===0?null:{indexedFields:{...Xo(u)}}});return h(d,{notifyOnError:!1,options:{method:"POST",body:E}})}const Hn=async({namespace:t,workflowType:o,workflowId:n})=>{var a,s,l,i,u,d,m,c,_,E;const e=f=>{console.error(f)},r={input:"",encoding:"json/plain",messageType:"",searchAttributes:void 0,summary:"",details:""};try{let f="";o&&n?f=`WorkflowType = "${o}" AND WorkflowId = "${n}"`:o?f=`WorkflowType = "${o}"`:n&&(f=`WorkflowId = "${n}"`);const g=y("workflows",{namespace:t}),k=await h(g,{params:{query:f,pageSize:"1"},handleError:e});if(!((a=k==null?void 0:k.executions)!=null&&a[0]))return r;const Y=et(k)[0],x={namespace:t,workflowId:Y.id,runId:Y.runId},{workflow:w}=await vt(x),U=await So(x),p=await wo((s=U==null?void 0:U.attributes)==null?void 0:s.input,t,I(R).data.settings,I(lt).accessToken,"readable",!1);let Q="";if(w.summary){const W=await Ct(w.summary);typeof W=="string"&&(Q=W)}let G="";if(w.details){const W=await Ct(w.details);typeof W=="string"&&(G=W)}const at=p!=null&&p.payloads?C((l=p.payloads[0])==null?void 0:l.data):"",rt=p!=null&&p.payloads&&xo((u=(i=p.payloads[0])==null?void 0:i.metadata)==null?void 0:u.encoding)?(m=(d=p.payloads[0])==null?void 0:d.metadata)==null?void 0:m.encoding:"json/plain",z=p!=null&&p.payloads?(_=(c=p.payloads[0])==null?void 0:c.metadata)==null?void 0:_.messageType:"";return{input:at,encoding:rt,messageType:z,searchAttributes:(E=w==null?void 0:w.searchAttributes)==null?void 0:E.indexedFields,summary:Q,details:G}}catch{return r}},Mo=(t,o)=>{const n=new Map;o.forEach(r=>{if(r.parent){const a=`${r.parent.workflowId}:${r.parent.runId}`,s=n.get(a)||[];s.push(r),n.set(a,s)}});const e=(r,a)=>{const s=`${r.id}:${r.runId}`,l=n.get(s)||[],i={workflow:r,children:[],rootPaths:[...a,{runId:r.runId,workflowId:r.id}]};return i.children=l.map(u=>e(u,i.rootPaths)),i};return e(t,[])};async function Jn(t,o,n){let e=`RootWorkflowId = "${o}"`;n&&(e+=` AND RootRunId = "${n}"`);const r=await vt({namespace:t,workflowId:o,runId:n}),a=await Ko(t,{query:e});return Mo(r==null?void 0:r.workflow,a)}const Ko=async(t,o,n=fetch,e=!1)=>{const r=o.query||Ft(o,e);let a;try{a=decodeURIComponent(r)}catch{a=r}const s=y("workflows",{namespace:t}),{executions:l}=await Po(async i=>h(s,{token:i,request:n,params:{query:a}}));return et({executions:l})},Ho=300,Jo=async(t,o,n)=>{o.set(!0);try{await n()}catch(e){console.error(e)}t.set(!1),setTimeout(()=>{o.set(!1)},Ho)},Zo=A([R],([t])=>{var o,n,e;return!!((e=(n=(o=t.data)==null?void 0:o.systemInfo)==null?void 0:n.capabilities)!=null&&e.countGroupByExecutionStatus)}),Zn=A([R,st],([t,o])=>{var r,a,s;const n=ut("1.23.0",o),e=!!((s=(a=(r=t.data)==null?void 0:r.systemInfo)==null?void 0:a.capabilities)!=null&&s.prefixSearch);return n||e}),tn=L(0),on=A([R],([t])=>{var o,n;return(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.hideWorkflowQueryErrors}),te=A([R],([t])=>{var o,n;return(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.refreshWorkflowCountsDisabled}),Bt=A([$t,st],([t,o])=>t||ut("1.23.0",o)),nn=A([R],([t])=>t.url.searchParams.get("query")),en=A([nn,Bt,po],([t,o,n])=>o&&n&&!t?"ParentWorkflowId is NULL":t),an=A([R],([t])=>t.params.namespace),rn=A([an,en,tn,Ut,on],([t,o,n,e,r])=>({namespace:t,query:o,refresh:n,supportsAdvancedVisibility:e,hideWorkflowQueryErrors:r})),sn=t=>{fn.set({...t,newCount:0})},ln=t=>rn.subscribe(({namespace:o,query:n,supportsAdvancedVisibility:e,hideWorkflowQueryErrors:r})=>{Jo(cn,un,async()=>{const{workflows:a,error:s}=await ft(o,{query:n});if(t(a),e&&!I(Zo)){const l=await Ao(o,n);sn(l)}s?r?it.set(T("workflows.workflows-error-querying")):it.set(s):it.set("")})}),oe=L(""),un=L(!0),cn=L(!0),fn=L({count:0,newCount:0}),it=L(""),ne=Vt([],ln),ee=L("");export{ee as A,zo as B,cn as C,un as D,it as E,ne as F,Zn as G,$n as P,qn as a,jn as b,oe as c,te as d,Hn as e,Fn as f,Kn as g,Vn as h,Un as i,Do as j,vn as k,Ft as l,xo as m,zn as n,Qn as o,vt as p,en as q,tn as r,Xo as s,Bn as t,Gn as u,Xn as v,fn as w,Zo as x,Mn as y,Jn as z};

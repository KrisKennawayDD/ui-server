import"./CWj6FrbW.js";import"./69_IOA4Y.js";import{p as et,s as n,m as h,R as f,l as E,ah as st,g as e,a as ot,f as at,e as rt,d as nt,r as T,b as ct}from"./D8UcSMmc.js";import{e as lt}from"./DjE1ZxmN.js";import{t as H,c as ut,a as q}from"./rdEDzBsq.js";import{i as it}from"./DlawjSvQ.js";import{e as ft}from"./DJjSvRty.js";import{i as mt}from"./BmZzLEH4.js";import{p as pt}from"./Cm4u_7Pd.js";import{e as F,a as m,s as dt,b as wt}from"./BY2F4uAC.js";import{a as vt}from"./Ctfij28z.js";import{p as ht}from"./LhQ2W5-c.js";import{S as kt}from"./BmhOUNFc.js";import{w as C,q as yt,r as _t,b as G,d as gt}from"./D8RpxpfL.js";import{w as D}from"./Cz37rGbn.js";import{c as xt}from"./ZPucmu5I.js";import{S as St}from"./S6Q2Q0ub.js";import{w as K,t as Ct,c as It}from"./B6akQdOp.js";import{b as Wt}from"./DAnq9XOo.js";import{u as bt}from"./Cz-MTB-a.js";import{W as $t}from"./F0EVtAWn.js";const N=(u=[])=>u.map(o=>{const s=Wt(o==null?void 0:o.groupValues[0]),k=parseInt(o.count);return{status:s,count:k}}).sort((o,s)=>K.indexOf(o.status)-K.indexOf(s.status)),Y=(u,o,s)=>{const p=Math.pow(3600/u,1/s),y=u*Math.pow(p,o);return Math.min(3600,Math.round(y))};var Et=H("<button><!></button>"),qt=H('<div class="flex min-h-[24px] flex-wrap items-center gap-2"></div>');function Xt(u,o){et(o,!1);const[s,k]=dt(),p=()=>m(ht,"$page",s),y=()=>m(yt,"$queryWithParentWorkflowId",s),r=()=>m(C,"$workflowCount",s),L=()=>m(gt,"$disableWorkflowCountsRefresh",s),I=()=>m(D,"$workflowFilters",s),P=()=>m(_t,"$refresh",s),d=h(),w=h();let R=pt(o,"staticQuery",8,""),B=h([]),_=h([]),g,v=1,x=h(!1);const Q=5,W=100;vt(()=>{A()});const U=()=>{if(v+=1,clearInterval(g),v<=W){const t=Y(Q,v,W)*1e3;g=setInterval(()=>M(),t)}},A=()=>{clearInterval(g),n(_,[]),F(C,f(r).newCount=0,f(r)),v=1,n(x,!0)},M=async()=>{U();try{const{count:t,groups:a}=await G({namespace:e(d),query:e(w)});F(C,f(r).newCount=parseInt(t)-r().count,f(r)),n(_,N(a))}catch(t){console.error("Fetching workflow counts failed: ",t==null?void 0:t.message)}finally{n(x,!1)}},V=async()=>{if(A(),!L()){const t=Y(Q,v,W)*1e3;g=setInterval(()=>M(),t)}try{const{count:t,groups:a}=await G({namespace:e(d),query:e(w)});F(C,f(r).count=parseInt(t),f(r)),n(B,N(a))}catch(t){console.error("Fetching workflow counts failed: ",t==null?void 0:t.message)}finally{n(x,!1)}},j=t=>{if(!I().some(c=>c.attribute==="ExecutionStatus"&&c.value===t)){const c={attribute:"ExecutionStatus",type:St.KEYWORD,value:t,operator:"",conditional:"=",parenthesis:""};wt(D,[...I(),c]);const l=Ct(It(I()));bt({url:p().url,parameter:"query",value:l,clearParameters:[xt]})}};E(()=>p(),()=>{n(d,p().params.namespace)}),E(()=>(st(R()),y()),()=>{n(w,R()||y())}),E(()=>(e(w),e(d),P()),()=>{e(w),e(d),P(),V()}),ot(),mt();var b=qt();ft(b,5,()=>e(B),({count:t,status:a})=>a,(t,a)=>{let c=()=>e(a).count,l=()=>e(a).status;var O=ut(),z=at(O);{var J=i=>{var S=Et(),Z=rt(S);const tt=nt(()=>e(_).find($=>$.status===l())?e(_).find($=>$.status===l()).count-c():0);$t(Z,{get status(){return l()},get count(){return c()},get newCount(){return e(tt)},get"test-id"(){return`workflow-status-${l()??""}`}}),T(S),lt("click",S,()=>j(l())),q(i,S)},X=i=>{kt(i,{class:"h-6 w-24 rounded-sm"})};it(z,i=>{e(x)?i(X,!1):i(J)})}q(t,O)}),T(b),q(u,b),ct(),k()}export{Xt as W};

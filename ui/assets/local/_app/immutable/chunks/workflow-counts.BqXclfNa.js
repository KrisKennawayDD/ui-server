import{s as et,h as O,j as K,k as L,f as d,m as ot,i as v,c as h,W as rt,L as C,w as I,v as nt,b as st,d as at,n as lt,p as ut}from"./scheduler.CnYDgCRb.js";import{S as ct,i as it,g as U,e as Y,t as k,b as g,c as j,a as H,m as V,d as z}from"./index.DW7Zsqzm.js";import{e as P,u as ft,o as mt}from"./each.rY6XwTBs.js";import{p as pt}from"./stores.DgaAEv8O.js";import{S as _t}from"./index.C8jtbdR1.js";import{r as ht,w as W,d as dt,q as wt,b as T}from"./workflows.CtzXfbga.js";import{w as M}from"./events.Di2CXVcQ.js";import{c as kt}from"./pagination.CRWeUKtW.js";import{S as gt}from"./time-picker.z5zZOO5W.js";import{g as R}from"./get-group-status-and-count.4B_18ChO.js";import{t as yt,c as bt}from"./translate.ComPzy0y.js";import{u as St}from"./update-query-parameters.BSE21-d6.js";import{W as Ct}from"./workflow-status.C4b0IIO1.js";const A=(e,r,t)=>{const u=Math.pow(3600/e,1/t),i=e*Math.pow(u,r);return Math.min(3600,Math.round(i))};function N(e,r,t){const n=e.slice();return n[22]=r[t].count,n[23]=r[t].status,n}function It(e){let r,t;return r=new _t({props:{class:"h-6 w-24 rounded-sm"}}),{c(){j(r.$$.fragment)},l(n){H(r.$$.fragment,n)},m(n,u){V(r,n,u),t=!0},p:nt,i(n){t||(k(r.$$.fragment,n),t=!0)},o(n){g(r.$$.fragment,n),t=!1},d(n){z(r,n)}}}function Wt(e){let r,t,n,u,i,m;function a(...l){return e[10](e[23],...l)}function o(...l){return e[11](e[23],...l)}t=new Ct({props:{status:e[23],count:e[22],newCount:e[1].find(a)?e[1].find(o).count-e[22]:0,"test-id":"workflow-status-"+e[23]}});function f(){return e[12](e[23])}return{c(){r=O("button"),j(t.$$.fragment),n=st()},l(l){r=K(l,"BUTTON",{});var c=L(r);H(t.$$.fragment,c),n=at(c),c.forEach(d)},m(l,c){v(l,r,c),V(t,r,null),lt(r,n),u=!0,i||(m=ut(r,"click",f),i=!0)},p(l,c){e=l;const p={};c&1&&(p.status=e[23]),c&1&&(p.count=e[22]),c&3&&(p.newCount=e[1].find(a)?e[1].find(o).count-e[22]:0),c&1&&(p["test-id"]="workflow-status-"+e[23]),t.$set(p)},i(l){u||(k(t.$$.fragment,l),u=!0)},o(l){g(t.$$.fragment,l),u=!1},d(l){l&&d(r),z(t),i=!1,m()}}}function D(e,r){let t,n,u,i,m;const a=[Wt,It],o=[];function f(l,c){return l[2]?1:0}return n=f(r),u=o[n]=a[n](r),{key:e,first:null,c(){t=I(),u.c(),i=I(),this.h()},l(l){t=I(),u.l(l),i=I(),this.h()},h(){this.first=t},m(l,c){v(l,t,c),o[n].m(l,c),v(l,i,c),m=!0},p(l,c){r=l;let p=n;n=f(r),n===p?o[n].p(r,c):(U(),g(o[p],1,1,()=>{o[p]=null}),Y(),u=o[n],u?u.p(r,c):(u=o[n]=a[n](r),u.c()),k(u,1),u.m(i.parentNode,i))},i(l){m||(k(u),m=!0)},o(l){g(u),m=!1},d(l){l&&(d(t),d(i)),o[n].d(l)}}}function vt(e){let r,t=[],n=new Map,u,i=P(e[0]);const m=a=>a[23];for(let a=0;a<i.length;a+=1){let o=N(e,i,a),f=m(o);n.set(f,t[a]=D(f,o))}return{c(){r=O("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){r=K(a,"DIV",{class:!0});var o=L(r);for(let f=0;f<t.length;f+=1)t[f].l(o);o.forEach(d),this.h()},h(){ot(r,"class","flex min-h-[24px] flex-wrap items-center gap-2")},m(a,o){v(a,r,o);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(r,null);u=!0},p(a,[o]){o&15&&(i=P(a[0]),U(),t=ft(t,o,m,1,a,i,n,r,mt,D,null,N),Y())},i(a){if(!u){for(let o=0;o<i.length;o+=1)k(t[o]);u=!0}},o(a){for(let o=0;o<t.length;o+=1)g(t[o]);u=!1},d(a){a&&d(r);for(let o=0;o<t.length;o+=1)t[o].d()}}}const G=5,F=100;function Et(e,r,t){let n,u,i,m,a,o,f,l;h(e,ht,s=>t(7,i=s)),h(e,pt,s=>t(8,m=s)),h(e,M,s=>t(15,a=s)),h(e,W,s=>t(16,o=s)),h(e,dt,s=>t(17,f=s)),h(e,wt,s=>t(9,l=s));let{staticQuery:c=""}=r,p=[],E=[],y,w=1,b=!1;rt(()=>{Q()});const J=()=>{if(w+=1,clearInterval(y),w<=F){const s=A(G,w,F)*1e3;y=setInterval(()=>q(),s)}},Q=()=>{clearInterval(y),t(1,E=[]),C(W,o.newCount=0,o),w=1,t(2,b=!0)},q=async()=>{J();try{const{count:s,groups:_}=await T({namespace:n,query:u});C(W,o.newCount=parseInt(s)-o.count,o),t(1,E=R(_))}catch(s){console.error("Fetching workflow counts failed: ",s==null?void 0:s.message)}finally{t(2,b=!1)}},X=async()=>{if(Q(),!f){const s=A(G,w,F)*1e3;y=setInterval(()=>q(),s)}try{const{count:s,groups:_}=await T({namespace:n,query:u});C(W,o.count=parseInt(s),o),t(0,p=R(_))}catch(s){console.error("Fetching workflow counts failed: ",s==null?void 0:s.message)}finally{t(2,b=!1)}},B=s=>{if(!a.some(S=>S.attribute==="ExecutionStatus"&&S.value===s)){const S={attribute:"ExecutionStatus",type:gt.KEYWORD,value:s,operator:"",conditional:"=",parenthesis:""};C(M,a=[...a,S],a);const tt=yt(bt(a));St({url:m.url,parameter:"query",value:tt,clearParameters:[kt]})}},Z=(s,_)=>_.status===s,x=(s,_)=>_.status===s,$=s=>B(s);return e.$$set=s=>{"staticQuery"in s&&t(4,c=s.staticQuery)},e.$$.update=()=>{e.$$.dirty&256&&t(5,n=m.params.namespace),e.$$.dirty&528&&t(6,u=c||l),e.$$.dirty&224&&X()},[p,E,b,B,c,n,u,i,m,l,Z,x,$]}class Kt extends ct{constructor(r){super(),it(this,r,Et,vt,et,{staticQuery:4})}}export{Kt as W};

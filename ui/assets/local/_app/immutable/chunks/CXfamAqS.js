import{d as B,w as Q,g as P}from"./DsexP6Wk.js";import{p as z}from"./CcrW2fP9.js";import"./CWj6FrbW.js";import"./69_IOA4Y.js";import{p as Nt,l as Yt,a as $t,c as F,e as M,f as Et,t as gt,b as Dt,ah as Ot,r as K,g as ht,d as kt}from"./DYX0w8bX.js";import{s as Ut}from"./CxFVcq4O.js";import{i as yt}from"./B_BuKjdB.js";import{t as tt,a as H}from"./Bz76f8pg.js";import{s as Ft}from"./CFGOF_JX.js";import{s as jt}from"./BoNO6UAY.js";import{i as qt}from"./CZRFLhJG.js";import{p as S}from"./BrXzBH3h.js";import{s as Bt,a as Qt}from"./CgU0heln.js";import{C as zt}from"./DuX5BOdb.js";import{I as Vt}from"./B4rg944G.js";import{R as Gt,a as It}from"./CtF9PzQn.js";import{t as x}from"./D2OY9xdY.js";import{P as Xt}from"./DYytcmLI.js";import{v as Tt}from"./Dz_GI0CC.js";import{A as j}from"./TBME1SPK.js";import{b as Mt,c as Kt,a as Pt}from"./DPdqYYbs.js";import{g as Ht,h as Jt,i as Zt,j as to}from"./BS7yEvwO.js";import{t as xt,s as oo}from"./Ba2PpMJl.js";import{s as no}from"./BygCA4E_.js";import{i as pt,s as eo}from"./BaenAdHI.js";import{a as nt}from"./Bij_J0Ni.js";import{m as At,i as ro}from"./HVeMsM_a.js";import{h as ao}from"./CWuIemgy.js";import{e as q,s as io}from"./B9KDWZHy.js";import{r as E,a as m,b as so,p as co,c as St,i as lo,d as uo}from"./DdfGcVyZ.js";import{p as fo}from"./pl3-qnCy.js";import{s as b}from"./CTBtQUu0.js";import{i as wo,c as mo,d as _t,e as Eo}from"./qEOT7B5E.js";import{a as go}from"./CZ-wSfu_.js";const _n=Q(0),ho=B([z],([t])=>{var o,n;return(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.hideWorkflowQueryErrors}),Tn=B([z],([t])=>{var o,n;return(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.refreshWorkflowCountsDisabled}),bt=B([pt,xt],([t,o])=>t||At("1.23.0",o)),ko=B([z],([t])=>t.url.searchParams.get("query")),xn=B([ko,bt,ao],([t,o,n])=>o&&n&&!t?"ParentWorkflowId is NULL":t),pn=Q(""),An=Q({count:0,newCount:0}),ot=Q(""),Sn=Q(""),yo=["json/plain","json/protobuf"],Io=t=>yo.includes(t);var Po=tt("<!> <!>",1),_o=tt('<div class="flex w-full flex-col gap-2"><!> <!></div>'),To=tt("<!> <div><!> <!></div>",1),xo=tt('<div><h5 class="pb-1 text-sm font-medium"> </h5> <!></div>');function bn(t,o){Nt(o,!1);const[n,r]=Bt(),e=()=>Qt(i(),"$encoding",n);let a=S(o,"id",24,Tt),c=S(o,"input",12),i=S(o,"encoding",12),s=S(o,"messageType",12),u=S(o,"error",8,!1),d=S(o,"loading",12,!1),f=S(o,"label",24,()=>x("workflows.input")),l=S(o,"editing",8,!0);Yt(()=>(e(),Ot(s())),()=>{e()==="json/plain"&&s()&&s("")}),$t(),qt();var g=xo(),h=M(g),k=M(h,!0);K(h);var Y=F(h,2);zt(Y,{class:"flex flex-col gap-2",children:(p,$)=>{var R=To(),y=Et(R);Xt(y,{get error(){return u()},get id(){return a()},get editing(){return l()},get input(){return c()},set input(I){c(I)},get loading(){return d()},set loading(I){d(I)},$$legacy:!0});var C=F(y,2),A=M(C);{var w=I=>{var W=_o(),N=M(W);const D=kt(()=>x("workflows.encoding"));Gt(N,{get description(){return ht(D)},name:"encoding",get group(){return i()},set group(T){i(T)},children:(T,O)=>{var L=Po(),U=Et(L);It(U,{id:"json/plain",value:"json/plain",label:"json/plain"});var X=F(U,2);It(X,{id:"json/protobuf",value:"json/protobuf",label:"json/protobuf"}),H(T,L)},$$slots:{default:!0},$$legacy:!0});var _=F(N,2);{var G=T=>{const O=kt(()=>x("workflows.message-type"));Vt(T,{get label(){return ht(O)},get error(){return u()},id:"messageType",get value(){return s()},set value(L){s(L)},$$legacy:!0})};yt(_,T=>{e()==="json/protobuf"&&T(G)})}K(W),H(I,W)};yt(A,I=>{l()&&I(w)})}var v=F(A,2);Ft(v,o,"action",{},null),K(C),gt(()=>jt(C,1,`flex items-end gap-2 ${(l()?"justify-between":"justify-end")??""}`)),H(p,R)},$$slots:{default:!0}}),K(g),gt(()=>Ut(k,f())),H(t,g),Dt(),r()}const po=(t=oo)=>!P(t).disableWriteActions,Ao=(t=[])=>t.map(o=>{const n=no(o,!0),r=o.activityId,e=o.state;return{...n,id:r,state:Jt(e)}}),So=t=>t?t.map(o=>({...o,state:Zt(o.state)})):[],bo=t=>t?t.map(o=>({...o,state:to(o.state)})):[],Ro=t=>!t||!t.indexedFields?{}:{indexedFields:Object.entries(t.indexedFields).reduce((n,[r,e])=>({...n,[r]:Mt(e)}),{})},et=t=>{var T,O,L,U,X,at,it,st,ct,lt,ut,dt,ft,wt,mt;const o=Ro(t.workflowExecutionInfo.searchAttributes),n=t.workflowExecutionInfo.memo,r=t.workflowExecutionInfo.type.name,e=t.workflowExecutionInfo.execution.workflowId,a=t.workflowExecutionInfo.execution.runId,c=t.workflowExecutionInfo.startTime,i=t.workflowExecutionInfo.closeTime,s=t.workflowExecutionInfo.executionTime,u=Ht(t.workflowExecutionInfo.status),d=u==="Running",f=t.workflowExecutionInfo.historyLength,l=t.workflowExecutionInfo.historySizeBytes,g=`/workflows/${e}/${a}`,h=((O=(T=t==null?void 0:t.executionConfig)==null?void 0:T.taskQueue)==null?void 0:O.name)||((L=t==null?void 0:t.workflowExecutionInfo)==null?void 0:L.taskQueue),k=(U=t==null?void 0:t.workflowExecutionInfo)==null?void 0:U.mostRecentWorkerVersionStamp,Y=(X=t==null?void 0:t.workflowExecutionInfo)==null?void 0:X.assignedBuildId,p=(at=t==null?void 0:t.workflowExecutionInfo)==null?void 0:at.parentNamespaceId,$=(it=t==null?void 0:t.workflowExecutionInfo)==null?void 0:it.parentExecution,R=t.workflowExecutionInfo.stateTransitionCount,y=(st=t.executionConfig)==null?void 0:st.defaultWorkflowTaskTimeout,C=Ao(t.pendingActivities),A=(t==null?void 0:t.pendingChildren)??[],w=So(t==null?void 0:t.pendingNexusOperations),v=t==null?void 0:t.pendingWorkflowTask,I=bo(t==null?void 0:t.callbacks),W=(ct=t.workflowExecutionInfo)==null?void 0:ct.rootExecution,N=(lt=t.workflowExecutionInfo)==null?void 0:lt.versioningInfo,D=t.workflowExtendedInfo??{};let _,G;return(ut=t==null?void 0:t.executionConfig)!=null&&ut.userMetadata&&(_=(ft=(dt=t==null?void 0:t.executionConfig)==null?void 0:dt.userMetadata)==null?void 0:ft.summary,G=(mt=(wt=t==null?void 0:t.executionConfig)==null?void 0:wt.userMetadata)==null?void 0:mt.details),{name:r,id:e,runId:a,startTime:c,endTime:i,executionTime:s,status:u,historyEvents:f,historySizeBytes:l,searchAttributes:o,memo:n,rootExecution:W,url:g,taskQueue:h,assignedBuildId:Y,mostRecentWorkerVersionStamp:k,pendingActivities:C,pendingChildren:A,pendingNexusOperations:w,pendingWorkflowTask:v,callbacks:I,versioningInfo:N,summary:_,details:G,parentNamespaceId:p,parent:$,stateTransitionCount:R,isRunning:d,defaultWorkflowTaskTimeout:y,workflowExtendedInfo:D,get canBeTerminated(){return d&&po()}}},V=t=>(t.executions||[]).map(o=>et({workflowExecutionInfo:o}));var J=(t=>(t[t.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED",t[t.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL=1]="RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL",t[t.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE=2]="RESET_REAPPLY_EXCLUDE_TYPE_UPDATE",t))(J||{}),Z=(t=>(t[t.RESET_REAPPLY_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_TYPE_UNSPECIFIED",t[t.RESET_REAPPLY_TYPE_SIGNAL=1]="RESET_REAPPLY_TYPE_SIGNAL",t[t.RESET_REAPPLY_TYPE_NONE=2]="RESET_REAPPLY_TYPE_NONE",t[t.RESET_REAPPLY_TYPE_ALL_ELIGIBLE=3]="RESET_REAPPLY_TYPE_ALL_ELIGIBLE",t))(Z||{});const Wo={workflowId:"WorkflowId",workflowType:"WorkflowType",timeRange:"StartTime",executionStatus:"ExecutionStatus",closeTime:"CloseTime"},Lo=["workflowId","workflowType","timeRange","executionStatus","closeTime"],Co=t=>!(t===null||t===void 0||t===""||typeof t=="string"&&t==="undefined"),vo=t=>{if(typeof t!="string")return!1;for(const o of Lo)if(o===t)return!0;return!1},No=(t,o,n)=>{const r=Wo[t];return o==="All"?"":wo(o)||mo(o)?n||P(eo)?`${r} > "${_t(o)}"`:`${r} BETWEEN "${_t(o)}" AND "${Eo()}"`:`${r}="${o}"`},Yo=(t,o)=>Object.entries(t).map(([n,r])=>{if(vo(n)&&Co(r))return No(n,r,o)}).filter(Boolean),Rt=(t,o=!1)=>Yo(t,o).join(" and ");function $o(t){console.error("Unhandled action:",t)}const Do=(t,o)=>{let n;switch(t){case j.Cancel:n=x("workflows.canceled");break;case j.Reset:n=x("workflows.reset");break;case j.Terminate:n=x("workflows.terminated");break;default:$o(t)}return o?x("workflows.workflow-action-reason-placeholder-with-email",{action:n,email:o}):x("workflows.workflow-action-reason-placeholder",{action:n})},Wt=({action:t,reason:o,email:n})=>{const r=Do(t,n);return o?[o.trim(),r].join(" "):r},Lt=async({namespace:t,query:o})=>{const n="GROUP BY ExecutionStatus",r=E("workflows.count",{namespace:t}),{count:e,groups:a}=await m(r,{params:{query:o?`${o} ${n}`:`${n}`},notifyOnError:!1});return{count:e??"0",groups:a}},Rn=async({namespace:t,query:o})=>{const n='TemporalNamespaceDivision="TemporalScheduler" AND ExecutionStatus="Running"',r=o?`${n} AND ${o}`:n,e=E("workflows.count",{namespace:t}),{count:a}=await m(e,{params:{query:r},notifyOnError:!1});return a??"0"},Ct=async(t,o,n=fetch,r=!1)=>{const e=o.query||Rt(o,r);let a;try{a=decodeURIComponent(e)}catch{a=e}const c=r?"workflows.archived":"workflows";let i="";const s=l=>{var g,h;St(l),(g=l==null?void 0:l.body)!=null&&g.message||l!=null&&l.status?i=((h=l==null?void 0:l.body)==null?void 0:h.message)??`Error fetching workflows: ${l.status}: ${l.statusText}`:i="Error fetching workflows: Server failed to respond"},u=E(c,{namespace:t}),{executions:d,nextPageToken:f}=await m(u,{params:{query:a},onError:s,handleError:s,request:n})??{executions:[],nextPageToken:""};return{workflows:V({executions:d}),nextPageToken:String(f),error:i}},Wn=async({namespace:t,workflowId:o,url:n},r=fetch)=>{var d;const e="workflows",a=n??so(t),c=co(e,{namespace:t}),i=a+c,{executions:s}=await m(i,{params:{query:`WorkflowId="${o}"`,pageSize:"1"},request:r})??{executions:[]},u=(d=V({executions:s}))==null?void 0:d[0];return{runId:u==null?void 0:u.runId}},Ln=async(t,o=fetch,n=!1)=>{const r=n?"workflows.archived":"workflows";let e=!0;const a=i=>{(lo(i)||uo(i))&&(e=!1)},c=E(r,{namespace:t});return await m(c,{params:{pageSize:"1"},onError:a,handleError:a,request:o}),{authorized:e}},Cn=async(t,o,n=fetch)=>Ct(t,o,n,!0);async function rt(t,o=fetch){const n=E("workflow",{namespace:t.namespace,workflowId:t.workflowId});return m(n,{request:o,notifyOnError:!1,params:{"execution.runId":t.runId}}).then(r=>({workflow:et(r)})).catch(r=>({error:r}))}async function vn({workflow:t,namespace:o,reason:n}){const r=E("workflow.terminate",{namespace:o,workflowId:t.id}),e=P(nt).email,a=Wt({reason:n,action:j.Terminate,email:e});return await m(r,{options:{method:"POST",body:b({reason:a,...e&&{identity:e}})},notifyOnError:!1,params:{"execution.runId":t.runId}})}async function Nn({namespace:t,workflow:{id:o,runId:n}},r=fetch){const e=E("workflow.cancel",{namespace:t,workflowId:o});return m(e,{request:r,notifyOnError:!1,options:{method:"POST"},params:{"execution.runId":n}})}async function Yn({namespace:t,workflow:{id:o,runId:n},name:r,input:e,encoding:a,messageType:c}){const i=E("workflow.signal",{namespace:t,workflowId:o,signalName:r}),s=await q({input:e,encoding:a,messageType:c}),u=P(z).data.settings,d=(u==null?void 0:u.version)??"",l=ro(d,"2.22")?{signalName:r,workflowExecution:{workflowId:o,runId:n},input:{payloads:s}}:{signalName:r,input:{payloads:s},params:{"execution.runId":n}};return m(i,{notifyOnError:!1,options:{method:"POST",body:b(l)}})}async function $n({namespace:t,workflow:{workflowId:o,runId:n},name:r,identity:e,updateId:a,input:c="",encoding:i}){const s=E("workflow.update",{namespace:t,workflowId:o,updateName:r}),u=await q({input:c,encoding:i});return m(s,{notifyOnError:!1,options:{method:"POST",body:b({workflowExecution:{runId:n},request:{meta:{updateId:a,identity:e},input:{args:{payloads:u}}}})}})}async function Dn({namespace:t,workflow:{id:o,runId:n},eventId:r,reason:e,includeSignals:a,excludeSignals:c,excludeUpdates:i}){const s=E("workflow.reset",{namespace:t,workflowId:o}),u=P(nt).email,d=Wt({action:j.Reset,reason:e,email:u}),f={workflowExecution:{workflowId:o,runId:n},workflowTaskFinishEventId:r,requestId:Tt(),reason:d};if(P(pt)||At("1.24.0",P(xt))){const l=[];!c&&!i&&l.push(J.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED),c&&l.push(J.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL),i&&l.push(J.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE),f.resetReapplyExcludeTypes=l,f.resetReapplyType=Z.RESET_REAPPLY_TYPE_ALL_ELIGIBLE}else{let l;a?l=Z.RESET_REAPPLY_TYPE_SIGNAL:l=Z.RESET_REAPPLY_TYPE_NONE,f.resetReapplyType=l}return m(s,{notifyOnError:!1,options:{method:"POST",body:b(f)},params:{"execution.runId":n}})}async function On(t,o=fetch){const n=e=>{console.error(e)},r=E("workflow",t);return m(r,{request:o,onError:n,handleError:n}).then(et)}async function Un(t,o,n){if(!P(bt))return[];try{let r=`ParentWorkflowId = "${o}"`;n&&(r+=` AND ParentRunId = "${n}"`);const{workflows:e}=await Ct(t,{query:r});return e}catch{return[]}}const Oo=t=>{if(!t.length)return{};const o={};return t.forEach(n=>{o[n.label]=io(n.value)}),o};async function Fn({namespace:t,workflowId:o,taskQueue:n,workflowType:r,input:e,summary:a,details:c,encoding:i,messageType:s,searchAttributes:u}){const d=E("workflow",{namespace:t,workflowId:o});let f,l,g;if(e)try{f=await q({input:e,encoding:i,messageType:s})}catch{throw new Error("Could not encode input for starting workflow")}try{a&&(l=(await q({input:b(a),encoding:"json/plain"}))[0]),c&&(g=(await q({input:b(c),encoding:"json/plain"}))[0])}catch{console.error("Could not encode summary or details for starting workflow")}const h=b({workflowId:o,taskQueue:{name:n},workflowType:{name:r},input:f?{payloads:f}:null,userMetadata:{summary:l,details:g},searchAttributes:u.length===0?null:{indexedFields:{...Oo(u)}}});return m(d,{notifyOnError:!1,options:{method:"POST",body:h}})}const jn=async({namespace:t,workflowType:o,workflowId:n})=>{var a,c,i,s,u,d,f,l,g,h;const r=k=>{console.error(k)},e={input:"",encoding:"json/plain",messageType:"",searchAttributes:void 0,summary:"",details:""};try{let k="";o&&n?k=`WorkflowType = "${o}" AND WorkflowId = "${n}"`:o?k=`WorkflowType = "${o}"`:n&&(k=`WorkflowId = "${n}"`);const Y=E("workflows",{namespace:t}),p=await m(Y,{params:{query:k,pageSize:"1"},handleError:r});if(!((a=p==null?void 0:p.executions)!=null&&a[0]))return e;const $=V(p)[0],R={namespace:t,workflowId:$.id,runId:$.runId},{workflow:y}=await rt(R),A=await go(R),w=await Kt((c=A==null?void 0:A.attributes)==null?void 0:c.input,t,P(z).data.settings,P(nt).accessToken,"readable",!1);let v="";if(y.summary){const _=await Pt(y.summary);typeof _=="string"&&(v=_)}let I="";if(y.details){const _=await Pt(y.details);typeof _=="string"&&(I=_)}const W=w!=null&&w.payloads?b((i=w.payloads[0])==null?void 0:i.data):"",N=w!=null&&w.payloads&&Io((u=(s=w.payloads[0])==null?void 0:s.metadata)==null?void 0:u.encoding)?(f=(d=w.payloads[0])==null?void 0:d.metadata)==null?void 0:f.encoding:"json/plain",D=w!=null&&w.payloads?(g=(l=w.payloads[0])==null?void 0:l.metadata)==null?void 0:g.messageType:"";return{input:W,encoding:N,messageType:D,searchAttributes:(h=y==null?void 0:y.searchAttributes)==null?void 0:h.indexedFields,summary:v,details:I}}catch{return e}},Uo=(t,o)=>{const n=new Map;o.forEach(e=>{if(e.parent){const a=`${e.parent.workflowId}:${e.parent.runId}`,c=n.get(a)||[];c.push(e),n.set(a,c)}});const r=(e,a)=>{var u,d;const c=`${e.id}:${e.runId}`,i=n.get(c)||[],s={workflow:e,scheduleId:(d=(u=e==null?void 0:e.searchAttributes)==null?void 0:u.indexedFields)==null?void 0:d.TemporalScheduledById,children:[],rootPaths:[...a,{runId:e.runId,workflowId:e.id}]};return s.children=i.map(f=>r(f,s.rootPaths)),s};return r(t,[])},Fo=({parent:t,workflow:o,children:n,siblingCount:r})=>{const e=n.map(i=>{const s=t?[{runId:t.runId,workflowId:t.id},{runId:o.runId,workflowId:o.id},{runId:i.runId,workflowId:i.id}]:[{runId:o.runId,workflowId:o.id},{runId:i.runId,workflowId:i.id}];return{workflow:i,siblingCount:r,children:[],rootPaths:s}}),a={workflow:o,children:e,rootPaths:t?[{runId:t.runId,workflowId:t.id},{runId:o.runId,workflowId:o.id}]:[{runId:o.runId,workflowId:o.id}]};return t?{workflow:t,children:[a],rootPaths:[{runId:t.runId,workflowId:t.id}]}:a};async function qn(t,o,n){let r=`RootWorkflowId = "${o}"`;return n&&(r+=` AND RootRunId = "${n}"`),await Lt({namespace:t,query:r})}async function Bn(t,o,n){let r=`RootWorkflowId = "${o}"`;n&&(r+=` AND RootRunId = "${n}"`);const e=await rt({namespace:t,workflowId:o,runId:n}),a=await vt(t,{query:r});return Uo(e==null?void 0:e.workflow,a)}async function Qn({namespace:t,parentWorkflowId:o,parentRunId:n,workflow:r}){let e;const a=async(s,u)=>{const d=`ParentWorkflowId = "${s}" AND ParentRunId = "${u}"`;return await vt(t,{query:d})};let c=0;if(o){e=await rt({namespace:t,workflowId:o,runId:n});const s=`ParentWorkflowId = "${o}" AND ParentRunId = "${n}"`,{count:u}=await Lt({namespace:t,query:s});c=parseInt(u)}const i=await a(r.id,r.runId);return Fo({parent:e==null?void 0:e.workflow,workflow:r,children:i,siblingCount:c})}const vt=async(t,o,n=fetch,r=!1)=>{const e=o.query||Rt(o,r);let a;try{a=decodeURIComponent(e)}catch{a=e}const c=E("workflows",{namespace:t}),{executions:i}=await fo(async s=>m(c,{token:s,request:n,params:{query:a}}));return V({executions:i})},zn=async(t,o="",n=fetch)=>(r=100,e="")=>{ot.set("");const a=i=>{var s;St(i),P(ho)?ot.set(x("workflows.workflows-error-querying")):ot.set(((s=i==null?void 0:i.body)==null?void 0:s.message)||x("workflows.workflows-error-querying"))},c=E("workflows",{namespace:t});return m(c,{params:{pageSize:String(r),nextPageToken:e,...o?{query:o}:{}},request:n,onError:a,handleError:a}).then(({executions:i=[],nextPageToken:s=""})=>({items:V({executions:i}),nextPageToken:s?String(s):""}))};export{rt as A,Sn as B,Do as C,ot as D,zn as E,bn as P,Ln as a,Lt as b,jn as c,Tn as d,pn as e,Wn as f,Oo as g,Nn as h,Rn as i,po as j,Cn as k,Rt as l,Io as m,Qn as n,Un as o,qn as p,xn as q,_n as r,Fn as s,vn as t,Bn as u,On as v,An as w,Dn as x,Yn as y,$n as z};

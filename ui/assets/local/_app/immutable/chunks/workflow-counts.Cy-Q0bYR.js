import{s as ot,h as L,j as U,k as V,f as w,m as nt,i as v,c as h,W as rt,L as C,w as I,v as st,b as at,d as lt,n as ut,p as ct}from"./scheduler.CnYDgCRb.js";import{S as it,i as ft,g as Y,e as j,t as y,b as g,c as H,a as z,m as J,d as X}from"./index.DW7Zsqzm.js";import{e as M,u as mt,o as pt}from"./each.rY6XwTBs.js";import{p as _t}from"./stores.ByTuExiI.js";import{S as dt}from"./index.C8jtbdR1.js";import{t as ht,c as wt,w as O}from"./translate.CM6HkRvq.js";import{r as kt,w as W,d as yt,q as gt,b as R}from"./workflows.CKoOgaTQ.js";import{w as A}from"./events.CB9_I844.js";import{c as bt}from"./pagination.B2h1LviK.js";import{S as St}from"./time-picker.DM8KhFZ5.js";import{b as Ct}from"./decode-payload.wREYGPSo.js";import{u as It}from"./update-query-parameters.DCtvxj4P.js";import{W as Wt}from"./workflow-status.C4b0IIO1.js";const N=(e,n,t)=>{const u=Math.pow(3600/e,1/t),i=e*Math.pow(u,n);return Math.min(3600,Math.round(i))};function D(e,n,t){const s=e.slice();return s[23]=n[t].count,s[24]=n[t].status,s}function vt(e){let n,t;return n=new dt({props:{class:"h-6 w-24 rounded-sm"}}),{c(){H(n.$$.fragment)},l(s){z(n.$$.fragment,s)},m(s,u){J(n,s,u),t=!0},p:st,i(s){t||(y(n.$$.fragment,s),t=!0)},o(s){g(n.$$.fragment,s),t=!1},d(s){X(n,s)}}}function Et(e){let n,t,s,u,i,m;function a(...l){return e[10](e[24],...l)}function o(...l){return e[11](e[24],...l)}t=new Wt({props:{status:e[24],count:e[23],newCount:e[1].find(a)?e[1].find(o).count-e[23]:0,"test-id":"workflow-status-"+e[24]}});function f(){return e[12](e[24])}return{c(){n=L("button"),H(t.$$.fragment),s=at()},l(l){n=U(l,"BUTTON",{});var c=V(n);z(t.$$.fragment,c),s=lt(c),c.forEach(w)},m(l,c){v(l,n,c),J(t,n,null),ut(n,s),u=!0,i||(m=ct(n,"click",f),i=!0)},p(l,c){e=l;const _={};c&1&&(_.status=e[24]),c&1&&(_.count=e[23]),c&3&&(_.newCount=e[1].find(a)?e[1].find(o).count-e[23]:0),c&1&&(_["test-id"]="workflow-status-"+e[24]),t.$set(_)},i(l){u||(y(t.$$.fragment,l),u=!0)},o(l){g(t.$$.fragment,l),u=!1},d(l){l&&w(n),X(t),i=!1,m()}}}function G(e,n){let t,s,u,i,m;const a=[Et,vt],o=[];function f(l,c){return l[2]?1:0}return s=f(n),u=o[s]=a[s](n),{key:e,first:null,c(){t=I(),u.c(),i=I(),this.h()},l(l){t=I(),u.l(l),i=I(),this.h()},h(){this.first=t},m(l,c){v(l,t,c),o[s].m(l,c),v(l,i,c),m=!0},p(l,c){n=l;let _=s;s=f(n),s===_?o[s].p(n,c):(Y(),g(o[_],1,1,()=>{o[_]=null}),j(),u=o[s],u?u.p(n,c):(u=o[s]=a[s](n),u.c()),y(u,1),u.m(i.parentNode,i))},i(l){m||(y(u),m=!0)},o(l){g(u),m=!1},d(l){l&&(w(t),w(i)),o[s].d(l)}}}function Ft(e){let n,t=[],s=new Map,u,i=M(e[0]);const m=a=>a[24];for(let a=0;a<i.length;a+=1){let o=D(e,i,a),f=m(o);s.set(f,t[a]=G(f,o))}return{c(){n=L("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){n=U(a,"DIV",{class:!0});var o=V(n);for(let f=0;f<t.length;f+=1)t[f].l(o);o.forEach(w),this.h()},h(){nt(n,"class","flex min-h-[24px] flex-wrap items-center gap-2")},m(a,o){v(a,n,o);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(n,null);u=!0},p(a,[o]){o&15&&(i=M(a[0]),Y(),t=mt(t,o,m,1,a,i,s,n,pt,G,null,D),j())},i(a){if(!u){for(let o=0;o<i.length;o+=1)y(t[o]);u=!0}},o(a){for(let o=0;o<t.length;o+=1)g(t[o]);u=!1},d(a){a&&w(n);for(let o=0;o<t.length;o+=1)t[o].d()}}}const K=5,P=100;function Pt(e,n,t){let s,u,i,m,a,o,f,l;h(e,kt,r=>t(7,i=r)),h(e,_t,r=>t(8,m=r)),h(e,A,r=>t(15,a=r)),h(e,W,r=>t(16,o=r)),h(e,yt,r=>t(17,f=r)),h(e,gt,r=>t(9,l=r));let{staticQuery:c=""}=n,_=[],E=[],b,k=1,S=!1;rt(()=>{Q()});const Z=()=>{if(k+=1,clearInterval(b),k<=P){const r=N(K,k,P)*1e3;b=setInterval(()=>B(),r)}},Q=()=>{clearInterval(b),t(1,E=[]),C(W,o.newCount=0,o),k=1,t(2,S=!0)},q=(r=[])=>r.map(p=>{const d=Ct(p==null?void 0:p.groupValues[0]),F=parseInt(p.count);return{status:d,count:F}}).sort((p,d)=>O.indexOf(p.status)-O.indexOf(d.status)),B=async()=>{Z();try{const{count:r,groups:p}=await R({namespace:s,query:u});C(W,o.newCount=parseInt(r)-o.count,o),t(1,E=q(p))}catch(r){console.error("Fetching workflow counts failed: ",r==null?void 0:r.message)}finally{t(2,S=!1)}},x=async()=>{if(Q(),!f){const r=N(K,k,P)*1e3;b=setInterval(()=>B(),r)}try{const{count:r,groups:p}=await R({namespace:s,query:u});C(W,o.count=parseInt(r),o),t(0,_=q(p))}catch(r){console.error("Fetching workflow counts failed: ",r==null?void 0:r.message)}finally{t(2,S=!1)}},T=r=>{if(!a.some(d=>d.attribute==="ExecutionStatus"&&d.value===r)){const d={attribute:"ExecutionStatus",type:St.KEYWORD,value:r,operator:"",conditional:"=",parenthesis:""};C(A,a=[...a,d],a);const F=ht(wt(a));It({url:m.url,parameter:"query",value:F,clearParameters:[bt]})}},$=(r,p)=>p.status===r,tt=(r,p)=>p.status===r,et=r=>T(r);return e.$$set=r=>{"staticQuery"in r&&t(4,c=r.staticQuery)},e.$$.update=()=>{e.$$.dirty&256&&t(5,s=m.params.namespace),e.$$.dirty&528&&t(6,u=c||l),e.$$.dirty&224&&x()},[_,E,S,T,c,s,u,i,m,l,$,tt,et]}class Ut extends it{constructor(n){super(),ft(this,n,Pt,Ft,ot,{staticQuery:4})}}export{Ut as W};

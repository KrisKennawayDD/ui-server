import{s as et,d,i as W,j as ot,k as O,l as K,n as L,c as h,V as rt,L as v,w as C,h as nt,p as st,e as at,f as lt,v as ct}from"./scheduler.gES7FyoG.js";import{S as ut,i as it,t as k,a as g,g as U,e as V,d as Y,m as j,c as H,b as z}from"./index.DpnGbpCk.js";import{e as P,u as ft,o as mt}from"./each.CDwUSmAp.js";import{p as pt}from"./stores.NKpufGBN.js";import{S as _t}from"./index.vo0DtjBy.js";import{r as ht,w as I,d as dt,q as wt,b as T}from"./workflows.DfImfSPr.js";import{w as M}from"./events.DS0hnenM.js";import{c as kt}from"./pagination.BQ4BkTEc.js";import{S as gt}from"./time-picker.-NPiJ0Kl.js";import{g as R}from"./get-group-status-and-count.DpnvEowg.js";import{t as yt,c as bt}from"./translate.BCGBpDjI.js";import{u as St}from"./update-query-parameters.BXrjRzCY.js";import{W as vt}from"./workflow-status.C4Ry_AwJ.js";const A=(e,r,t)=>{const c=Math.pow(3600/e,1/t),i=e*Math.pow(c,r);return Math.min(3600,Math.round(i))};function N(e,r,t){const n=e.slice();return n[22]=r[t].count,n[23]=r[t].status,n}function Ct(e){let r,t;return r=new _t({props:{class:"h-6 w-24 rounded-sm"}}),{c(){z(r.$$.fragment)},l(n){H(r.$$.fragment,n)},m(n,c){j(r,n,c),t=!0},p:ct,i(n){t||(g(r.$$.fragment,n),t=!0)},o(n){k(r.$$.fragment,n),t=!1},d(n){Y(r,n)}}}function It(e){let r,t,n,c,i,m;function a(...l){return e[10](e[23],...l)}function o(...l){return e[11](e[23],...l)}t=new vt({props:{status:e[23],count:e[22],newCount:e[1].find(a)?e[1].find(o).count-e[22]:0,"test-id":"workflow-status-"+e[23]}});function f(){return e[12](e[23])}return{c(){r=L("button"),z(t.$$.fragment),n=lt()},l(l){r=O(l,"BUTTON",{});var u=K(r);H(t.$$.fragment,u),n=at(u),u.forEach(d)},m(l,u){W(l,r,u),j(t,r,null),nt(r,n),c=!0,i||(m=st(r,"click",f),i=!0)},p(l,u){e=l;const p={};u&1&&(p.status=e[23]),u&1&&(p.count=e[22]),u&3&&(p.newCount=e[1].find(a)?e[1].find(o).count-e[22]:0),u&1&&(p["test-id"]="workflow-status-"+e[23]),t.$set(p)},i(l){c||(g(t.$$.fragment,l),c=!0)},o(l){k(t.$$.fragment,l),c=!1},d(l){l&&d(r),Y(t),i=!1,m()}}}function D(e,r){let t,n,c,i,m;const a=[It,Ct],o=[];function f(l,u){return l[2]?1:0}return n=f(r),c=o[n]=a[n](r),{key:e,first:null,c(){t=C(),c.c(),i=C(),this.h()},l(l){t=C(),c.l(l),i=C(),this.h()},h(){this.first=t},m(l,u){W(l,t,u),o[n].m(l,u),W(l,i,u),m=!0},p(l,u){r=l;let p=n;n=f(r),n===p?o[n].p(r,u):(U(),k(o[p],1,1,()=>{o[p]=null}),V(),c=o[n],c?c.p(r,u):(c=o[n]=a[n](r),c.c()),g(c,1),c.m(i.parentNode,i))},i(l){m||(g(c),m=!0)},o(l){k(c),m=!1},d(l){l&&(d(t),d(i)),o[n].d(l)}}}function Wt(e){let r,t=[],n=new Map,c,i=P(e[0]);const m=a=>a[23];for(let a=0;a<i.length;a+=1){let o=N(e,i,a),f=m(o);n.set(f,t[a]=D(f,o))}return{c(){r=L("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){r=O(a,"DIV",{class:!0});var o=K(r);for(let f=0;f<t.length;f+=1)t[f].l(o);o.forEach(d),this.h()},h(){ot(r,"class","flex min-h-[24px] flex-wrap items-center gap-2")},m(a,o){W(a,r,o);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(r,null);c=!0},p(a,[o]){o&15&&(i=P(a[0]),U(),t=ft(t,o,m,1,a,i,n,r,mt,D,null,N),V())},i(a){if(!c){for(let o=0;o<i.length;o+=1)g(t[o]);c=!0}},o(a){for(let o=0;o<t.length;o+=1)k(t[o]);c=!1},d(a){a&&d(r);for(let o=0;o<t.length;o+=1)t[o].d()}}}const G=5,F=100;function Et(e,r,t){let n,c,i,m,a,o,f,l;h(e,ht,s=>t(7,i=s)),h(e,pt,s=>t(8,m=s)),h(e,M,s=>t(15,a=s)),h(e,I,s=>t(16,o=s)),h(e,dt,s=>t(17,f=s)),h(e,wt,s=>t(9,l=s));let{staticQuery:u=""}=r,p=[],E=[],y,w=1,b=!1;rt(()=>{Q()});const J=()=>{if(w+=1,clearInterval(y),w<=F){const s=A(G,w,F)*1e3;y=setInterval(()=>q(),s)}},Q=()=>{clearInterval(y),t(1,E=[]),v(I,o.newCount=0,o),w=1,t(2,b=!0)},q=async()=>{J();try{const{count:s,groups:_}=await T({namespace:n,query:c});v(I,o.newCount=parseInt(s)-o.count,o),t(1,E=R(_))}catch(s){console.error("Fetching workflow counts failed: ",s==null?void 0:s.message)}finally{t(2,b=!1)}},X=async()=>{if(Q(),!f){const s=A(G,w,F)*1e3;y=setInterval(()=>q(),s)}try{const{count:s,groups:_}=await T({namespace:n,query:c});v(I,o.count=parseInt(s),o),t(0,p=R(_))}catch(s){console.error("Fetching workflow counts failed: ",s==null?void 0:s.message)}finally{t(2,b=!1)}},B=s=>{if(!a.some(S=>S.attribute==="ExecutionStatus"&&S.value===s)){const S={attribute:"ExecutionStatus",type:gt.KEYWORD,value:s,operator:"",conditional:"=",parenthesis:""};v(M,a=[...a,S],a);const tt=yt(bt(a));St({url:m.url,parameter:"query",value:tt,clearParameters:[kt]})}},Z=(s,_)=>_.status===s,x=(s,_)=>_.status===s,$=s=>B(s);return e.$$set=s=>{"staticQuery"in s&&t(4,u=s.staticQuery)},e.$$.update=()=>{e.$$.dirty&256&&t(5,n=m.params.namespace),e.$$.dirty&528&&t(6,c=u||l),e.$$.dirty&224&&X()},[p,E,b,B,u,n,c,i,m,l,Z,x,$]}class Kt extends ut{constructor(r){super(),it(this,r,Et,Wt,et,{staticQuery:4})}}export{Kt as W};

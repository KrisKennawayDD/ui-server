import{J as B,G as j,v as F,E as G,w as R,k as H,y as J,o as L,u as N,j as V,aq as Y}from"./BZ1i_Yzi.js";import{d as W,e as K}from"./B11KKQxI.js";import{w as E}from"./Dm8LSs3h.js";import{g as C}from"./CltjweXe.js";import{t as O}from"./D2OY9xdY.js";import"./BLjkLUx2.js";import{s as k}from"./CTBtQUu0.js";import{r as m,a as f}from"./BpTOF_EP.js";import{v as _}from"./Dz_GI0CC.js";import{g as D}from"./PoU4U7iZ.js";import{e as $}from"./CQI4xOW8.js";import{o as U,p as X}from"./BYq8DOCO.js";function fe(e,s,t,o,a){var i=e,c="",r;B(()=>{if(c===(c=s()??"")){j&&F();return}r!==void 0&&(Y(r),r=void 0),c!==""&&(r=G(()=>{if(j){R.data;for(var n=F(),d=n;n!==null&&(n.nodeType!==8||n.data!=="");)d=n,n=H(n);if(n===null)throw J(),L;W(R,d),i=N(n);return}var u=c+"",h=K(u);W(V(h),h.lastChild),i.before(h)}))})}const ge=async(e,s,t,o=fetch)=>(a=100,i="")=>{const c=m("schedules",{namespace:e});return f(c,{params:{maximumPageSize:String(a),nextPageToken:i,...s?{query:s}:{}},request:o,onError:t}).then(({schedules:r,nextPageToken:n})=>({items:r,nextPageToken:n?String(n):""}))};async function ye(e,s=fetch){const t=m("schedule",e);return f(t,{request:s})}async function we(e,s=fetch){const t=m("schedule",e);return f(t,{request:s,options:{method:"DELETE"}})}async function Z({namespace:e,scheduleId:s,body:t}){let o="";const a=r=>{var n;return o=((n=r==null?void 0:r.body)==null?void 0:n.message)??`Error creating schedule: ${r.status}: ${r.statusText}`},i=m("schedule",{namespace:e,scheduleId:s}),{conflictToken:c}=await f(i,{options:{method:"POST",body:k({request_id:_(),...t})},onError:a});return{conflictToken:c,error:o}}async function ee({namespace:e,scheduleId:s,body:t}){let o="";const a=c=>{var r;return o=((r=c==null?void 0:c.body)==null?void 0:r.message)??`Error editing schedule: ${c.status}: ${c.statusText}`},i=m("schedule.edit",{namespace:e,scheduleId:s});return await f(i,{options:{method:"POST",body:k({request_id:_(),...t})},onError:a}),{error:o}}async function Se({namespace:e,scheduleId:s,reason:t}){const o={patch:{pause:t}},a=m("schedule.patch",{namespace:e,scheduleId:s});return await f(a,{options:{method:"POST",body:k({...o,request_id:_()})},onError:i=>console.error(i)})}async function ke({namespace:e,scheduleId:s,reason:t}){const o={patch:{unpause:t}},a=m("schedule.patch",{namespace:e,scheduleId:s});return await f(a,{options:{method:"POST",body:k({...o,request_id:_()})}})}async function ve({namespace:e,scheduleId:s,overlapPolicy:t}){const o={patch:{triggerImmediately:{overlapPolicy:t}}},a=m("schedule.patch",{namespace:e,scheduleId:s});return await f(a,{options:{method:"POST",body:k({...o,request_id:_()})}})}async function _e({namespace:e,scheduleId:s,overlapPolicy:t,startTime:o,endTime:a}){const i={patch:{backfillRequest:[{overlapPolicy:t,startTime:o,endTime:a}]}},c=m("schedule.patch",{namespace:e,scheduleId:s});return await f(c,{options:{method:"POST",body:k({...i,request_id:_()})}})}const I=e=>e?parseInt(e):0,te=(e,s,t,o)=>`${I(e)*60*60*24+I(s)*60*60+I(t)*60+I(o)}s`,se=({months:e=[],daysOfMonth:s=[],daysOfWeek:t=[]})=>{var r,n;const o=e.sort((d,u)=>parseInt(d)-parseInt(u)).join(","),a=s.sort((d,u)=>d-u).join(","),c=(((n=(r=t==null?void 0:t[0])==null?void 0:r.split(","))==null?void 0:n.length)>1?t[0].split(","):t).sort((d,u)=>parseInt(d)-parseInt(u)).join(",");return{month:o,dayOfMonth:a,dayOfWeek:c}},M=(e,s,t)=>{const{hour:o,minute:a,second:i,phase:c,cronString:r}=s,{preset:n,months:d,days:u,daysOfMonth:h,daysOfWeek:y}=t;if(n==="string"){const l=`${r}#${r}`;e.schedule.spec.cronString=[l],e.schedule.spec.calendar=[],e.schedule.spec.interval=[]}else if(n==="interval"){const l=te(u,o,a,i);e.schedule.spec.interval=[{interval:l,phase:c||"0s"}],e.schedule.spec.cronString=[],e.schedule.spec.calendar=[]}else{const{month:l,dayOfMonth:g,dayOfWeek:w}=se({months:d,daysOfMonth:h,daysOfWeek:y});e.schedule.spec.calendar=[{year:"*",month:n==="month"?l:"",dayOfMonth:n==="month"?g:"",dayOfWeek:n==="week"?w:"",hour:o,minute:a,second:i}],e.schedule.spec.interval=[],e.schedule.spec.cronString=[]}},Te=async({action:e,spec:s,presets:t})=>{const{namespace:o,name:a,workflowId:i,workflowType:c,taskQueue:r,input:n,encoding:d,messageType:u,searchAttributes:h}=e;let y;if(n)try{y=await $({input:n,encoding:d,messageType:u})}catch(w){S.set(`${O("data-encoder.encode-error")}: ${w==null?void 0:w.message}`);return}const l={schedule_id:a.trim(),searchAttributes:h.length===0?null:{indexedFields:{...D(h)}},schedule:{spec:{calendar:[],interval:[],cronString:[]},action:{startWorkflow:{workflowId:i,workflowType:{name:c},taskQueue:{name:r},input:y?{payloads:y}:null}}}};M(l,s,t),v.set(!0);const{error:g}=await Z({scheduleId:a,namespace:o,body:l});g?(S.set(g),v.set(!1)):setTimeout(()=>{S.set(""),v.set(!1),C(X({namespace:o}))},2e3)},be=async({action:e,spec:s,presets:t},o,a)=>{var q,A;const{namespace:i,name:c,workflowId:r,workflowType:n,taskQueue:d,input:u,encoding:h,messageType:y,searchAttributes:l}=e;let g;if(u)try{g=await $({input:u,encoding:h,messageType:y})}catch(p){S.set(`${O("data-encoder.encode-error")}: ${p==null?void 0:p.message}`);return}const{preset:w}=t,T={schedule_id:a,searchAttributes:l.length===0?null:{indexedFields:{...D(l)}},schedule:{...o,action:{startWorkflow:{...o.action.startWorkflow,workflowId:r,workflowType:{name:n},taskQueue:{name:d},...u!==void 0&&{input:g?{payloads:g}:null}}}}},b=(A=(q=T.schedule.action.startWorkflow)==null?void 0:q.header)==null?void 0:A.fields;if(b&&Object.keys(b).length>0)try{const p=Object.entries(b);for(const[Q,z]of p){const x=await $({input:k(z),encoding:"json/plain"});b[Q]=x[0]}}catch(p){S.set(`${O("data-encoder.encode-error")}: ${p==null?void 0:p.message}`);return}w==="existing"?T.schedule.spec=o.spec:(M(T,s,t),T.schedule.spec.structuredCalendar=[]),v.set(!0);const{error:P}=await ee({namespace:i,scheduleId:a,body:T});P?(S.set(P),v.set(!1)):setTimeout(()=>{C(U({namespace:i,scheduleId:c})),S.set(""),v.set(!1)},2e3)},v=E(!1),S=E(""),Ie=E("0");export{Te as a,Ie as b,ge as c,_e as d,S as e,ye as f,we as g,fe as h,v as l,Se as p,be as s,ve as t,ke as u};

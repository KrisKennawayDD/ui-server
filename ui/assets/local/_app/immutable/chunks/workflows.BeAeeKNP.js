import{d as k,r as Pt,w as _}from"./entry.D0rBIFvv.js";import{p as y}from"./stores.BfSDJoT6.js";import{t as A}from"./translate.BBe5dcco.js";import{v as rt,C as h}from"./scheduler.D6mQsyhd.js";import{r as m,a as w,i as it,b as It,p as Tt,c as _t,d as gt,e as At,m as O}from"./route-for-api.CspMP5IS.js";import{A as x}from"./workflow-actions.TBME1SPK.js";import{b as St,c as xt,a as et}from"./decode-payload.VG2qrEgD.js";import{f as bt,g as Ct,h as Wt}from"./screaming-enums.w0zEi9dM.js";import{s as Lt,c as st,t as Y}from"./versions.D0peyUxi.js";import{s as Rt}from"./index.B1NBhk5O.js";import{a as U}from"./auth-user.DKaTnawI.js";import{c as Yt}from"./events.DRxioA1K.js";import{e as W,s as Nt}from"./encode-payload.Dby3uJRJ.js";import{p as pt}from"./paginated.C6Njfj8x.js";import{s as T}from"./parse-with-big-int.Dyr6jPtv.js";import{i as Dt,c as Ot,d as at,e as Ut}from"./format-time.Dn4a2B__.js";import{a as Ft}from"./events-service.C5FmFfKq.js";import{v as vt}from"./toaster.CJq3DT65.js";const $t=async(t,o,n=fetch)=>{let r=0;try{const e=m("workflows.count",{namespace:t}),a=await w(e,{params:o?{query:o}:{},onError:rt,handleError:rt,request:n});r=parseInt((a==null?void 0:a.count)||"0")}catch{}return{count:r}},Fo=async({namespace:t,query:o})=>{const n="GROUP BY ExecutionStatus",r=m("workflows.count",{namespace:t}),{count:e,groups:a}=await w(r,{params:{query:o?`${o} ${n}`:`${n}`},notifyOnError:!1});return{count:e??"0",groups:a}},vo=async({namespace:t})=>{const o='TemporalNamespaceDivision="TemporalScheduler" AND ExecutionStatus="Running"',n=m("workflows.count",{namespace:t}),{count:r}=await w(n,{params:{query:o},notifyOnError:!1});return r??"0"},Bt=(t=Lt)=>!h(t).disableWriteActions,qt=(t=[])=>t.map(o=>{const n=Rt(o,!0),r=o.activityId;return{...n,id:r}}),Vt=t=>t?t.map(o=>({...o,state:Ct(o.state)})):[],Qt=t=>t?t.map(o=>({...o,state:Wt(o.state)})):[],Gt=t=>!t||!t.indexedFields?{}:{indexedFields:Object.entries(t.indexedFields).reduce((n,[r,e])=>({...n,[r]:St(e)}),{})},F=t=>{var V,Q,G,z,X,j,K,M,H,J,Z,tt,ot,nt;const o=Gt(t.workflowExecutionInfo.searchAttributes),n=t.workflowExecutionInfo.memo,r=t.workflowExecutionInfo.type.name,e=t.workflowExecutionInfo.execution.workflowId,a=t.workflowExecutionInfo.execution.runId,s=t.workflowExecutionInfo.startTime,i=t.workflowExecutionInfo.closeTime,u=t.workflowExecutionInfo.executionTime,l=bt(t.workflowExecutionInfo.status),f=l==="Running",d=t.workflowExecutionInfo.historyLength,c=t.workflowExecutionInfo.historySizeBytes,E=`/workflows/${e}/${a}`,P=((Q=(V=t==null?void 0:t.executionConfig)==null?void 0:V.taskQueue)==null?void 0:Q.name)||((G=t==null?void 0:t.workflowExecutionInfo)==null?void 0:G.taskQueue),S=(z=t==null?void 0:t.workflowExecutionInfo)==null?void 0:z.mostRecentWorkerVersionStamp,g=(X=t==null?void 0:t.workflowExecutionInfo)==null?void 0:X.assignedBuildId,b=(j=t==null?void 0:t.workflowExecutionInfo)==null?void 0:j.parentNamespaceId,C=(K=t==null?void 0:t.workflowExecutionInfo)==null?void 0:K.parentExecution,$=t.workflowExecutionInfo.stateTransitionCount,I=(M=t.executionConfig)==null?void 0:M.defaultWorkflowTaskTimeout,wt=qt(t.pendingActivities),Et=(t==null?void 0:t.pendingChildren)??[],mt=Vt(t==null?void 0:t.pendingNexusOperations),kt=t==null?void 0:t.pendingWorkflowTask,ht=Qt(t==null?void 0:t.callbacks),yt=(H=t.workflowExecutionInfo)==null?void 0:H.rootExecution;let B,q;return(J=t==null?void 0:t.executionConfig)!=null&&J.userMetadata&&(B=(tt=(Z=t==null?void 0:t.executionConfig)==null?void 0:Z.userMetadata)==null?void 0:tt.summary,q=(nt=(ot=t==null?void 0:t.executionConfig)==null?void 0:ot.userMetadata)==null?void 0:nt.details),{name:r,id:e,runId:a,startTime:s,endTime:i,executionTime:u,status:l,historyEvents:d,historySizeBytes:c,searchAttributes:o,memo:n,rootExecution:yt,url:E,taskQueue:P,assignedBuildId:g,mostRecentWorkerVersionStamp:S,pendingActivities:wt,pendingChildren:Et,pendingNexusOperations:mt,pendingWorkflowTask:kt,callbacks:ht,summary:B,details:q,parentNamespaceId:b,parent:C,stateTransitionCount:$,isRunning:f,defaultWorkflowTaskTimeout:I,get canBeTerminated(){return f&&Bt()}}},N=t=>(t.executions||[]).map(o=>F({workflowExecutionInfo:o})),zt=(t,o)=>{var n;return((n=t==null?void 0:t.visibilityStore)==null?void 0:n.includes("elasticsearch"))||it(o,"1.19")},Xt=t=>{var o;return(o=t==null?void 0:t.visibilityStore)==null?void 0:o.includes("elasticsearch")},p=k([y],([t])=>{var o,n,r;return(r=(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.runtimeEnvironment)==null?void 0:r.isCloud}),ct=k([st,Y,p],([t,o,n])=>zt(t,o)||n);k([st,p],([t,o])=>Xt(t)||o);var L=(t=>(t[t.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED",t[t.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL=1]="RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL",t[t.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE=2]="RESET_REAPPLY_EXCLUDE_TYPE_UPDATE",t))(L||{}),R=(t=>(t[t.RESET_REAPPLY_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_TYPE_UNSPECIFIED",t[t.RESET_REAPPLY_TYPE_SIGNAL=1]="RESET_REAPPLY_TYPE_SIGNAL",t[t.RESET_REAPPLY_TYPE_NONE=2]="RESET_REAPPLY_TYPE_NONE",t[t.RESET_REAPPLY_TYPE_ALL_ELIGIBLE=3]="RESET_REAPPLY_TYPE_ALL_ELIGIBLE",t))(R||{});const jt={workflowId:"WorkflowId",workflowType:"WorkflowType",timeRange:"StartTime",executionStatus:"ExecutionStatus",closeTime:"CloseTime"},Kt=["workflowId","workflowType","timeRange","executionStatus","closeTime"],Mt=t=>!(t===null||t===void 0||t===""||typeof t=="string"&&t==="undefined"),Ht=t=>{if(typeof t!="string")return!1;for(const o of Kt)if(o===t)return!0;return!1},Jt=(t,o,n)=>{const r=jt[t];return o==="All"?"":Dt(o)||Ot(o)?n||h(ct)?`${r} > "${at(o)}"`:`${r} BETWEEN "${at(o)}" AND "${Ut()}"`:`${r}="${o}"`},Zt=(t,o)=>Object.entries(t).map(([n,r])=>{if(Ht(n)&&Mt(r))return Jt(n,r,o)}).filter(Boolean),ut=(t,o=!1)=>Zt(t,o).join(" and ");function to(t){console.error("Unhandled action:",t)}const oo=(t,o)=>{let n;switch(t){case x.Cancel:n=A("workflows.canceled");break;case x.Reset:n=A("workflows.reset");break;case x.Terminate:n=A("workflows.terminated");break;default:to(t)}return o?A("workflows.workflow-action-reason-placeholder-with-email",{action:n,email:o}):A("workflows.workflow-action-reason-placeholder",{action:n})},lt=({action:t,reason:o,email:n})=>{const r=oo(t,n);return o?[o.trim(),r].join(" "):r},v=async(t,o,n=fetch,r=!1)=>{const e=o.query||ut(o,r);let a;try{a=decodeURIComponent(e)}catch{a=e}const s=r?"workflows.archived":"workflows";let i="";const u=c=>{var E,P;_t(c),(E=c==null?void 0:c.body)!=null&&E.message||c!=null&&c.status?i=((P=c==null?void 0:c.body)==null?void 0:P.message)??`Error fetching workflows: ${c.status}: ${c.statusText}`:i="Error fetching workflows: Server failed to respond"},l=m(s,{namespace:t}),{executions:f,nextPageToken:d}=await w(l,{params:{query:a},onError:u,handleError:u,request:n})??{executions:[],nextPageToken:""};return{workflows:N({executions:f}),nextPageToken:String(d),error:i}},$o=async({namespace:t,workflowId:o,url:n},r=fetch)=>{var f;const e="workflows",a=n??It(t),s=Tt(e,{namespace:t}),i=a+s,{executions:u}=await w(i,{params:{query:`WorkflowId="${o}"`,pageSize:"1"},request:r})??{executions:[]},l=(f=N({executions:u}))==null?void 0:f[0];return{runId:l==null?void 0:l.runId}},Bo=async(t,o=fetch,n=!1)=>{const r=n?"workflows.archived":"workflows";let e=!0;const a=i=>{(gt(i)||At(i))&&(e=!1)},s=m(r,{namespace:t});return await w(s,{params:{pageSize:"1"},onError:a,handleError:a,request:o}),{authorized:e}},qo=async(t,o,n=fetch)=>v(t,o,n,!0);async function ft(t,o=fetch){const n=m("workflow",{namespace:t.namespace,workflowId:t.workflowId});return w(n,{request:o,notifyOnError:!1,params:{"execution.runId":t.runId}}).then(r=>({workflow:F(r)})).catch(r=>({error:r}))}async function Vo({workflow:t,namespace:o,reason:n}){const r=m("workflow.terminate",{namespace:o,workflowId:t.id}),e=h(U).email,a=lt({reason:n,action:x.Terminate,email:e});return await w(r,{options:{method:"POST",body:T({reason:a,...e&&{identity:e}})},notifyOnError:!1,params:{"execution.runId":t.runId}})}async function Qo({namespace:t,workflow:{id:o,runId:n}},r=fetch){const e=m("workflow.cancel",{namespace:t,workflowId:o});return w(e,{request:r,notifyOnError:!1,options:{method:"POST"},params:{"execution.runId":n}})}async function Go({namespace:t,workflow:{id:o,runId:n},name:r,input:e,encoding:a}){const s=m("workflow.signal",{namespace:t,workflowId:o,signalName:r}),i=await W(e,a),u=h(y).data.settings,l=(u==null?void 0:u.version)??"",d=it(l,"2.22")?{signalName:r,workflowExecution:{workflowId:o,runId:n},input:{payloads:i}}:{signalName:r,input:{payloads:i},params:{"execution.runId":n}};return w(s,{notifyOnError:!1,options:{method:"POST",body:T(d)}})}async function zo({namespace:t,workflow:{id:o,runId:n},eventId:r,reason:e,includeSignals:a,excludeSignals:s,excludeUpdates:i}){const u=m("workflow.reset",{namespace:t,workflowId:o}),l=h(U).email,f=lt({action:x.Reset,reason:e,email:l}),d={workflowExecution:{workflowId:o,runId:n},workflowTaskFinishEventId:r,requestId:vt(),reason:f};if(h(p)||O("1.24.0",h(Y))){const c=[];!s&&!i&&c.push(L.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED),s&&c.push(L.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL),i&&c.push(L.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE),d.resetReapplyExcludeTypes=c,d.resetReapplyType=R.RESET_REAPPLY_TYPE_ALL_ELIGIBLE}else{let c;a?c=R.RESET_REAPPLY_TYPE_SIGNAL:c=R.RESET_REAPPLY_TYPE_NONE,d.resetReapplyType=c}return w(u,{notifyOnError:!1,options:{method:"POST",body:T(d)},params:{"execution.runId":n}})}async function Xo(t,o=fetch){const n=e=>{console.error(e)},r=m("workflow",t);return w(r,{request:o,onError:n,handleError:n}).then(F)}async function jo(t,o,n){if(!h(dt))return[];try{let r=`ParentWorkflowId = "${o}"`;n&&(r+=` AND ParentRunId = "${n}"`);const{workflows:e}=await v(t,{query:r});return e}catch{return[]}}const no=t=>{if(!t.length)return{};const o={};return t.forEach(n=>{o[n.label]=Nt(n.value)}),o};async function Ko({namespace:t,workflowId:o,taskQueue:n,workflowType:r,input:e,summary:a,details:s,encoding:i,searchAttributes:u}){const l=m("workflow",{namespace:t,workflowId:o});let f,d,c;if(e)try{f=await W(e,i)}catch{throw new Error("Could not encode input for starting workflow")}try{a&&(d=(await W(T(a),"json/plain"))[0]),s&&(c=(await W(T(s),"json/plain"))[0])}catch{console.error("Could not encode summary or details for starting workflow")}const E=T({workflowId:o,taskQueue:{name:n},workflowType:{name:r},input:f?{payloads:f}:null,userMetadata:{summary:d,details:c},searchAttributes:u.length===0?null:{indexedFields:{...no(u)}}});return w(l,{notifyOnError:!1,options:{method:"POST",body:E}})}const Mo=async({namespace:t,workflowType:o,workflowId:n})=>{var a,s,i;const r=u=>{console.error(u)},e={input:"",searchAttributes:void 0,summary:"",details:""};try{let u="";o&&n?u=`WorkflowType = "${o}" AND WorkflowId = "${n}"`:o?u=`WorkflowType = "${o}"`:n&&(u=`WorkflowId = "${n}"`);const l=m("workflows",{namespace:t}),f=await w(l,{params:{query:u,pageSize:"1"},handleError:r});if(!((a=f==null?void 0:f.executions)!=null&&a[0]))return e;const d=N(f)[0],c={namespace:t,workflowId:d.id,runId:d.runId},{workflow:E}=await ft(c),S=await Ft(c),g=await xt((s=S==null?void 0:S.attributes)==null?void 0:s.input,t,h(y).data.settings,h(U).accessToken);let b="";if(E.summary){const I=await et(E.summary);typeof I=="string"&&(b=I)}let C="";if(E.details){const I=await et(E.details);typeof I=="string"&&(C=I)}return{input:g!=null&&g.payloads?T(g.payloads[0]):"",searchAttributes:(i=E==null?void 0:E.searchAttributes)==null?void 0:i.indexedFields,summary:b,details:C}}catch{return e}},ro=(t,o)=>{const n={workflow:t,children:[],rootPaths:[{runId:t.runId,workflowId:t.id}]},r=(a,s)=>{s!=null&&s.length?(a.children=s.map(i=>({workflow:i,children:[],rootPaths:[...a.rootPaths,{runId:i.runId,workflowId:i.id}]})),a.children.forEach(i=>{const u=o.filter(l=>{var f,d;return((f=l==null?void 0:l.parent)==null?void 0:f.workflowId)===i.workflow.id&&((d=l==null?void 0:l.parent)==null?void 0:d.runId)===i.workflow.runId});r(i,u)})):a.children=[]},e=o.filter(a=>{var s,i;return((s=a==null?void 0:a.parent)==null?void 0:s.workflowId)===t.id&&((i=a==null?void 0:a.parent)==null?void 0:i.runId)===t.runId});return r(n,e),n};async function Ho(t,o,n){let r=`RootWorkflowId = "${o}"`;n&&(r+=` AND RootRunId = "${n}"`);const e=await ft({namespace:t,workflowId:o,runId:n}),a=await eo(t,{query:r});return ro(e==null?void 0:e.workflow,a)}const eo=async(t,o,n=fetch,r=!1)=>{const e=o.query||ut(o,r);let a;try{a=decodeURIComponent(e)}catch{a=e}const s=m("workflows",{namespace:t}),{executions:i}=await pt(async u=>w(s,{token:u,request:n,params:{query:a}}));return N({executions:i})},ao=300,io=async(t,o,n)=>{o.set(!0);try{await n()}catch(r){console.error(r)}t.set(!1),setTimeout(()=>{o.set(!1)},ao)},so=k([y],([t])=>{var o,n,r;return!!((r=(n=(o=t.data)==null?void 0:o.systemInfo)==null?void 0:n.capabilities)!=null&&r.countGroupByExecutionStatus)}),Jo=k([y,Y],([t,o])=>{var e,a,s;const n=O("1.23.0",o),r=!!((s=(a=(e=t.data)==null?void 0:e.systemInfo)==null?void 0:a.capabilities)!=null&&s.prefixSearch);return n||r}),co=_(0),uo=k([y],([t])=>{var o,n;return(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.hideWorkflowQueryErrors}),Zo=k([y],([t])=>{var o,n;return(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.refreshWorkflowCountsDisabled}),dt=k([p,Y],([t,o])=>t||O("1.23.0",o)),lo=k([y],([t])=>t.url.searchParams.get("query")),fo=k([lo,dt,Yt],([t,o,n])=>o&&!n?t?`ParentWorkflowId is NULL AND ${t}`:"ParentWorkflowId is NULL":t),wo=k([y],([t])=>t.params.namespace),Eo=k([wo,fo,co,ct,uo],([t,o,n,r,e])=>({namespace:t,query:o,refresh:n,supportsAdvancedVisibility:r,hideWorkflowQueryErrors:e})),mo=t=>{Po.set({...t,newCount:0})},ko=t=>Eo.subscribe(({namespace:o,query:n,supportsAdvancedVisibility:r,hideWorkflowQueryErrors:e})=>{io(yo,ho,async()=>{const{workflows:a,error:s}=await v(o,{query:n});if(t(a),r&&!h(so)){const i=await $t(o,n);mo(i)}s?e?D.set(A("workflows.workflows-error-querying")):D.set(s):D.set("")})}),tn=_(""),ho=_(!0),yo=_(!0),Po=_({count:0,newCount:0}),D=_(""),on=Pt([],ko),nn=_("");export{Jo as A,nn as B,oo as C,dt as D,on as E,yo as F,ho as G,D as H,Bo as a,Fo as b,tn as c,Zo as d,Mo as e,$o as f,Ko as g,Qo as h,ct as i,vo as j,p as k,Bt as l,qo as m,ut as n,zo as o,Go as p,fo as q,co as r,no as s,Vo as t,ft as u,Xo as v,Po as w,so as x,jo as y,Ho as z};

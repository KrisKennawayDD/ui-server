import{s as L,d as g,i as C,h as _,p as N,j as u,k as y,l as U,e as b,n as E,f as w,c as j,v as G,m as H,t as T}from"./scheduler.gES7FyoG.js";import{S as q,i as D,d as x,t as I,a as S,m as F,c as k,b as A}from"./index.DpnGbpCk.js";import{g as P}from"./entry.B0-ORjIP.js";import{B as R}from"./button.BRMOoXP8.js";import{L as V}from"./label.B6iMAtLr.js";import{t as d}from"./translate.DzDeFYDI.js";import{g as W}from"./index.Bs3AMj1F.js";import{t as z}from"./index.DZG2e_F6.js";import{i as J,a as K}from"./import-events.R9BIAGuB.js";import{l as M}from"./namespaces.mpSbSI8j.js";import{t as B}from"./toaster.3Sgc_8xg.js";import{p as O}from"./parse-with-big-int.DJQKqIvA.js";import{r as Q}from"./route-for.D1wJOJuH.js";function X(m){let e=d("common.import")+"",o;return{c(){o=T(e)},l(a){o=H(a,e)},m(a,r){C(a,o,r)},p:G,d(a){a&&g(o)}}}function Y(m){let e,o,a,r,p,i,f,n,c;return o=new V({props:{hidden:!0,for:"import-event-history-file-upload",label:d("events.import-event-history-file-upload")}}),i=new R({props:{leadingIcon:"file-upload",disabled:!m[0],$$slots:{default:[X]},$$scope:{ctx:m}}}),i.$on("click",m[2]),{c(){e=E("div"),A(o.$$.fragment),a=w(),r=E("input"),p=w(),A(i.$$.fragment),this.h()},l(t){e=y(t,"DIV",{class:!0});var s=U(e);k(o.$$.fragment,s),a=b(s),r=y(s,"INPUT",{id:!0,class:!0,type:!0,accept:!0}),p=b(s),k(i.$$.fragment,s),s.forEach(g),this.h()},h(){u(r,"id","import-event-history-file-upload"),u(r,"class","import-input block border border-slate-200 p-2"),u(r,"type","file"),u(r,"accept",".json"),u(e,"class","flex flex-col items-start gap-2 md:flex-row md:items-center")},m(t,s){C(t,e,s),F(o,e,null),_(e,a),_(e,r),_(e,p),F(i,e,null),f=!0,n||(c=N(r,"change",m[1]),n=!0)},p(t,[s]){const l={};s&1&&(l.disabled=!t[0]),s&32&&(l.$$scope={dirty:s,ctx:t}),i.$set(l)},i(t){f||(S(o.$$.fragment,t),S(i.$$.fragment,t),f=!0)},o(t){I(o.$$.fragment,t),I(i.$$.fragment,t),f=!1},d(t){t&&g(e),x(o),x(i),n=!1,c()}}}function Z(m,e,o){let a;j(m,M,n=>o(4,a=n));let r,p=!1;return[p,async n=>{var c;const t=n.target,s=(c=t==null?void 0:t.files)===null||c===void 0?void 0:c[0],l=new FileReader;s&&(l.readAsText(s),l.onload=()=>{var v,h;try{const $=(h=(v=l==null?void 0:l.result)===null||v===void 0?void 0:v.toString())!==null&&h!==void 0?h:"";r=O($),o(0,p=!0)}catch{B.push({variant:"error",message:d("events.event-history-load-error")}),o(0,p=!1)}})},async()=>{try{const n=await z(Array.isArray(r)?r:r==null?void 0:r.events),c=W(n);J.set(n),K.set(c),o(0,p=!1);const t=Q(a,"feed");P(t)}catch(n){console.error(n),B.push({variant:"error",message:d("events.event-history-import-error")})}}]}class ut extends q{constructor(e){super(),D(this,e,Z,Y,L,{})}}export{ut as E};

import{s as fe,d as p,i as w,k as T,l as C,n as j,c as M,U as be,L as ve,v as P,h as L,j as W,e as B,m as H,f as O,t as J,O as Z,a3 as x,x as ye,w as ee,o as ue}from"../chunks/scheduler.gES7FyoG.js";import{S as ie,i as ce,t as d,a as _,g as me,e as pe,d as k,m as b,c as v,b as y,h as te}from"../chunks/index.DpnGbpCk.js";import{p as _e}from"../chunks/stores.BcCtUVTJ.js";import{P as qe}from"../chunks/page-title.ClCB4mI7.js";import{t as h}from"../chunks/translate.DzDeFYDI.js";import{W as Ie}from"../chunks/workflow-padded-layout.gz2wk-vN.js";import{h as re,u as Ee}from"../chunks/await_block.DZqQ62ob.js";import{e as oe}from"../chunks/each.CDwUSmAp.js";import{P as Pe}from"../chunks/payload-input.DxBQwu2n.js";import{B as Te}from"../chunks/button.B4cN3pxv.js";import{C as Ce}from"../chunks/card.B8kKqjal.js";import{C as je}from"../chunks/code-block.BUBnUlxs.js";import{E as de}from"../chunks/empty-state.D2QxL8QK.js";import{L as De}from"../chunks/loading.DF-snJ6W.js";import{S as Se,O as Ve}from"../chunks/option.Cx401puE.js";import{T as We}from"../chunks/toggle-switch.RudSEM5G.js";import{a as Be,b as Oe}from"../chunks/query-service.D0D-I_xQ.js";import{a as Re}from"../chunks/auth-user.CX4MWHld.js";import{w as ne}from"../chunks/workflow-run.CcdzL0He.js";import{e as Le}from"../chunks/encode-payload.C8S66UF-.js";import{s as Ue}from"../chunks/parse-with-big-int.DJQKqIvA.js";function le(s){s[31]=s[33][0],s[32]=s[33][1];const e=typeof s[31]!="string"?Ue(s[31]):s[31];s[34]=e}function se(s,e,t){const r=s.slice();return r[33]=e[t].name,r[36]=e[t].description!==void 0?e[t].description:"",r}function Me(s){let e,t,r,o,a,n;t=new Ce({props:{class:"mt-7 flex h-fit w-full flex-col gap-2",$$slots:{default:[Ge]},$$scope:{ctx:s}}});let f={ctx:s,current:null,token:null,hasCatch:!0,pending:Ke,then:Je,catch:He,value:33,error:35,blocks:[,,,]};return re(a=Promise.all([s[6],s[7]]),f),{c(){e=j("div"),y(t.$$.fragment),r=O(),o=j("div"),f.block.c(),this.h()},l(l){e=T(l,"DIV",{class:!0});var u=C(e);v(t.$$.fragment,u),r=B(u),o=T(u,"DIV",{class:!0});var c=C(o);f.block.l(c),c.forEach(p),u.forEach(p),this.h()},h(){W(o,"class","flex w-full flex-col gap-2"),W(e,"class","flex w-3/4 gap-4 max-2xl:w-full max-lg:flex-col")},m(l,u){w(l,e,u),b(t,e,null),L(e,r),L(e,o),f.block.m(o,f.anchor=null),f.mount=()=>o,f.anchor=null,n=!0},p(l,u){s=l;const c={};u[0]&535|u[1]&256&&(c.$$scope={dirty:u,ctx:s}),t.$set(c),f.ctx=s,u[0]&192&&a!==(a=Promise.all([s[6],s[7]]))&&re(a,f)||Ee(f,s,u)},i(l){n||(_(t.$$.fragment,l),_(f.block),n=!0)},o(l){d(t.$$.fragment,l);for(let u=0;u<3;u+=1){const c=f.blocks[u];d(c)}n=!1},d(l){l&&p(e),k(t),f.block.d(),f.token=null,f=null}}}function Ne(s){let e,t,r,o,a=h("workflows.no-workers-failure-message")+"",n,f;return t=new De({}),{c(){e=j("div"),y(t.$$.fragment),r=O(),o=j("p"),n=J(a),this.h()},l(l){e=T(l,"DIV",{class:!0});var u=C(e);v(t.$$.fragment,u),r=B(u),o=T(u,"P",{class:!0});var c=C(o);n=H(c,a),c.forEach(p),u.forEach(p),this.h()},h(){W(o,"class","-mt-10"),W(e,"class","text-center")},m(l,u){w(l,e,u),b(t,e,null),L(e,r),L(e,o),L(o,n),f=!0},p:P,i(l){f||(_(t.$$.fragment,l),f=!0)},o(l){d(t.$$.fragment,l),f=!1},d(l){l&&p(e),k(t)}}}function Qe(s){var r,o;let e,t;return e=new de({props:{title:h("common.error-occurred"),content:h("workflows.no-workers-running-message"),error:(o=(r=s[3].metadata)==null?void 0:r.error)==null?void 0:o.message}}),{c(){y(e.$$.fragment)},l(a){v(e.$$.fragment,a)},m(a,n){b(e,a,n),t=!0},p(a,n){var l,u;const f={};n[0]&8&&(f.error=(u=(l=a[3].metadata)==null?void 0:l.error)==null?void 0:u.message),e.$set(f)},i(a){t||(_(e.$$.fragment,a),t=!0)},o(a){d(e.$$.fragment,a),t=!1},d(a){k(e,a)}}}function Ae(s){let e=s[33]+"",t;return{c(){t=J(e)},l(r){t=H(r,e)},m(r,o){w(r,t,o)},p(r,o){o[0]&4&&e!==(e=r[33]+"")&&ue(t,e)},d(r){r&&p(t)}}}function ae(s){let e,t;return e=new Ve({props:{value:s[33],description:s[36],$$slots:{default:[Ae]},$$scope:{ctx:s}}}),{c(){y(e.$$.fragment)},l(r){v(e.$$.fragment,r)},m(r,o){b(e,r,o),t=!0},p(r,o){const a={};o[0]&4&&(a.value=r[33]),o[0]&4&&(a.description=r[36]),o[0]&4|o[1]&256&&(a.$$scope={dirty:o,ctx:r}),e.$set(a)},i(r){t||(_(e.$$.fragment,r),t=!0)},o(r){d(e.$$.fragment,r),t=!1},d(r){k(e,r)}}}function Fe(s){let e,t,r=oe(s[2]),o=[];for(let n=0;n<r.length;n+=1)o[n]=ae(se(s,r,n));const a=n=>d(o[n],1,1,()=>{o[n]=null});return{c(){for(let n=0;n<o.length;n+=1)o[n].c();e=ee()},l(n){for(let f=0;f<o.length;f+=1)o[f].l(n);e=ee()},m(n,f){for(let l=0;l<o.length;l+=1)o[l]&&o[l].m(n,f);w(n,e,f),t=!0},p(n,f){if(f[0]&4){r=oe(n[2]);let l;for(l=0;l<r.length;l+=1){const u=se(n,r,l);o[l]?(o[l].p(u,f),_(o[l],1)):(o[l]=ae(u),o[l].c(),_(o[l],1),o[l].m(e.parentNode,e))}for(me(),l=r.length;l<o.length;l+=1)a(l);pe()}},i(n){if(!t){for(let f=0;f<r.length;f+=1)_(o[f]);t=!0}},o(n){o=o.filter(Boolean);for(let f=0;f<o.length;f+=1)d(o[f]);t=!1},d(n){n&&p(e),ye(o,n)}}}function ze(s){let e=(s[9]?h("workflows.run-query"):h("workflows.refresh-query"))+"",t;return{c(){t=J(e)},l(r){t=H(r,e)},m(r,o){w(r,t,o)},p(r,o){o[0]&512&&e!==(e=(r[9]?h("workflows.run-query"):h("workflows.refresh-query"))+"")&&ue(t,e)},d(r){r&&p(t)}}}function Ge(s){let e,t,r,o,a,n,f,l,u,c;function D(i){s[19](i)}let I={id:"query-select",label:h("workflows.query-type"),class:"min-w-fit","data-testid":"query-select",required:!0,$$slots:{default:[Fe]},$$scope:{ctx:s}};s[0]!==void 0&&(I.value=s[0]),e=new Se({props:I}),Z.push(()=>te(e,"value",D));function S(i){s[20](i)}let E={label:h("workflows.query-arg")};return s[1]!==void 0&&(E.input=s[1]),a=new Pe({props:E}),Z.push(()=>te(a,"input",S)),u=new Te({props:{loading:s[4],variant:s[9]?"primary":"secondary",leadingIcon:s[9]?null:"retry",disabled:s[4],$$slots:{default:[ze]},$$scope:{ctx:s}}}),u.$on("click",s[21]),{c(){y(e.$$.fragment),r=O(),o=j("div"),y(a.$$.fragment),f=O(),l=j("div"),y(u.$$.fragment),this.h()},l(i){v(e.$$.fragment,i),r=B(i),o=T(i,"DIV",{class:!0});var m=C(o);v(a.$$.fragment,m),m.forEach(p),f=B(i),l=T(i,"DIV",{class:!0});var q=C(l);v(u.$$.fragment,q),q.forEach(p),this.h()},h(){W(o,"class","flex flex-col gap-1"),W(l,"class","flex w-full flex-wrap items-end justify-end gap-4")},m(i,m){b(e,i,m),w(i,r,m),w(i,o,m),b(a,o,null),w(i,f,m),w(i,l,m),b(u,l,null),c=!0},p(i,m){const q={};m[0]&4|m[1]&256&&(q.$$scope={dirty:m,ctx:i}),!t&&m[0]&1&&(t=!0,q.value=i[0],x(()=>t=!1)),e.$set(q);const U={};!n&&m[0]&2&&(n=!0,U.input=i[1],x(()=>n=!1)),a.$set(U);const $={};m[0]&16&&($.loading=i[4]),m[0]&512&&($.variant=i[9]?"primary":"secondary"),m[0]&512&&($.leadingIcon=i[9]?null:"retry"),m[0]&16&&($.disabled=i[4]),m[0]&512|m[1]&256&&($.$$scope={dirty:m,ctx:i}),u.$set($)},i(i){c||(_(e.$$.fragment,i),_(a.$$.fragment,i),_(u.$$.fragment,i),c=!0)},o(i){d(e.$$.fragment,i),d(a.$$.fragment,i),d(u.$$.fragment,i),c=!1},d(i){i&&(p(r),p(o),p(f),p(l)),k(e,i),k(a),k(u)}}}function He(s){var r;let e,t;return e=new de({props:{title:h("common.error-occurred"),error:(r=s[35])==null?void 0:r.message}}),{c(){y(e.$$.fragment)},l(o){v(e.$$.fragment,o)},m(o,a){b(e,o,a),t=!0},p(o,a){var f;const n={};a[0]&192&&(n.error=(f=o[35])==null?void 0:f.message),e.$set(n)},i(o){t||(_(e.$$.fragment,o),t=!0)},o(o){d(e.$$.fragment,o),t=!1},d(o){k(e,o)}}}function Je(s){le(s);let e,t,r,o,a;return t=new We({props:{label:h("workflows.json-formatting"),labelPosition:"left",id:"json-formatting",checked:s[5]}}),t.$on("change",s[22]),o=new je({props:{content:s[34],language:s[5]?"json":"text",copyIconTitle:h("common.copy-icon-title"),copySuccessIconTitle:h("common.copy-success-icon-title"),testId:"query-result",class:s[9]&&"opacity-50"}}),{c(){e=j("div"),y(t.$$.fragment),r=O(),y(o.$$.fragment),this.h()},l(n){e=T(n,"DIV",{class:!0});var f=C(e);v(t.$$.fragment,f),f.forEach(p),r=B(n),v(o.$$.fragment,n),this.h()},h(){W(e,"class","ml-auto")},m(n,f){w(n,e,f),b(t,e,null),w(n,r,f),b(o,n,f),a=!0},p(n,f){le(n);const l={};f[0]&32&&(l.checked=n[5]),t.$set(l);const u={};f[0]&192&&(u.content=n[34]),f[0]&32&&(u.language=n[5]?"json":"text"),f[0]&512&&(u.class=n[9]&&"opacity-50"),o.$set(u)},i(n){a||(_(t.$$.fragment,n),_(o.$$.fragment,n),a=!0)},o(n){d(t.$$.fragment,n),d(o.$$.fragment,n),a=!1},d(n){n&&(p(e),p(r)),k(t),k(o,n)}}}function Ke(s){return{c:P,l:P,m:P,p:P,i:P,o:P,d:P}}function Xe(s){let e,t,r,o;const a=[Qe,Ne,Me],n=[];function f(l,u){return l[8]?0:l[2].length?2:1}return t=f(s),r=n[t]=a[t](s),{c(){e=j("section"),r.c()},l(l){e=T(l,"SECTION",{});var u=C(e);r.l(u),u.forEach(p)},m(l,u){w(l,e,u),n[t].m(e,null),o=!0},p(l,u){let c=t;t=f(l),t===c?n[t].p(l,u):(me(),d(n[c],1,1,()=>{n[c]=null}),pe(),r=n[t],r?r.p(l,u):(r=n[t]=a[t](l),r.c()),_(r,1),r.m(e,null))},i(l){o||(_(r),o=!0)},o(l){d(r),o=!1},d(l){l&&p(e),n[t].d()}}}function Ye(s,e,t){let r,o,a,n,f,l;M(s,Re,g=>t(23,n=g)),M(s,_e,g=>t(24,f=g)),M(s,ne,g=>t(3,l=g));var u,c,D,I,S,E;const{namespace:i,workflow:m,run:q}=f.params,U={id:m,runId:q};let $,N,V="",Q="",A=!1,F=!0,K,z;be(()=>{l.metadata||ge()});const ge=async()=>{const{settings:g}=f.data,R=await Be({namespace:i,workflow:{id:m,runId:q}},g,n==null?void 0:n.accessToken);ve(ne,l.metadata=R,l)},X=()=>{t(4,A=!1),t(17,N=$),t(18,Q=V)},Y=async g=>{var R;t(4,A=!0);let G;try{t(7,z=V?Le({input:V,encoding:"json/plain",encodeWithCodec:!1}):Promise.resolve(null)),G=await z}catch{X();return}t(6,K=Oe({namespace:i,workflow:U,queryType:g,queryArgs:G?{payloads:G}:null},(R=f.data)===null||R===void 0?void 0:R.settings,n==null?void 0:n.accessToken).finally(()=>{X()}))};function $e(g){$=g,t(0,$),t(2,a),t(16,E),t(3,l),t(13,D),t(14,I),t(15,S)}function he(g){V=g,t(1,V)}const we=()=>Y($),ke=()=>t(5,F=!F);return s.$$.update=()=>{s.$$.dirty[0]&57352&&t(2,a=(t(15,S=t(14,I=t(13,D=l==null?void 0:l.metadata)===null||D===void 0?void 0:D.definition)===null||I===void 0?void 0:I.queryDefinitions)===null||S===void 0?void 0:S.filter(g=>(g==null?void 0:g.name)!=="__stack_trace"))||[]),s.$$.dirty[0]&65541&&t(0,$=$||(t(16,E=a==null?void 0:a[0])===null||E===void 0?void 0:E.name)),s.$$.dirty[0]&393219&&t(9,r=N!==$||V!==Q),s.$$.dirty[0]&6152&&t(8,o=t(12,c=t(11,u=l.metadata)===null||u===void 0?void 0:u.error)===null||c===void 0?void 0:c.message)},[$,V,a,l,A,F,K,z,o,r,Y,u,c,D,I,S,E,N,Q,$e,he,we,ke]}class Ze extends ie{constructor(e){super(),ce(this,e,Ye,Xe,fe,{},null,[-1,-1])}}function xe(s){let e,t;return e=new Ze({}),{c(){y(e.$$.fragment)},l(r){v(e.$$.fragment,r)},m(r,o){b(e,r,o),t=!0},i(r){t||(_(e.$$.fragment,r),t=!0)},o(r){d(e.$$.fragment,r),t=!1},d(r){k(e,r)}}}function et(s){let e,t,r,o;return e=new qe({props:{title:`${h("workflows.queries-tab")} | ${s[1]}`,url:s[0].url.href}}),r=new Ie({props:{$$slots:{default:[xe]},$$scope:{ctx:s}}}),{c(){y(e.$$.fragment),t=O(),y(r.$$.fragment)},l(a){v(e.$$.fragment,a),t=B(a),v(r.$$.fragment,a)},m(a,n){b(e,a,n),w(a,t,n),b(r,a,n),o=!0},p(a,[n]){const f={};n&1&&(f.url=a[0].url.href),e.$set(f);const l={};n&4&&(l.$$scope={dirty:n,ctx:a}),r.$set(l)},i(a){o||(_(e.$$.fragment,a),_(r.$$.fragment,a),o=!0)},o(a){d(e.$$.fragment,a),d(r.$$.fragment,a),o=!1},d(a){a&&p(t),k(e,a),k(r,a)}}}function tt(s,e,t){let r;M(s,_e,a=>t(0,r=a));const o=r.params.workflow;return[r,o]}class qt extends ie{constructor(e){super(),ce(this,e,tt,et,fe,{})}}export{qt as component};

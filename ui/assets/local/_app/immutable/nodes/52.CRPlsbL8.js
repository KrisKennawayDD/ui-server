import{s as O,a2 as U,d as N,i as S,h as L,j as A,k as D,l as F,e as R,m as V,n as I,f as T,t as Z,c as z,v as j}from"../chunks/scheduler.gES7FyoG.js";import{S as Q,i as G,d as w,t as C,a as b,m as k,c as x,b as P}from"../chunks/index.DpnGbpCk.js";import{g as K}from"../chunks/entry.DM4OBogV.js";import{p as W}from"../chunks/stores.DQUZC3a9.js";import{P as X}from"../chunks/page-title.ClCB4mI7.js";import{t as v}from"../chunks/translate.DzDeFYDI.js";import{B as J}from"../chunks/button.BLkt92q5.js";import{L as Y}from"../chunks/link.DQ6Dl6MQ.js";import{N as y,e as M}from"../chunks/nexus-form.BCbamRDt.js";import{h as B}from"../chunks/route-for.C4VnuYHC.js";import{c as ee}from"../chunks/nexus-service.DhN1eXZi.js";import{n as te}from"../chunks/namespaces.L1SJq_vu.js";import{e as ae}from"../chunks/encode-payload.BKdeyC3W.js";function ne(e){let t=v("nexus.back-to-endpoints")+"",a;return{c(){a=Z(t)},l(n){a=V(n,t)},m(n,i){S(n,a,i)},p:j,d(n){n&&N(a)}}}function se(e){let t=v("nexus.create-endpoint")+"",a;return{c(){a=Z(t)},l(n){a=V(n,t)},m(n,i){S(n,a,i)},p:j,d(n){n&&N(a)}}}function re(e){let t=v("common.cancel")+"",a;return{c(){a=Z(t)},l(n){a=V(n,t)},m(n,i){S(n,a,i)},p:j,d(n){n&&N(a)}}}function oe(e){let t,a,n,i,s,m=v("nexus.create-endpoint")+"",p,c,u,l,g,d,H,r,$;return n=new Y({props:{href:B(),icon:"chevron-left",$$slots:{default:[ne]},$$scope:{ctx:e}}}),u=new y({props:{nameRegexPattern:e[6],nameHintText:e[7],error:e[3],targetNamespaceList:e[1],callerNamespaceList:e[2],isCloud:e[5]}}),d=new J({props:{variant:"primary",disabled:e[8],class:"max-sm:w-full",loading:e[4],$$slots:{default:[se]},$$scope:{ctx:e}}}),d.$on("click",function(){U(e[0])&&e[0].apply(this,arguments)}),r=new J({props:{variant:"ghost",class:"max-sm:w-full",$$slots:{default:[re]},$$scope:{ctx:e}}}),r.$on("click",e[10]),{c(){t=I("div"),a=I("div"),P(n.$$.fragment),i=T(),s=I("h1"),p=Z(m),c=T(),P(u.$$.fragment),l=T(),g=I("div"),P(d.$$.fragment),H=T(),P(r.$$.fragment),this.h()},l(f){t=D(f,"DIV",{class:!0});var o=F(t);a=D(o,"DIV",{class:!0});var E=F(a);x(n.$$.fragment,E),E.forEach(N),i=R(o),s=D(o,"H1",{"data-testid":!0});var _=F(s);p=V(_,m),_.forEach(N),c=R(o),x(u.$$.fragment,o),l=R(o),g=D(o,"DIV",{class:!0});var h=F(g);x(d.$$.fragment,h),H=R(h),x(r.$$.fragment,h),h.forEach(N),o.forEach(N),this.h()},h(){A(a,"class","text-sm"),A(s,"data-testid","namespace-selector-title"),A(g,"class","flex flex-row items-center gap-4 max-sm:flex-col"),A(t,"class","flex w-full flex-col gap-8")},m(f,o){S(f,t,o),L(t,a),k(n,a,null),L(t,i),L(t,s),L(s,p),L(t,c),k(u,t,null),L(t,l),L(t,g),k(d,g,null),L(g,H),k(r,g,null),$=!0},p(f,[o]){e=f;const E={};o&2048&&(E.$$scope={dirty:o,ctx:e}),n.$set(E);const _={};o&64&&(_.nameRegexPattern=e[6]),o&128&&(_.nameHintText=e[7]),o&8&&(_.error=e[3]),o&2&&(_.targetNamespaceList=e[1]),o&4&&(_.callerNamespaceList=e[2]),o&32&&(_.isCloud=e[5]),u.$set(_);const h={};o&256&&(h.disabled=e[8]),o&16&&(h.loading=e[4]),o&2048&&(h.$$scope={dirty:o,ctx:e}),d.$set(h);const q={};o&2048&&(q.$$scope={dirty:o,ctx:e}),r.$set(q)},i(f){$||(b(n.$$.fragment,f),b(u.$$.fragment,f),b(d.$$.fragment,f),b(r.$$.fragment,f),$=!0)},o(f){C(n.$$.fragment,f),C(u.$$.fragment,f),C(d.$$.fragment,f),C(r.$$.fragment,f),$=!1},d(f){f&&N(t),w(n),w(u),w(d),w(r)}}}function ie(e,t,a){let n,i;z(e,M,r=>a(9,i=r));let{onCreate:s}=t,{targetNamespaceList:m=[]}=t,{callerNamespaceList:p=[]}=t,{error:c=void 0}=t,{loading:u=!1}=t,{isCloud:l=!1}=t,{nameRegexPattern:g=/^[a-zA-Z][a-zA-Z0-9-]*[a-zA-Z0-9]$/}=t,{nameHintText:d=v("nexus.endpoint-name-hint-with-dash")}=t;const H=()=>K(B());return e.$$set=r=>{"onCreate"in r&&a(0,s=r.onCreate),"targetNamespaceList"in r&&a(1,m=r.targetNamespaceList),"callerNamespaceList"in r&&a(2,p=r.callerNamespaceList),"error"in r&&a(3,c=r.error),"loading"in r&&a(4,u=r.loading),"isCloud"in r&&a(5,l=r.isCloud),"nameRegexPattern"in r&&a(6,g=r.nameRegexPattern),"nameHintText"in r&&a(7,d=r.nameHintText)},e.$$.update=()=>{e.$$.dirty&512&&a(8,n=i.spec.name===""||i.spec.target.worker.namespace===""||i.spec.target.worker.taskQueue==="")},[s,m,p,c,u,l,g,d,n,i,H]}class le extends Q{constructor(t){super(),G(this,t,ie,oe,O,{onCreate:0,targetNamespaceList:1,callerNamespaceList:2,error:3,loading:4,isCloud:5,nameRegexPattern:6,nameHintText:7})}}function me(e){let t,a,n,i;return t=new X({props:{title:v("nexus.create-endpoint"),url:e[3].url.href}}),n=new le({props:{onCreate:e[4],targetNamespaceList:e[2],error:e[0],loading:e[1]}}),{c(){P(t.$$.fragment),a=T(),P(n.$$.fragment)},l(s){x(t.$$.fragment,s),a=R(s),x(n.$$.fragment,s)},m(s,m){k(t,s,m),S(s,a,m),k(n,s,m),i=!0},p(s,[m]){const p={};m&8&&(p.url=s[3].url.href),t.$set(p);const c={};m&4&&(c.targetNamespaceList=s[2]),m&1&&(c.error=s[0]),m&2&&(c.loading=s[1]),n.$set(c)},i(s){i||(b(t.$$.fragment,s),b(n.$$.fragment,s),i=!0)},o(s){C(t.$$.fragment,s),C(n.$$.fragment,s),i=!1},d(s){s&&N(a),w(t,s),w(n,s)}}}function fe(e,t,a){let n,i,s,m;z(e,te,l=>a(5,i=l)),z(e,M,l=>a(6,s=l)),z(e,W,l=>a(3,m=l));let p,c=!1;const u=async()=>{a(1,c=!0);try{const l={...s},g=await ae({input:JSON.stringify(l.spec.descriptionString),encoding:"json/plain"});l.spec.description=g[0],delete l.spec.allowedCallerNamespaces,delete l.spec.descriptionString,await ee(l),K(B(),{invalidateAll:!0})}catch(l){a(0,p=l),console.error("Error creating endpoint",l)}finally{a(1,c=!1)}};return e.$$.update=()=>{e.$$.dirty&32&&a(2,n=i.map(l=>({namespace:l.namespaceInfo.name})))},[p,c,n,m,u,i]}class xe extends Q{constructor(t){super(),G(this,t,fe,me,O,{})}}export{xe as component};

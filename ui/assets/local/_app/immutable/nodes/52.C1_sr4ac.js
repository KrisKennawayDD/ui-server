import{s as O,a3 as U,h as A,b as R,t as V,j as D,k as F,f as N,d as T,l as Z,m as I,i as S,n as L,c as z,v as j}from"../chunks/scheduler.CnYDgCRb.js";import{S as Q,i as G,c as w,a as C,m as b,t as k,b as x,d as P}from"../chunks/index.DW7Zsqzm.js";import{g as K}from"../chunks/entry.jzP5rKgD.js";import{p as W}from"../chunks/stores.CTPD-FTa.js";import{P as X}from"../chunks/page-title.DEkRIe-Y.js";import{t as v}from"../chunks/translate.BBe5dcco.js";import{B as J}from"../chunks/button.CG98sDLL.js";import{L as Y}from"../chunks/link.CI-k1dHl.js";import{N as y,e as M}from"../chunks/nexus-form.BTxZ4cb6.js";import{h as B}from"../chunks/route-for.BszqtQpI.js";import{c as ee}from"../chunks/nexus-service.CScqklgg.js";import{n as te}from"../chunks/namespaces.B4rCXa7p.js";import{e as ae}from"../chunks/encode-payload.B7JBb0pa.js";function ne(e){let t=v("nexus.back-to-endpoints")+"",a;return{c(){a=V(t)},l(n){a=Z(n,t)},m(n,i){S(n,a,i)},p:j,d(n){n&&N(a)}}}function se(e){let t=v("nexus.create-endpoint")+"",a;return{c(){a=V(t)},l(n){a=Z(n,t)},m(n,i){S(n,a,i)},p:j,d(n){n&&N(a)}}}function re(e){let t=v("common.cancel")+"",a;return{c(){a=V(t)},l(n){a=Z(n,t)},m(n,i){S(n,a,i)},p:j,d(n){n&&N(a)}}}function oe(e){let t,a,n,i,s,m=v("nexus.create-endpoint")+"",p,c,u,l,g,d,H,r,$;return n=new Y({props:{href:B(),icon:"chevron-left",$$slots:{default:[ne]},$$scope:{ctx:e}}}),u=new y({props:{nameRegexPattern:e[6],nameHintText:e[7],error:e[3],targetNamespaceList:e[1],callerNamespaceList:e[2],isCloud:e[5]}}),d=new J({props:{variant:"primary",disabled:e[8],class:"max-sm:w-full",loading:e[4],$$slots:{default:[se]},$$scope:{ctx:e}}}),d.$on("click",function(){U(e[0])&&e[0].apply(this,arguments)}),r=new J({props:{variant:"ghost",class:"max-sm:w-full",$$slots:{default:[re]},$$scope:{ctx:e}}}),r.$on("click",e[10]),{c(){t=A("div"),a=A("div"),w(n.$$.fragment),i=R(),s=A("h1"),p=V(m),c=R(),w(u.$$.fragment),l=R(),g=A("div"),w(d.$$.fragment),H=R(),w(r.$$.fragment),this.h()},l(f){t=D(f,"DIV",{class:!0});var o=F(t);a=D(o,"DIV",{class:!0});var E=F(a);C(n.$$.fragment,E),E.forEach(N),i=T(o),s=D(o,"H1",{"data-testid":!0});var _=F(s);p=Z(_,m),_.forEach(N),c=T(o),C(u.$$.fragment,o),l=T(o),g=D(o,"DIV",{class:!0});var h=F(g);C(d.$$.fragment,h),H=T(h),C(r.$$.fragment,h),h.forEach(N),o.forEach(N),this.h()},h(){I(a,"class","text-sm"),I(s,"data-testid","namespace-selector-title"),I(g,"class","flex flex-row items-center gap-4 max-sm:flex-col"),I(t,"class","flex w-full flex-col gap-8")},m(f,o){S(f,t,o),L(t,a),b(n,a,null),L(t,i),L(t,s),L(s,p),L(t,c),b(u,t,null),L(t,l),L(t,g),b(d,g,null),L(g,H),b(r,g,null),$=!0},p(f,[o]){e=f;const E={};o&2048&&(E.$$scope={dirty:o,ctx:e}),n.$set(E);const _={};o&64&&(_.nameRegexPattern=e[6]),o&128&&(_.nameHintText=e[7]),o&8&&(_.error=e[3]),o&2&&(_.targetNamespaceList=e[1]),o&4&&(_.callerNamespaceList=e[2]),o&32&&(_.isCloud=e[5]),u.$set(_);const h={};o&256&&(h.disabled=e[8]),o&16&&(h.loading=e[4]),o&2048&&(h.$$scope={dirty:o,ctx:e}),d.$set(h);const q={};o&2048&&(q.$$scope={dirty:o,ctx:e}),r.$set(q)},i(f){$||(k(n.$$.fragment,f),k(u.$$.fragment,f),k(d.$$.fragment,f),k(r.$$.fragment,f),$=!0)},o(f){x(n.$$.fragment,f),x(u.$$.fragment,f),x(d.$$.fragment,f),x(r.$$.fragment,f),$=!1},d(f){f&&N(t),P(n),P(u),P(d),P(r)}}}function ie(e,t,a){let n,i;z(e,M,r=>a(9,i=r));let{onCreate:s}=t,{targetNamespaceList:m=[]}=t,{callerNamespaceList:p=[]}=t,{error:c=void 0}=t,{loading:u=!1}=t,{isCloud:l=!1}=t,{nameRegexPattern:g=/^[a-zA-Z][a-zA-Z0-9-]*[a-zA-Z0-9]$/}=t,{nameHintText:d=v("nexus.endpoint-name-hint-with-dash")}=t;const H=()=>K(B());return e.$$set=r=>{"onCreate"in r&&a(0,s=r.onCreate),"targetNamespaceList"in r&&a(1,m=r.targetNamespaceList),"callerNamespaceList"in r&&a(2,p=r.callerNamespaceList),"error"in r&&a(3,c=r.error),"loading"in r&&a(4,u=r.loading),"isCloud"in r&&a(5,l=r.isCloud),"nameRegexPattern"in r&&a(6,g=r.nameRegexPattern),"nameHintText"in r&&a(7,d=r.nameHintText)},e.$$.update=()=>{e.$$.dirty&512&&a(8,n=i.spec.name===""||i.spec.target.worker.namespace===""||i.spec.target.worker.taskQueue==="")},[s,m,p,c,u,l,g,d,n,i,H]}class le extends Q{constructor(t){super(),G(this,t,ie,oe,O,{onCreate:0,targetNamespaceList:1,callerNamespaceList:2,error:3,loading:4,isCloud:5,nameRegexPattern:6,nameHintText:7})}}function me(e){let t,a,n,i;return t=new X({props:{title:v("nexus.create-endpoint"),url:e[3].url.href}}),n=new le({props:{onCreate:e[4],targetNamespaceList:e[2],error:e[0],loading:e[1]}}),{c(){w(t.$$.fragment),a=R(),w(n.$$.fragment)},l(s){C(t.$$.fragment,s),a=T(s),C(n.$$.fragment,s)},m(s,m){b(t,s,m),S(s,a,m),b(n,s,m),i=!0},p(s,[m]){const p={};m&8&&(p.url=s[3].url.href),t.$set(p);const c={};m&4&&(c.targetNamespaceList=s[2]),m&1&&(c.error=s[0]),m&2&&(c.loading=s[1]),n.$set(c)},i(s){i||(k(t.$$.fragment,s),k(n.$$.fragment,s),i=!0)},o(s){x(t.$$.fragment,s),x(n.$$.fragment,s),i=!1},d(s){s&&N(a),P(t,s),P(n,s)}}}function fe(e,t,a){let n,i,s,m;z(e,te,l=>a(5,i=l)),z(e,M,l=>a(6,s=l)),z(e,W,l=>a(3,m=l));let p,c=!1;const u=async()=>{a(1,c=!0);try{const l={...s},g=await ae({input:JSON.stringify(l.spec.descriptionString),encoding:"json/plain"});l.spec.description=g[0],delete l.spec.allowedCallerNamespaces,delete l.spec.descriptionString,await ee(l),K(B(),{invalidateAll:!0})}catch(l){a(0,p=l),console.error("Error creating endpoint",l)}finally{a(1,c=!1)}};return e.$$.update=()=>{e.$$.dirty&32&&a(2,n=i.map(l=>({namespace:l.namespaceInfo.name})))},[p,c,n,m,u,i]}class xe extends Q{constructor(t){super(),G(this,t,fe,me,O,{})}}export{xe as component};

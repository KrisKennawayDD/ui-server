import"../chunks/CWj6FrbW.js";import"../chunks/69_IOA4Y.js";import{p as qe,l as J,a as Me,b as Pe,R as $e,s as r,az as o,m as s,g as e,e as w,r as $,d as t,c as I,t as ce,f as K,n as ye,aL as Oe}from"../chunks/TEoZ9D9Z.js";import{t as j,a as v,c as Qe,b as xe}from"../chunks/DI329M-6.js";import{i as Te}from"../chunks/BJuz8Fsc.js";import{a as N,s as Ie,e as ze}from"../chunks/D2XfxJd9.js";import{p as je}from"../chunks/Dxw_utjF.js";import{P as Ae}from"../chunks/B-eb-MOu.js";import{t as l}from"../chunks/D2OY9xdY.js";import{W as Fe}from"../chunks/DjLNuOnz.js";import{s as ue}from"../chunks/BPileDmx.js";import{a as Ge}from"../chunks/BEKDPOX9.js";import{i as ke}from"../chunks/CnwVc_TY.js";import{e as He,i as Je}from"../chunks/DRNLmldh.js";import{o as Ke}from"../chunks/B6cJqjof.js";import{P as Ne}from"../chunks/BiB_yypJ.js";import{B as Ve}from"../chunks/DuqPjRD8.js";import{C as Xe}from"../chunks/CZmSu19l.js";import{C as Ye}from"../chunks/1-tjg9t8.js";import{E as he}from"../chunks/D3GaTxIA.js";import{L as Ze}from"../chunks/BwI-F7Rp.js";import{S as et,O as tt}from"../chunks/BZHF7hT_.js";import{T as rt}from"../chunks/BcFrahZx.js";import{a as ot,b as st}from"../chunks/Dm2ohEQW.js";import{a as at}from"../chunks/Bo5B6vbu.js";import{w as be}from"../chunks/CJUihH8Z.js";import{e as nt}from"../chunks/Dw_ia_xu.js";import{s as lt}from"../chunks/CTBtQUu0.js";var it=j('<div class="text-center"><!> <p class="-mt-10"> </p></div>'),ct=j('<!> <div class="flex flex-col gap-1"><!></div> <div class="flex w-full flex-wrap items-end justify-end gap-4"><!></div>',1),ut=j('<div class="ml-auto"><!></div> <!>',1),dt=j('<div class="flex w-3/4 gap-4 max-2xl:w-full max-lg:flex-col"><!> <div class="flex w-full flex-col gap-2"><!></div></div>'),ft=j("<section><!></section>");function pt(V,X){qe(X,!1);const[C,Y]=Ie(),q=()=>N(je,"$page",C),n=()=>N(be,"$workflowRun",C),c=()=>N(at,"$authUser",C),g=s(),U=s(),u=s();var P=s(),R=s(),D=s(),M=s(),O=s(),Q=s();const{namespace:de,workflow:fe,run:pe}=q().params,Ce={id:fe,runId:pe};let d=s(),Z=s(),y=s(""),ee=s(""),z=s(!1),A=s(!0),me=s(),te=s();Ke(()=>{n().metadata||Re()});const Re=async()=>{const{settings:a}=q().data,f=await ot({namespace:de,workflow:{id:fe,runId:pe}},a,c()===null||c()===void 0?void 0:c().accessToken);ze(be,$e(n).metadata=f,$e(n))},ve=()=>{r(z,!1),r(Z,e(d)),r(ee,e(y))},We=async a=>{var f;r(z,!0);let x;try{r(te,e(y)?nt({input:e(y),encoding:"json/plain",encodeWithCodec:!1}):Promise.resolve(null)),x=await e(te)}catch{ve();return}r(me,st({namespace:de,workflow:Ce,queryType:a,queryArgs:x?{payloads:x}:null},(f=q().data)===null||f===void 0?void 0:f.settings,c()===null||c()===void 0?void 0:c().accessToken).finally(()=>{ve()}))};J(()=>(o(O),o(M),o(D),n()),()=>{r(u,(r(O,r(M,r(D,n()===null||n()===void 0?void 0:n().metadata)===null||o(D)===void 0?void 0:o(D).definition)===null||o(M)===void 0?void 0:o(M).queryDefinitions)===null||o(O)===void 0?void 0:o(O).filter(a=>(a==null?void 0:a.name)!=="__stack_trace"))||[])}),J(()=>(e(d),o(Q),e(u)),()=>{r(d,e(d)||(r(Q,e(u)===null||e(u)===void 0?void 0:e(u)[0])===null||o(Q)===void 0?void 0:o(Q).name))}),J(()=>(e(Z),e(d),e(y),e(ee)),()=>{r(g,e(Z)!==e(d)||e(y)!==e(ee))}),J(()=>(o(R),o(P),n()),()=>{r(U,r(R,r(P,n().metadata)===null||o(P)===void 0?void 0:o(P).error)===null||o(R)===void 0?void 0:o(R).message)}),Me(),Te();var re=ft(),Be=w(re);{var Ee=a=>{const f=t(()=>l("common.error-occurred")),x=t(()=>l("workflows.no-workers-running-message")),F=t(()=>{var p,i;return(i=(p=n().metadata)==null?void 0:p.error)==null?void 0:i.message});he(a,{get title(){return e(f)},get content(){return e(x)},get error(){return e(F)}})},Le=(a,f)=>{{var x=p=>{var i=it(),W=w(i);Ze(W,{});var B=I(W,2),oe=w(B,!0);$(B),$(i),ce(k=>ue(oe,k),[()=>l("workflows.no-workers-failure-message")],t),v(p,i)},F=p=>{var i=dt(),W=w(i);Xe(W,{class:"mt-7 flex h-fit w-full flex-col gap-2",children:(k,G)=>{var T=ct(),_=K(T);const h=t(()=>l("workflows.query-type"));et(_,{id:"query-select",get label(){return e(h)},class:"min-w-fit","data-testid":"query-select",required:!0,get value(){return e(d)},set value(m){r(d,m)},children:(m,ie)=>{var b=Qe(),S=K(b);He(S,1,()=>e(u),Je,(Se,ge)=>{let _e=()=>e(ge).name,Ue=t(()=>Oe(e(ge).description,""));tt(Se,{get value(){return _e()},get description(){return e(Ue)},children:(De,vt)=>{ye();var we=xe();ce(()=>ue(we,_e())),v(De,we)},$$slots:{default:!0}})}),v(m,b)},$$slots:{default:!0},$$legacy:!0});var E=I(_,2),L=w(E);const se=t(()=>l("workflows.query-arg"));Ne(L,{get label(){return e(se)},get input(){return e(y)},set input(m){r(y,m)},$$legacy:!0}),$(E);var H=I(E,2),ae=w(H);const ne=t(()=>e(g)?"primary":"secondary"),le=t(()=>e(g)?null:"retry");Ve(ae,{get loading(){return e(z)},get variant(){return e(ne)},get leadingIcon(){return e(le)},get disabled(){return e(z)},$$events:{click:()=>We(e(d))},children:(m,ie)=>{ye();var b=xe();ce(S=>ue(b,S),[()=>e(g)?l("workflows.run-query"):l("workflows.refresh-query")],t),v(m,b)},$$slots:{default:!0}}),$(H),v(k,T)},$$slots:{default:!0}});var B=I(W,2),oe=w(B);Ge(oe,()=>Promise.all([e(me),e(te)]),null,(k,G)=>{var T=t(()=>{var[b,S]=e(G);return{result:b,_:S}}),_=t(()=>e(T).result),h=ut();const E=t(()=>typeof e(_)!="string"?lt(e(_)):e(_));var L=K(h),se=w(L);const H=t(()=>l("workflows.json-formatting"));rt(se,{get label(){return e(H)},labelPosition:"left",id:"json-formatting",get checked(){return e(A)},$$events:{change:()=>r(A,!e(A))}}),$(L);var ae=I(L,2);const ne=t(()=>e(A)?"json":"text"),le=t(()=>l("common.copy-icon-title")),m=t(()=>l("common.copy-success-icon-title")),ie=t(()=>e(g)&&"opacity-50");Ye(ae,{get content(){return e(E)},get language(){return e(ne)},get copyIconTitle(){return e(le)},get copySuccessIconTitle(){return e(m)},testId:"query-result",get class(){return e(ie)}}),v(k,h)},(k,G)=>{const T=t(()=>l("common.error-occurred")),_=t(()=>{var h;return(h=e(G))==null?void 0:h.message});he(k,{get title(){return e(T)},get error(){return e(_)}})}),$(B),$(i),v(p,i)};ke(a,p=>{e(u).length?p(F,!1):p(x)},f)}};ke(Be,a=>{e(U)?a(Ee):a(Le,!1)})}$(re),v(V,re),Pe(),Y()}var mt=j("<!> <!>",1);function Ft(V,X){qe(X,!1);const[C,Y]=Ie(),q=()=>N(je,"$page",C),n=q().params.workflow;Te();var c=mt(),g=K(c);const U=t(()=>`${l("workflows.queries-tab")} | ${n}`);Ae(g,{get title(){return e(U)},get url(){return q().url.href}});var u=I(g,2);Fe(u,{children:(P,R)=>{pt(P,{})},$$slots:{default:!0}}),v(V,c),Pe(),Y()}export{Ft as component};

import{s as F,h as L,j as P,k as R,f as p,i as h,c as V,x as A,t as q,l as C,n as b,q as G,v as U,b as D,d as Q,m as B}from"../chunks/scheduler.9nPpm2FE.js";import{S as H,i as J,g as K,b as d,e as M,t as _,c as v,a as y,m as T,d as E}from"../chunks/index.DU2w1i_i.js";import{p as X}from"../chunks/stores.D7T_wYwT.js";import{P as Z}from"../chunks/page-title.BVcIpxci.js";import{t as g}from"../chunks/translate.BBe5dcco.js";import{W as x}from"../chunks/workflow-padded-layout.BE4USKwK.js";import{h as j,u as ee}from"../chunks/await_block.C06z0U3r.js";import{A as te}from"../chunks/alert.NGZ0VcR0.js";import{B as re}from"../chunks/button.BtngrDhf.js";import{C as ne}from"../chunks/code-block.De6BhJ9q.js";import{E as Y}from"../chunks/empty-state.nqX-v1X5.js";import{L as le}from"../chunks/link.Cb3f9P-y.js";import{L as oe}from"../chunks/loading.DGykYoBQ.js";import{g as O}from"../chunks/query-service.Cof5qZw6.js";import{a as ae}from"../chunks/auth-user.D48d0_Hz.js";import{w as se}from"../chunks/workflow-run.dcMeC32i.js";function ce(a){let t,n;return t=new Y({props:{title:g("workflows.call-stack-empty-state"),testId:"query-call-stack-empty",$$slots:{default:[ie]},$$scope:{ctx:a}}}),{c(){v(t.$$.fragment)},l(e){y(t.$$.fragment,e)},m(e,r){T(t,e,r),n=!0},p(e,r){const l={};r&4105&&(l.$$scope={dirty:r,ctx:e}),t.$set(l)},i(e){n||(_(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){E(t,e)}}}function fe(a){let t,n,e,r={ctx:a,current:null,token:null,hasCatch:!0,pending:_e,then:pe,catch:me,value:10,error:11,blocks:[,,,]};return j(n=a[2],r),{c(){t=A(),r.block.c()},l(l){t=A(),r.block.l(l)},m(l,o){h(l,t,o),r.block.m(l,r.anchor=o),r.mount=()=>t.parentNode,r.anchor=t,e=!0},p(l,o){a=l,r.ctx=a,o&4&&n!==(n=a[2])&&j(n,r)||ee(r,a,o)},i(l){e||(_(r.block),e=!0)},o(l){for(let o=0;o<3;o+=1){const s=r.blocks[o];d(s)}e=!1},d(l){l&&p(t),r.block.d(l),r.token=null,r=null}}}function z(a){var c;let t,n=g("workflows.call-stack-link-preface")+"",e,r,l=g("workflows.call-stack-link-postface",{taskQueue:(c=a[0])==null?void 0:c.taskQueue})+"",o,s;return r=new le({props:{newTab:!0,href:"https://docs.temporal.io/workflows#stack-trace-query",$$slots:{default:[ue]},$$scope:{ctx:a}}}),{c(){t=L("p"),e=q(n),v(r.$$.fragment),o=q(l)},l(f){t=P(f,"P",{});var u=R(t);e=C(u,n),y(r.$$.fragment,u),o=C(u,l),u.forEach(p)},m(f,u){h(f,t,u),b(t,e),T(r,t,null),b(t,o),s=!0},p(f,u){var w;const $={};u&4096&&($.$$scope={dirty:u,ctx:f}),r.$set($),(!s||u&1)&&l!==(l=g("workflows.call-stack-link-postface",{taskQueue:(w=f[0])==null?void 0:w.taskQueue})+"")&&G(o,l)},i(f){s||(_(r.$$.fragment,f),s=!0)},o(f){d(r.$$.fragment,f),s=!1},d(f){f&&p(t),E(r)}}}function ue(a){let t=g("workflows.call-stack-link")+"",n;return{c(){n=q(t)},l(e){n=C(e,t)},m(e,r){h(e,n,r)},p:U,d(e){e&&p(n)}}}function ie(a){var r,l,o;let t,n,e=((r=a[0])==null?void 0:r.isRunning)&&((o=(l=a[3])==null?void 0:l.pollers)==null?void 0:o.length)===0&&z(a);return{c(){e&&e.c(),t=A()},l(s){e&&e.l(s),t=A()},m(s,c){e&&e.m(s,c),h(s,t,c),n=!0},p(s,c){var f,u,$;(f=s[0])!=null&&f.isRunning&&(($=(u=s[3])==null?void 0:u.pollers)==null?void 0:$.length)===0?e?(e.p(s,c),c&9&&_(e,1)):(e=z(s),e.c(),_(e,1),e.m(t.parentNode,t)):e&&(K(),d(e,1,1,()=>{e=null}),M())},i(s){n||(_(e),n=!0)},o(s){d(e),n=!1},d(s){s&&p(t),e&&e.d(s)}}}function me(a){var e;let t,n;return t=new Y({props:{title:g("common.error-occurred"),content:g("workflows.no-workers-running-message"),error:(e=a[11])==null?void 0:e.message}}),{c(){v(t.$$.fragment)},l(r){y(t.$$.fragment,r)},m(r,l){T(t,r,l),n=!0},p(r,l){var s;const o={};l&4&&(o.error=(s=r[11])==null?void 0:s.message),t.$set(o)},i(r){n||(_(t.$$.fragment,r),n=!0)},o(r){d(t.$$.fragment,r),n=!1},d(r){E(t,r)}}}function pe(a){let t,n,e,r,l,o,s=g("workflows.call-stack-at")+"",c,f,u=a[1].toLocaleTimeString()+"",$,w,m,I,W;return t=new te({props:{intent:"info",icon:"info",title:g("workflows.call-stack-alert"),class:"mb-4 w-fit"}}),r=new re({props:{leadingIcon:"retry",loading:de,$$slots:{default:[$e]},$$scope:{ctx:a}}}),r.$on("click",a[4]),I=new ne({props:{content:a[10],language:"text",testId:"query-call-stack",copyIconTitle:g("common.copy-icon-title"),copySuccessIconTitle:g("common.copy-success-icon-title")}}),{c(){v(t.$$.fragment),n=D(),e=L("div"),v(r.$$.fragment),l=D(),o=L("p"),c=q(s),f=D(),$=q(u),w=D(),m=L("div"),v(I.$$.fragment),this.h()},l(i){y(t.$$.fragment,i),n=Q(i),e=P(i,"DIV",{class:!0});var k=R(e);y(r.$$.fragment,k),l=Q(k),o=P(k,"P",{});var S=R(o);c=C(S,s),f=Q(S),$=C(S,u),S.forEach(p),k.forEach(p),w=Q(i),m=P(i,"DIV",{class:!0});var N=R(m);y(I.$$.fragment,N),N.forEach(p),this.h()},h(){B(e,"class","flex items-center gap-4"),B(m,"class","my-2 flex h-full items-start")},m(i,k){T(t,i,k),h(i,n,k),h(i,e,k),T(r,e,null),b(e,l),b(e,o),b(o,c),b(o,f),b(o,$),h(i,w,k),h(i,m,k),T(I,m,null),W=!0},p(i,k){const S={};k&4096&&(S.$$scope={dirty:k,ctx:i}),r.$set(S),(!W||k&2)&&u!==(u=i[1].toLocaleTimeString()+"")&&G($,u);const N={};k&4&&(N.content=i[10]),I.$set(N)},i(i){W||(_(t.$$.fragment,i),_(r.$$.fragment,i),_(I.$$.fragment,i),W=!0)},o(i){d(t.$$.fragment,i),d(r.$$.fragment,i),d(I.$$.fragment,i),W=!1},d(i){i&&(p(n),p(e),p(w),p(m)),E(t,i),E(r),E(I)}}}function $e(a){let t=g("common.refresh")+"",n;return{c(){n=q(t)},l(e){n=C(e,t)},m(e,r){h(e,n,r)},p:U,d(e){e&&p(n)}}}function _e(a){let t,n,e,r,l=g("workflows.no-workers-failure-message")+"",o,s;return n=new oe({}),{c(){t=L("div"),v(n.$$.fragment),e=D(),r=L("p"),o=q(l),this.h()},l(c){t=P(c,"DIV",{class:!0});var f=R(t);y(n.$$.fragment,f),e=Q(f),r=P(f,"P",{});var u=R(r);o=C(u,l),u.forEach(p),f.forEach(p),this.h()},h(){B(t,"class","text-center")},m(c,f){h(c,t,f),T(n,t,null),b(t,e),b(t,r),b(r,o),s=!0},p:U,i(c){s||(_(n.$$.fragment,c),s=!0)},o(c){d(n.$$.fragment,c),s=!1},d(c){c&&p(t),E(n)}}}function ke(a){let t,n,e,r;const l=[fe,ce],o=[];function s(c,f){var u,$,w;return(u=c[0])!=null&&u.isRunning&&((w=($=c[3])==null?void 0:$.pollers)==null?void 0:w.length)>0?0:1}return n=s(a),e=o[n]=l[n](a),{c(){t=L("section"),e.c()},l(c){t=P(c,"SECTION",{});var f=R(t);e.l(f),f.forEach(p)},m(c,f){h(c,t,f),o[n].m(t,null),r=!0},p(c,[f]){let u=n;n=s(c),n===u?o[n].p(c,f):(K(),d(o[u],1,1,()=>{o[u]=null}),M(),e=o[n],e?e.p(c,f):(e=o[n]=l[n](c),e.c()),_(e,1),e.m(t,null))},i(c){r||(_(e),r=!0)},o(c){d(e),r=!1},d(c){c&&p(t),o[n].d()}}}let de=!1;function ge(a,t,n){let e,r,l,o,s;V(a,ae,m=>n(6,l=m)),V(a,X,m=>n(7,o=m)),V(a,se,m=>n(5,s=m));const{namespace:c}=o.params;let f=new Date;const u=()=>{var m;return O({workflow:e,namespace:c},(m=o.data)===null||m===void 0?void 0:m.settings,l==null?void 0:l.accessToken)};let $;const w=()=>{var m;n(2,$=O({workflow:e,namespace:c},(m=o.data)===null||m===void 0?void 0:m.settings,l==null?void 0:l.accessToken)),$.then(()=>{n(1,f=new Date)})};return a.$$.update=()=>{a.$$.dirty&32&&n(0,{workflow:e,workers:r}=s,e,(n(3,r),n(5,s))),a.$$.dirty&1&&e!=null&&e.isRunning&&n(2,$=u())},[e,f,$,r,w,s]}class we extends H{constructor(t){super(),J(this,t,ge,ke,F,{})}}function he(a){let t,n;return t=new we({}),{c(){v(t.$$.fragment)},l(e){y(t.$$.fragment,e)},m(e,r){T(t,e,r),n=!0},i(e){n||(_(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){E(t,e)}}}function be(a){let t,n,e,r;return t=new Z({props:{title:`${g("workflows.call-stack-tab")} | ${a[1]}`,url:a[0].url.href}}),e=new x({props:{$$slots:{default:[he]},$$scope:{ctx:a}}}),{c(){v(t.$$.fragment),n=D(),v(e.$$.fragment)},l(l){y(t.$$.fragment,l),n=Q(l),y(e.$$.fragment,l)},m(l,o){T(t,l,o),h(l,n,o),T(e,l,o),r=!0},p(l,[o]){const s={};o&1&&(s.url=l[0].url.href),t.$set(s);const c={};o&4&&(c.$$scope={dirty:o,ctx:l}),e.$set(c)},i(l){r||(_(t.$$.fragment,l),_(e.$$.fragment,l),r=!0)},o(l){d(t.$$.fragment,l),d(e.$$.fragment,l),r=!1},d(l){l&&p(n),E(t,l),E(e,l)}}}function ve(a,t,n){let e;V(a,X,l=>n(0,e=l));const r=e.params.workflow;return[e,r]}class Be extends H{constructor(t){super(),J(this,t,ve,be,F,{})}}export{Be as component};

import"../chunks/CWj6FrbW.js";import"../chunks/69_IOA4Y.js";import{p as qe,l as H,a as Me,b as Pe,R as $e,s as r,az as o,m as s,g as e,e as w,r as $,d as t,c as I,t as ce,f as J,n as ye,aK as Oe}from"../chunks/BZ1i_Yzi.js";import{t as j,a as v,c as Qe,b as xe}from"../chunks/B11KKQxI.js";import{i as Te}from"../chunks/EXou6kTq.js";import{a as N,s as Ie,e as ze}from"../chunks/nHCSEYHe.js";import{p as je}from"../chunks/C_BNG6hb.js";import{P as Ae}from"../chunks/BSbw5w3E.js";import{t as l}from"../chunks/D2OY9xdY.js";import{W as Fe}from"../chunks/CJAtYjGZ.js";import{s as ue}from"../chunks/BtIgVYD3.js";import{a as Ke}from"../chunks/C5EvHk3S.js";import{i as ke}from"../chunks/Pfo2U1_a.js";import{e as Ge,i as He}from"../chunks/DT_Kaee1.js";import{o as Je}from"../chunks/Dm8LSs3h.js";import{P as Ne}from"../chunks/DqSSBVT8.js";import{B as Ve}from"../chunks/CdXn1aY1.js";import{C as Xe}from"../chunks/Bga7QKHu.js";import{C as Ye}from"../chunks/C2k67nnR.js";import{E as he}from"../chunks/BH5Z54-t.js";import{L as Ze}from"../chunks/CJSepuex.js";import{S as et,O as tt}from"../chunks/DGkngnYK.js";import{T as rt}from"../chunks/BkG9Mf0M.js";import{a as ot,b as st}from"../chunks/BVAWfUBY.js";import{a as at}from"../chunks/BipkNA2r.js";import{w as be}from"../chunks/Dp52_Yis.js";import{e as nt}from"../chunks/BZ0hnGd1.js";import{s as lt}from"../chunks/CTBtQUu0.js";var it=j('<div class="text-center"><!> <p class="-mt-10"> </p></div>'),ct=j('<!> <div class="flex flex-col gap-1"><!></div> <div class="flex w-full flex-wrap items-end justify-end gap-4"><!></div>',1),ut=j('<div class="ml-auto"><!></div> <!>',1),dt=j('<div class="flex w-3/4 gap-4 max-2xl:w-full max-lg:flex-col"><!> <div class="flex w-full flex-col gap-2"><!></div></div>'),ft=j("<section><!></section>");function pt(V,X){qe(X,!1);const[C,Y]=Ie(),q=()=>N(je,"$page",C),n=()=>N(be,"$workflowRun",C),c=()=>N(at,"$authUser",C),g=s(),D=s(),u=s();var P=s(),R=s(),L=s(),M=s(),O=s(),Q=s();const{namespace:de,workflow:fe,run:pe}=q().params,Ce={id:fe,runId:pe};let d=s(),Z=s(),y=s(""),ee=s(""),z=s(!1),A=s(!0),me=s(),te=s();Je(()=>{n().metadata||Re()});const Re=async()=>{const{settings:a}=q().data,f=await ot({namespace:de,workflow:{id:fe,runId:pe}},a,c()===null||c()===void 0?void 0:c().accessToken);ze(be,$e(n).metadata=f,$e(n))},ve=()=>{r(z,!1),r(Z,e(d)),r(ee,e(y))},We=async a=>{var f;r(z,!0);let x;try{r(te,e(y)?nt({input:e(y),encoding:"json/plain",encodeWithCodec:!1}):Promise.resolve(null)),x=await e(te)}catch{ve();return}r(me,st({namespace:de,workflow:Ce,queryType:a,queryArgs:x?{payloads:x}:null},(f=q().data)===null||f===void 0?void 0:f.settings,c()===null||c()===void 0?void 0:c().accessToken).finally(()=>{ve()}))};H(()=>(o(O),o(M),o(L),n()),()=>{r(u,(r(O,r(M,r(L,n()===null||n()===void 0?void 0:n().metadata)===null||o(L)===void 0?void 0:o(L).definition)===null||o(M)===void 0?void 0:o(M).queryDefinitions)===null||o(O)===void 0?void 0:o(O).filter(a=>(a==null?void 0:a.name)!=="__stack_trace"))||[])}),H(()=>(e(d),o(Q),e(u)),()=>{r(d,e(d)||(r(Q,e(u)===null||e(u)===void 0?void 0:e(u)[0])===null||o(Q)===void 0?void 0:o(Q).name))}),H(()=>(e(Z),e(d),e(y),e(ee)),()=>{r(g,e(Z)!==e(d)||e(y)!==e(ee))}),H(()=>(o(R),o(P),n()),()=>{r(D,r(R,r(P,n().metadata)===null||o(P)===void 0?void 0:o(P).error)===null||o(R)===void 0?void 0:o(R).message)}),Me(),Te();var re=ft(),Be=w(re);{var Ee=a=>{const f=t(()=>l("common.error-occurred")),x=t(()=>l("workflows.no-workers-running-message")),F=t(()=>{var p,i;return(i=(p=n().metadata)==null?void 0:p.error)==null?void 0:i.message});he(a,{get title(){return e(f)},get content(){return e(x)},get error(){return e(F)}})},Se=(a,f)=>{{var x=p=>{var i=it(),W=w(i);Ze(W,{});var B=I(W,2),oe=w(B,!0);$(B),$(i),ce(k=>ue(oe,k),[()=>l("workflows.no-workers-failure-message")],t),v(p,i)},F=p=>{var i=dt(),W=w(i);Xe(W,{class:"mt-7 flex h-fit w-full flex-col gap-2",children:(k,K)=>{var T=ct(),_=J(T);const h=t(()=>l("workflows.query-type"));et(_,{id:"query-select",get label(){return e(h)},class:"min-w-fit","data-testid":"query-select",required:!0,get value(){return e(d)},set value(m){r(d,m)},children:(m,ie)=>{var b=Qe(),U=J(b);Ge(U,1,()=>e(u),He,(Ue,ge)=>{let _e=()=>e(ge).name,De=t(()=>Oe(e(ge).description,""));tt(Ue,{get value(){return _e()},get description(){return e(De)},children:(Le,vt)=>{ye();var we=xe();ce(()=>ue(we,_e())),v(Le,we)},$$slots:{default:!0}})}),v(m,b)},$$slots:{default:!0},$$legacy:!0});var E=I(_,2),S=w(E);const se=t(()=>l("workflows.query-arg"));Ne(S,{get label(){return e(se)},get input(){return e(y)},set input(m){r(y,m)},$$legacy:!0}),$(E);var G=I(E,2),ae=w(G);const ne=t(()=>e(g)?"primary":"secondary"),le=t(()=>e(g)?null:"retry");Ve(ae,{get loading(){return e(z)},get variant(){return e(ne)},get leadingIcon(){return e(le)},get disabled(){return e(z)},$$events:{click:()=>We(e(d))},children:(m,ie)=>{ye();var b=xe();ce(U=>ue(b,U),[()=>e(g)?l("workflows.run-query"):l("workflows.refresh-query")],t),v(m,b)},$$slots:{default:!0}}),$(G),v(k,T)},$$slots:{default:!0}});var B=I(W,2),oe=w(B);Ke(oe,()=>Promise.all([e(me),e(te)]),null,(k,K)=>{var T=t(()=>{var[b,U]=e(K);return{result:b,_:U}}),_=t(()=>e(T).result),h=ut();const E=t(()=>typeof e(_)!="string"?lt(e(_)):e(_));var S=J(h),se=w(S);const G=t(()=>l("workflows.json-formatting"));rt(se,{get label(){return e(G)},labelPosition:"left",id:"json-formatting",get checked(){return e(A)},$$events:{change:()=>r(A,!e(A))}}),$(S);var ae=I(S,2);const ne=t(()=>e(A)?"json":"text"),le=t(()=>l("common.copy-icon-title")),m=t(()=>l("common.copy-success-icon-title")),ie=t(()=>e(g)&&"opacity-50");Ye(ae,{get content(){return e(E)},get language(){return e(ne)},get copyIconTitle(){return e(le)},get copySuccessIconTitle(){return e(m)},testId:"query-result",get class(){return e(ie)}}),v(k,h)},(k,K)=>{const T=t(()=>l("common.error-occurred")),_=t(()=>{var h;return(h=e(K))==null?void 0:h.message});he(k,{get title(){return e(T)},get error(){return e(_)}})}),$(B),$(i),v(p,i)};ke(a,p=>{e(u).length?p(F,!1):p(x)},f)}};ke(Be,a=>{e(D)?a(Ee):a(Se,!1)})}$(re),v(V,re),Pe(),Y()}var mt=j("<!> <!>",1);function Ft(V,X){qe(X,!1);const[C,Y]=Ie(),q=()=>N(je,"$page",C),n=q().params.workflow;Te();var c=mt(),g=J(c);const D=t(()=>`${l("workflows.queries-tab")} | ${n}`);Ae(g,{get title(){return e(D)},get url(){return q().url.href}});var u=I(g,2);Fe(u,{children:(P,R)=>{pt(P,{})},$$slots:{default:!0}}),v(V,c),Pe(),Y()}export{Ft as component};

import{s as fe,h as T,j as C,k as j,f as p,i as w,c as N,V as be,L as ye,b as B,d as O,m as W,n as L,t as H,l as J,v as P,O as Z,a4 as x,w as ee,x as ve,q as ue}from"../chunks/scheduler.CnYDgCRb.js";import{S as ie,i as ce,g as me,b as _,e as pe,t as d,c as k,a as b,m as y,d as v,h as te}from"../chunks/index.DW7Zsqzm.js";import{p as de}from"../chunks/stores.D-C-POLS.js";import{P as qe}from"../chunks/page-title.DEkRIe-Y.js";import{t as h}from"../chunks/translate.BBe5dcco.js";import{W as Ie}from"../chunks/workflow-padded-layout.CYlZeGRB.js";import{h as ne,u as Ee}from"../chunks/await_block.riFHw7oM.js";import{e as re}from"../chunks/each.rY6XwTBs.js";import{P as Pe}from"../chunks/payload-input.yGYnahlr.js";import{B as Te}from"../chunks/button.KLyJdGLh.js";import{C as Ce}from"../chunks/card.DK3n6meh.js";import{C as je}from"../chunks/code-block.Ew-Wr1k8.js";import{E as _e}from"../chunks/empty-state.LMdRD7f9.js";import{L as De}from"../chunks/loading.U4sbptnk.js";import{S as Ve,O as Se}from"../chunks/option.PpQm8UkJ.js";import{T as We}from"../chunks/toggle-switch.CH4J36h7.js";import{a as Be,b as Oe}from"../chunks/query-service.rd61lOG1.js";import{a as Re}from"../chunks/auth-user.DSdasbEd.js";import{w as oe}from"../chunks/workflow-run.BrIYixwx.js";import{e as Le}from"../chunks/encode-payload.pO6yHCij.js";import{s as Me}from"../chunks/parse-with-big-int.DJQKqIvA.js";function le(s){s[31]=s[33][0],s[32]=s[33][1];const e=typeof s[31]!="string"?Me(s[31]):s[31];s[34]=e}function se(s,e,t){const n=s.slice();return n[33]=e[t].name,n[36]=e[t].description!==void 0?e[t].description:"",n}function Ne(s){let e,t,n,r,a,o;t=new Ce({props:{class:"mt-7 flex h-fit w-full flex-col gap-2",$$slots:{default:[Ge]},$$scope:{ctx:s}}});let f={ctx:s,current:null,token:null,hasCatch:!0,pending:Ke,then:Je,catch:He,value:33,error:35,blocks:[,,,]};return ne(a=Promise.all([s[6],s[7]]),f),{c(){e=T("div"),k(t.$$.fragment),n=B(),r=T("div"),f.block.c(),this.h()},l(l){e=C(l,"DIV",{class:!0});var u=j(e);b(t.$$.fragment,u),n=O(u),r=C(u,"DIV",{class:!0});var c=j(r);f.block.l(c),c.forEach(p),u.forEach(p),this.h()},h(){W(r,"class","flex w-full flex-col gap-2"),W(e,"class","flex w-3/4 gap-4 max-2xl:w-full max-lg:flex-col")},m(l,u){w(l,e,u),y(t,e,null),L(e,n),L(e,r),f.block.m(r,f.anchor=null),f.mount=()=>r,f.anchor=null,o=!0},p(l,u){s=l;const c={};u[0]&535|u[1]&256&&(c.$$scope={dirty:u,ctx:s}),t.$set(c),f.ctx=s,u[0]&192&&a!==(a=Promise.all([s[6],s[7]]))&&ne(a,f)||Ee(f,s,u)},i(l){o||(d(t.$$.fragment,l),d(f.block),o=!0)},o(l){_(t.$$.fragment,l);for(let u=0;u<3;u+=1){const c=f.blocks[u];_(c)}o=!1},d(l){l&&p(e),v(t),f.block.d(),f.token=null,f=null}}}function Qe(s){let e,t,n,r,a=h("workflows.no-workers-failure-message")+"",o,f;return t=new De({}),{c(){e=T("div"),k(t.$$.fragment),n=B(),r=T("p"),o=H(a),this.h()},l(l){e=C(l,"DIV",{class:!0});var u=j(e);b(t.$$.fragment,u),n=O(u),r=C(u,"P",{class:!0});var c=j(r);o=J(c,a),c.forEach(p),u.forEach(p),this.h()},h(){W(r,"class","-mt-10"),W(e,"class","text-center")},m(l,u){w(l,e,u),y(t,e,null),L(e,n),L(e,r),L(r,o),f=!0},p:P,i(l){f||(d(t.$$.fragment,l),f=!0)},o(l){_(t.$$.fragment,l),f=!1},d(l){l&&p(e),v(t)}}}function Ue(s){var n,r;let e,t;return e=new _e({props:{title:h("common.error-occurred"),content:h("workflows.no-workers-running-message"),error:(r=(n=s[3].metadata)==null?void 0:n.error)==null?void 0:r.message}}),{c(){k(e.$$.fragment)},l(a){b(e.$$.fragment,a)},m(a,o){y(e,a,o),t=!0},p(a,o){var l,u;const f={};o[0]&8&&(f.error=(u=(l=a[3].metadata)==null?void 0:l.error)==null?void 0:u.message),e.$set(f)},i(a){t||(d(e.$$.fragment,a),t=!0)},o(a){_(e.$$.fragment,a),t=!1},d(a){v(e,a)}}}function Ae(s){let e=s[33]+"",t;return{c(){t=H(e)},l(n){t=J(n,e)},m(n,r){w(n,t,r)},p(n,r){r[0]&4&&e!==(e=n[33]+"")&&ue(t,e)},d(n){n&&p(t)}}}function ae(s){let e,t;return e=new Se({props:{value:s[33],description:s[36],$$slots:{default:[Ae]},$$scope:{ctx:s}}}),{c(){k(e.$$.fragment)},l(n){b(e.$$.fragment,n)},m(n,r){y(e,n,r),t=!0},p(n,r){const a={};r[0]&4&&(a.value=n[33]),r[0]&4&&(a.description=n[36]),r[0]&4|r[1]&256&&(a.$$scope={dirty:r,ctx:n}),e.$set(a)},i(n){t||(d(e.$$.fragment,n),t=!0)},o(n){_(e.$$.fragment,n),t=!1},d(n){v(e,n)}}}function Fe(s){let e,t,n=re(s[2]),r=[];for(let o=0;o<n.length;o+=1)r[o]=ae(se(s,n,o));const a=o=>_(r[o],1,1,()=>{r[o]=null});return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=ee()},l(o){for(let f=0;f<r.length;f+=1)r[f].l(o);e=ee()},m(o,f){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(o,f);w(o,e,f),t=!0},p(o,f){if(f[0]&4){n=re(o[2]);let l;for(l=0;l<n.length;l+=1){const u=se(o,n,l);r[l]?(r[l].p(u,f),d(r[l],1)):(r[l]=ae(u),r[l].c(),d(r[l],1),r[l].m(e.parentNode,e))}for(me(),l=n.length;l<r.length;l+=1)a(l);pe()}},i(o){if(!t){for(let f=0;f<n.length;f+=1)d(r[f]);t=!0}},o(o){r=r.filter(Boolean);for(let f=0;f<r.length;f+=1)_(r[f]);t=!1},d(o){o&&p(e),ve(r,o)}}}function ze(s){let e=(s[9]?h("workflows.run-query"):h("workflows.refresh-query"))+"",t;return{c(){t=H(e)},l(n){t=J(n,e)},m(n,r){w(n,t,r)},p(n,r){r[0]&512&&e!==(e=(n[9]?h("workflows.run-query"):h("workflows.refresh-query"))+"")&&ue(t,e)},d(n){n&&p(t)}}}function Ge(s){let e,t,n,r,a,o,f,l,u,c;function D(i){s[19](i)}let I={id:"query-select",label:h("workflows.query-type"),class:"min-w-fit","data-testid":"query-select",required:!0,$$slots:{default:[Fe]},$$scope:{ctx:s}};s[0]!==void 0&&(I.value=s[0]),e=new Ve({props:I}),Z.push(()=>te(e,"value",D));function V(i){s[20](i)}let E={label:h("workflows.query-arg")};return s[1]!==void 0&&(E.input=s[1]),a=new Pe({props:E}),Z.push(()=>te(a,"input",V)),u=new Te({props:{loading:s[4],variant:s[9]?"primary":"secondary",leadingIcon:s[9]?null:"retry",disabled:s[4],$$slots:{default:[ze]},$$scope:{ctx:s}}}),u.$on("click",s[21]),{c(){k(e.$$.fragment),n=B(),r=T("div"),k(a.$$.fragment),f=B(),l=T("div"),k(u.$$.fragment),this.h()},l(i){b(e.$$.fragment,i),n=O(i),r=C(i,"DIV",{class:!0});var m=j(r);b(a.$$.fragment,m),m.forEach(p),f=O(i),l=C(i,"DIV",{class:!0});var q=j(l);b(u.$$.fragment,q),q.forEach(p),this.h()},h(){W(r,"class","flex flex-col gap-1"),W(l,"class","flex w-full flex-wrap items-end justify-end gap-4")},m(i,m){y(e,i,m),w(i,n,m),w(i,r,m),y(a,r,null),w(i,f,m),w(i,l,m),y(u,l,null),c=!0},p(i,m){const q={};m[0]&4|m[1]&256&&(q.$$scope={dirty:m,ctx:i}),!t&&m[0]&1&&(t=!0,q.value=i[0],x(()=>t=!1)),e.$set(q);const M={};!o&&m[0]&2&&(o=!0,M.input=i[1],x(()=>o=!1)),a.$set(M);const $={};m[0]&16&&($.loading=i[4]),m[0]&512&&($.variant=i[9]?"primary":"secondary"),m[0]&512&&($.leadingIcon=i[9]?null:"retry"),m[0]&16&&($.disabled=i[4]),m[0]&512|m[1]&256&&($.$$scope={dirty:m,ctx:i}),u.$set($)},i(i){c||(d(e.$$.fragment,i),d(a.$$.fragment,i),d(u.$$.fragment,i),c=!0)},o(i){_(e.$$.fragment,i),_(a.$$.fragment,i),_(u.$$.fragment,i),c=!1},d(i){i&&(p(n),p(r),p(f),p(l)),v(e,i),v(a),v(u)}}}function He(s){var n;let e,t;return e=new _e({props:{title:h("common.error-occurred"),error:(n=s[35])==null?void 0:n.message}}),{c(){k(e.$$.fragment)},l(r){b(e.$$.fragment,r)},m(r,a){y(e,r,a),t=!0},p(r,a){var f;const o={};a[0]&192&&(o.error=(f=r[35])==null?void 0:f.message),e.$set(o)},i(r){t||(d(e.$$.fragment,r),t=!0)},o(r){_(e.$$.fragment,r),t=!1},d(r){v(e,r)}}}function Je(s){le(s);let e,t,n,r,a;return t=new We({props:{label:h("workflows.json-formatting"),labelPosition:"left",id:"json-formatting",checked:s[5]}}),t.$on("change",s[22]),r=new je({props:{content:s[34],language:s[5]?"json":"text",copyIconTitle:h("common.copy-icon-title"),copySuccessIconTitle:h("common.copy-success-icon-title"),testId:"query-result",class:s[9]&&"opacity-50"}}),{c(){e=T("div"),k(t.$$.fragment),n=B(),k(r.$$.fragment),this.h()},l(o){e=C(o,"DIV",{class:!0});var f=j(e);b(t.$$.fragment,f),f.forEach(p),n=O(o),b(r.$$.fragment,o),this.h()},h(){W(e,"class","ml-auto")},m(o,f){w(o,e,f),y(t,e,null),w(o,n,f),y(r,o,f),a=!0},p(o,f){le(o);const l={};f[0]&32&&(l.checked=o[5]),t.$set(l);const u={};f[0]&192&&(u.content=o[34]),f[0]&32&&(u.language=o[5]?"json":"text"),f[0]&512&&(u.class=o[9]&&"opacity-50"),r.$set(u)},i(o){a||(d(t.$$.fragment,o),d(r.$$.fragment,o),a=!0)},o(o){_(t.$$.fragment,o),_(r.$$.fragment,o),a=!1},d(o){o&&(p(e),p(n)),v(t),v(r,o)}}}function Ke(s){return{c:P,l:P,m:P,p:P,i:P,o:P,d:P}}function Xe(s){let e,t,n,r;const a=[Ue,Qe,Ne],o=[];function f(l,u){return l[8]?0:l[2].length?2:1}return t=f(s),n=o[t]=a[t](s),{c(){e=T("section"),n.c()},l(l){e=C(l,"SECTION",{});var u=j(e);n.l(u),u.forEach(p)},m(l,u){w(l,e,u),o[t].m(e,null),r=!0},p(l,u){let c=t;t=f(l),t===c?o[t].p(l,u):(me(),_(o[c],1,1,()=>{o[c]=null}),pe(),n=o[t],n?n.p(l,u):(n=o[t]=a[t](l),n.c()),d(n,1),n.m(e,null))},i(l){r||(d(n),r=!0)},o(l){_(n),r=!1},d(l){l&&p(e),o[t].d()}}}function Ye(s,e,t){let n,r,a,o,f,l;N(s,Re,g=>t(23,o=g)),N(s,de,g=>t(24,f=g)),N(s,oe,g=>t(3,l=g));var u,c,D,I,V,E;const{namespace:i,workflow:m,run:q}=f.params,M={id:m,runId:q};let $,Q,S="",U="",A=!1,F=!0,K,z;be(()=>{l.metadata||ge()});const ge=async()=>{const{settings:g}=f.data,R=await Be({namespace:i,workflow:{id:m,runId:q}},g,o==null?void 0:o.accessToken);ye(oe,l.metadata=R,l)},X=()=>{t(4,A=!1),t(17,Q=$),t(18,U=S)},Y=async g=>{var R;t(4,A=!0);let G;try{t(7,z=S?Le({input:S,encoding:"json/plain",encodeWithCodec:!1}):Promise.resolve(null)),G=await z}catch{X();return}t(6,K=Oe({namespace:i,workflow:M,queryType:g,queryArgs:G?{payloads:G}:null},(R=f.data)===null||R===void 0?void 0:R.settings,o==null?void 0:o.accessToken).finally(()=>{X()}))};function $e(g){$=g,t(0,$),t(2,a),t(16,E),t(3,l),t(13,D),t(14,I),t(15,V)}function he(g){S=g,t(1,S)}const we=()=>Y($),ke=()=>t(5,F=!F);return s.$$.update=()=>{s.$$.dirty[0]&57352&&t(2,a=(t(15,V=t(14,I=t(13,D=l==null?void 0:l.metadata)===null||D===void 0?void 0:D.definition)===null||I===void 0?void 0:I.queryDefinitions)===null||V===void 0?void 0:V.filter(g=>(g==null?void 0:g.name)!=="__stack_trace"))||[]),s.$$.dirty[0]&65541&&t(0,$=$||(t(16,E=a==null?void 0:a[0])===null||E===void 0?void 0:E.name)),s.$$.dirty[0]&393219&&t(9,n=Q!==$||S!==U),s.$$.dirty[0]&6152&&t(8,r=t(12,c=t(11,u=l.metadata)===null||u===void 0?void 0:u.error)===null||c===void 0?void 0:c.message)},[$,S,a,l,A,F,K,z,r,n,Y,u,c,D,I,V,E,Q,U,$e,he,we,ke]}class Ze extends ie{constructor(e){super(),ce(this,e,Ye,Xe,fe,{},null,[-1,-1])}}function xe(s){let e,t;return e=new Ze({}),{c(){k(e.$$.fragment)},l(n){b(e.$$.fragment,n)},m(n,r){y(e,n,r),t=!0},i(n){t||(d(e.$$.fragment,n),t=!0)},o(n){_(e.$$.fragment,n),t=!1},d(n){v(e,n)}}}function et(s){let e,t,n,r;return e=new qe({props:{title:`${h("workflows.queries-tab")} | ${s[1]}`,url:s[0].url.href}}),n=new Ie({props:{$$slots:{default:[xe]},$$scope:{ctx:s}}}),{c(){k(e.$$.fragment),t=B(),k(n.$$.fragment)},l(a){b(e.$$.fragment,a),t=O(a),b(n.$$.fragment,a)},m(a,o){y(e,a,o),w(a,t,o),y(n,a,o),r=!0},p(a,[o]){const f={};o&1&&(f.url=a[0].url.href),e.$set(f);const l={};o&4&&(l.$$scope={dirty:o,ctx:a}),n.$set(l)},i(a){r||(d(e.$$.fragment,a),d(n.$$.fragment,a),r=!0)},o(a){_(e.$$.fragment,a),_(n.$$.fragment,a),r=!1},d(a){a&&p(t),v(e,a),v(n,a)}}}function tt(s,e,t){let n;N(s,de,a=>t(0,n=a));const r=n.params.workflow;return[n,r]}class qt extends ie{constructor(e){super(),ce(this,e,tt,et,fe,{})}}export{qt as component};
